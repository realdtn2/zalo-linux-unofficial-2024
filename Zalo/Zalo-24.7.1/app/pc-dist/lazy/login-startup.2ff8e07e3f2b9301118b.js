(this.webpackJsonp=this.webpackJsonp||[]).push([[22],{U96N:function(e,t,a){},zn3J:function(e,t,a){"use strict";a.r(t);a("iGh7"),a("eqHM"),a("y485"),a("dhzt"),a("jmmm"),a("xDXR"),a("WrSY"),a("FX2a"),a("goVM"),a("vUp1"),a("tPRg"),a("dThN");var s=a("z0WU"),n=(a("XS0u"),a("q1tI")),o=a.n(n),i=a("i8i4"),r=a("/MKj"),c=a("wx14"),l=a("17x9"),h=a.n(l),u=a("lCMA");o.a.Component;var d=a("VTBJ"),_=a("NDmK"),p=a("ob4H"),m=a("fBUP"),E=a("X4fA"),g=a("Ja3U"),T=a("iuhU"),N=a("yUfy"),R=a("1pet");const f=()=>$zlogin.notifyLoginSuccess(),C=1,S="LOGIN_FAIL",I="SECURITY_LOGIN_PASS",O="UPDATE_QUESTION_DATA",y="GET_CAPTCHA",b="SET_QR_IMAGE",v="SET_QR_ERROR_MESSAGE",P="SHOW_LOGIN_QR",A="SHOW_LOGIN_PASS",L="SHOW_REGISTER",w="QR_SHOW_TIPS",M="QR_HIDE_TIPS",k="SET_QR_CURRENT_DATA",x="LOGIN_SUCCESS",D="TOGGLE_CONFIRM",U="TOGGLE_APP_INFO",G="RESET",q="TOGGLE_SENSITIVE_LOGIN",F="SHOW_MOBILE_LOGIN",K="QR_EXPIRED",W=e=>$zlogin.updateLoginStep(e),j={LOGIN_STEP_ENTER_LOGIN_PASS:"4",LOGIN_STEP_GET_CAPTCHA_PASS:"4.1",LOGIN_STEP_READY_LOGIN_PASS:"4.2",LOGIN_STEP_INPUT_EMPTY_INFO_PASS:"4.4",LOGIN_STEP_INPUT_INVALID_PHONE_PASS:"4.5",LOGIN_STEP_ENTER_LOGIN_QR:"5",LOGIN_STEP_GET_QR:"5.1",LOGIN_STEP_WAITING_SCAN:"5.2",LOGIN_STEP_WAITING_CONFIRM:"5.3",SIGNUP_STEP_INPUT_NUMBER:"10.0",SIGNUP_STEP_INPUT_NUMBER_NEED_CAPTCHA:"10.1",SIGNUP_STEP_EXIST_ACCOUNT:"10.2",SIGNUP_STEP_WAIT_SMS_CODE:"10.3",SIGNUP_STEP_WAIT_CALL_CODE:"10.4",SIGNUP_STEP_WAIT_MANUAL_CODE:"10.5",SIGNUP_STEP_UPDATE_PROFILE:"10.6",FORGOT_STEP_INPUT_NUMBER:"11.1",FORGOT_STEP_INPUT_NUMBER_NEED_CAPTCHA:"11.2",FORGOT_STEP_WAIT_SMS_CODE:"11.3",FORGOT_STEP_WAIT_CALL_CODE:"11.4",FORGOT_STEP_WAIT_MANUAL_CODE:"11.5",FORGOT_STEP_SECURITY_QUESTION:"11.6",FACEBOOK_STEP_WAIT_BROWSER_RESPONSE:"12.1",FACEBOOK_STEP_INPUT_NUMBER:"12.2",FACEBOOK_STEP_INPUT_NUMBER_NEED_CAPTCHA:"12.3",FACEBOOK_STEP_PHONE_LINKED_LOGIN:"12.4",FACEBOOK_STEP_PHONE_LINKED_EDIT_NUMBER:"12.5",FACEBOOK_STEP_WAIT_ZALO_CODE:"12.6",FACEBOOK_STEP_WAIT_SMS_CODE:"12.7",FACEBOOK_STEP_WAIT_CALL_CODE:"12.8",FACEBOOK_STEP_WAIT_MANUAL_CODE:"12.9",LOGIN_STEP_SUBMIT_OTP:"6.5",LOGIN_STEP_SECURITY_QUESTION:"13.0",LOGIN_STEP_SECURITY_QUESTION_FAIL:"13.1"},Q=18010,B=-10,V=-100,z=-200,H=18012,Y=18021,$=18029,X=18015,Z=18033;var J=a("c51z"),ee=a("1ZEA"),te=a("v/qp"),ae=a("XD71"),se="assets/login_img_security.85122757babe46a7f06a3bc55bd1c915.png",ne="assets/logo-new.146dfa01c78183631d33b77999a18288.svg",oe=a("ptcT"),ie=a("kEG/");function re(e,t){let a="";return e?(e.errorMessageLocalize&&(a=e.errorMessageLocalize),a||(a=function(e,t){let a="";switch(e.errorCode){case ie.a.INVALID_FACEBOOK_TOKEN:a=J.default.str("STR_SIGNIN_ERROR_FACEBOOK_TOKEN");break;case ie.a.USER_WAS_BANNED:a=J.default.str("STR_SIGNIN_ERROR_ACCOUNT_BANNED");break;case ie.a.REQUEST_RATE_LIMIT_EXCEEDED:a=J.default.str("STR_SIGNIN_ERROR_CAPPED_INCORRECT_ATTEMPTS");break;case ie.a.INVALID_PHONE_NUMBER:a=J.default.str("STR_SIGNIN_ERROR_INVALID_PHONE_NUMBER");break;case ie.a.ACCOUNT_NOT_ACTIVE:a=J.default.str("STR_SIGNIN_ERROR_UNKNOWN_PHONE_NUMBER");break;case ie.a.INVALID_OTP_CODE:a=J.default.str("STR_SIGNIN_ERROR_INCORRECT_CODE");break;case ie.a.INVALID_PHONE_NUMBER_OR_PASSWORD:a=null!=t&&t.useRecentData?J.default.str("STR_SIGNIN_ERROR_INCORRECT_PASSWORD"):J.default.str("STR_SIGNIN_ERROR_INCORRECT_PASSWORD_OR_PHONE");break;case ie.a.INVALID_CAPTCHA:a=J.default.str("STR_SIGNIN_ERROR_INCORRECT_CAPTCHA");break;case ie.a.INVALID_PARAM:a=J.default.str("STR_SIGNIN_ERROR_INVALID_PARAMS");break;case ie.a.CAPTCHA_EXPIRED:a=J.default.str("STR_SIGNIN_ERROR_CAPTCHA_EXPIRED");break;case ie.a.CAPTCHA_RETRY_RATE_LIMIT_EXCEEDED:a=J.default.str("STR_SIGNIN_ERROR_CAPPED_INCORRECT_CAPTCHAS");break;case ie.a.CAPTCHA_REQUIRED:a=J.default.str("STR_SIGNIN_ERROR_EMPTY_CAPTCHA");break;case ie.a.PROFILE_CREATION_QUOTA_LIMIT_EXCEEDED:a=J.default.str("STR_SIGNIN_ERROR_CAPPED_REGISTRATIONS");break;case ie.a.SMS_QUOTA_LIMIT_EXCEEDED:a=J.default.str("STR_SIGNIN_ERROR_CAPPED_SMS_SEND_REQUESTS");break;case ie.a.VOICE_QUOTA_LIMIT_EXCEEDED:a=J.default.str("STR_SIGNIN_ERROR_CAPPED_CALL_SEND_REQUESTS");break;case ie.a.SECURITY_QUESTION_REQUIRED:a=J.default.str("STR_SIGNIN_ERROR_WRONG_ANSWER");break;case ie.a.SECURITY_QUESTION_QUOTA_LIMIT_EXCEEDED:a=J.default.str("STR_SIGNIN_ERROR_CAPPED_SECURITY_QUESTION");break;case ie.a.ZALO_ACTIVE_CODE_QUOTA_LIMIT_EXCEEDED:a=J.default.str("STR_SIGNIN_ERROR_CAPPED_CODE_SEND_REQUESTS");break;case ie.a.OUT_OF_SECQ_QUOTA:case ie.a.OUT_OF_SECQ_2_STEP_QUOTA:a=J.default.str("STR_SECQ_ERROR");break;case R.NetWorkError.NO_NETWORK:case R.NetWorkError.TIMEOUT_SENT:case R.NetWorkError.TIMEOUT:a=J.default.str("STR_SIGNIN_ERROR_NO_NETWORK")}return a}(e,t)),a):a}var ce=function(){let e=null;return{getAuthenticationController:()=>{var t;return e||(e=null===(t=a("X4fA"))||void 0===t?void 0:t.default)}}}().getAuthenticationController,le=a("egaF"),he=a("NGyP"),ue=a("O8ue");var de=function(e){const{checked:t=!1,format:a,id:s,thumb:n,title:i,onClick:r}=e,c=e=>{r&&r(e,{id:s,thumb:n,title:i})};return o.a.createElement("div",{className:Object(T.a)("rel","flx flx-al-c","login-pass__questionnaire__questions__item"),onClick:c},n&&o.a.createElement(he.d,{target:{displayName:i,avatar:n},size:"l"}),o.a.createElement("div",{className:Object(T.a)("name",n&&"ml-12")},i),o.a.createElement(ue.a,{className:"fl-r",checked:t,onChange:c}))};var _e=function(e){var t,a;const{data:s,disabled:n=!1,errorMessage:i,resetChecked:r=!1,onBack:c,onAnswerQuestions:l,onUpdateCheckedList:h}=e,[_,p]=o.a.useState({}),m=Object.keys(_).length>=s.answerType;let E=s.content+` ${J.default.trans("STR_SECURITY_QUESTION_MESSAGE_SUBTEXT",[(null!==(t=s.answerType)&&void 0!==t?t:0).toString()])}`;const g=(e,t)=>{const a=t.id,s=Object(d.a)({},_);s[a]?delete s[a]:s[a]=Object(d.a)({},t),N(s)},N=e=>{p(e),h&&h(e)};return o.a.useEffect((()=>{N({})}),[r]),o.a.createElement("div",{className:Object(T.a)("flx","flx-col","flx-1","flx-al-c","login-padding"),style:{paddingTop:"16px"}},o.a.createElement(u.a,{className:"sigin-title",tagName:"div",textKey:"STR_LOGIN_ACCOUNT"}),o.a.createElement("div",{className:"pw-description"},E),i?o.a.createElement(u.a,{className:Object(T.a)("error","text-center","mt-8","mb-0"),textKey:i}):null,o.a.createElement("div",{id:"listLoginQuestion",className:Object(T.a)("login-pass__questionnaire__questions","w100")},o.a.createElement(le.a,{autoHide:!1,className:"login-pass__questionnaire__questions__inner"},(null!==(a=s.choices)&&void 0!==a?a:[]).map((e=>o.a.createElement(de,{key:"item_qs_"+e.value,checked:!!_[e.value],format:s.format,id:e.value,thumb:e.thumb,title:e.title,onClick:g}))))),o.a.createElement(te.a,{className:"login-pass__questionnaire__questions__submit-button",disabled:!m||n,loading:n,onClick:e=>{m&&l&&l(e,_)},size:"large",textKey:"STR_ANSWER"}),o.a.createElement("div",{className:"flx-1"}),o.a.createElement(te.a,{type:"tertiary-primary",onClick:e=>{c&&c(e)},size:"large",textKey:"STR_BACK"}))};var pe=function(e){const{data:t,dispatch:a,onBack:s,onLoginSuccess:n}=e,[i,r]=o.a.useState([]),[c,l]=o.a.useState(!1),[h,u]=o.a.useState(!1),[d,_]=o.a.useState(""),p=o.a.useRef(null),m=()=>{null!=p.current&&(clearTimeout(p.current),p.current=null)},E=()=>{m(),p.current=setTimeout((()=>{p.current=null,a&&a({type:S,payload:""})}),6e5)},g=e=>{const t=ce();if(!t)return;const s=R.ACTIVE_TYPE_LOGIN,n=t.getZaloClientID(),{phone:o,captcha:i,captchaToken:r,countryCode:c,countryIsoCode:l}=e;t.verifyPhoneNumberV2(n,o,l,s).then((e=>{const{data:s}=e;if(s&&s.quota_info&&s.quota_info.length>0){let e=s.quota_info;e.sort(((e,t)=>e.priority-t.priority));const h=e[0].type;t.getActiveCode(n,o,l,h,r,i,R.ACTIVE_TYPE_LOGIN).then((()=>{--e[0].quota,this.props.dispatch({type:L,payload:{phone:o,countryIsoCode:l,countryCode:c,activeType:R.ACTIVE_TYPE_LOGIN,answerSecurityFail:!0,verifyType:h,quotaInfo:e}})})).catch((e=>{a&&a({type:S,payload:re(e)})}))}})).catch()},T=e=>{let t=e.errorMessageLocalize;!t&&e.errorCode&&(t=re(e)),_(t),u(!h)};return o.a.useEffect((()=>(W(j.LOGIN_STEP_SECURITY_QUESTION),E(),()=>{m()})),[]),o.a.createElement(_e,{data:t.questionData,disabled:c,errorMessage:d,resetChecked:h,onAnswerQuestions:()=>{l(!0);const e=ce();if(!e)return;const s=t.phone,o=t.password,r=t.captcha,c=t.captchaToken,h=e.getZaloClientID(),u={question_type:t.questionData.questionType,answer_type:t.questionData.answerType,answers:i.join(",")},d={code:t.countryCode,iso:t.countryIsoCode};e.loginWithPassword(s,o,r,c,h,1,u,d).then((()=>{l(!1),n&&n()})).catch((e=>{l(!1);((e,t)=>{if(e.errorCode===ie.a.SECURITY_QUESTION_REQUIRED){const s=I,n={phone:t.phone,password:t.password,captcha:t.captcha,captchaToken:t.captchaToken,countryCode:t.countryCode,countryIsoCode:t.countryIsoCode,eCode:e.errorCode};e.data&&(n.questionData=e.data),T(e),E(),a&&a({type:s,payload:n})}else if(e.errorCode===ie.a.SECURITY_QUESTION_QUOTA_LIMIT_EXCEEDED){var s;(null===(s=t.phone)||void 0===s?void 0:s.length)>0&&g(t),E()}else if(e.errorCode===ie.a.PASSWORD_NOT_SET){let s="";e.data&&e.data.display_name&&(s=String(e.data.display_name)),a&&a({type:L,payload:{phone:t.phone,captcha:t.captcha,captchaToken:t.captchaToken,passwordInvalid:!0,activeType:3,displayName:s}})}else e.errorCode===ie.a.OUT_OF_SECQ_QUOTA||e.errorCode===ie.a.OUT_OF_SECQ_2_STEP_QUOTA?a&&a({type:P,payload:{errorMessage:re(e)}}):T(e)})(Object(oe.a)(e),{phone:s,password:o,captcha:r,captchaToken:c,countryCode:d.code,countryIsoCode:d.iso})}))},onBack:s,onUpdateCheckedList:e=>{const t=[];for(const a in e)e[a]&&t.push(a);r(t)}})};var me=function(e){const{data:t,dispatch:a,onAnswerSuccess:s,onBack:n,onBackToPhoneValidation:i}=e,[r,c]=o.a.useState([]),[l,h]=o.a.useState(!1),[u,d]=o.a.useState(!1),[_,p]=o.a.useState(""),m=o.a.useRef(null),E=()=>{null!=m.current&&(clearTimeout(m.current),m.current=null)},g=()=>{E(),m.current=setTimeout((()=>{m.current=null,a&&a({type:S,payload:""})}),6e5)};return o.a.useEffect((()=>(W(j.FORGOT_STEP_SECURITY_QUESTION),g(),()=>{E()})),[]),o.a.createElement(_e,{data:t.questionData,disabled:l,errorMessage:_,resetChecked:u,onAnswerQuestions:()=>{h(!0);const e=ce();if(!e)return;const{userData:n}=t,o=n.phone,c=n.token,l=n.countryCode,_=n.countryIsoCode,m={question_type:t.questionData.questionType,answer_type:t.questionData.answerType,answers:r.join(",")},E={isoCode:_};e.answerSecQWhenResetPassword(o,c,m,E).then((()=>{h(!1),s&&s()})).catch((e=>{h(!1);((e,t)=>{const s=e.errorCode;if(s===ie.a.SECURITY_QUESTION_REQUIRED){var n;g(),p(e.errorMessageLocalize),d(!u);const s=L,i={phone:t.phone,countryCode:t.countryCode,countryIsoCode:t.countryIsoCode,eCode:e.errorCode};var o;null!==(n=e.data)&&void 0!==n&&n.question&&(i.questionData=null===(o=e.data)||void 0===o?void 0:o.question),a&&a({type:s,payload:i})}else s===ie.a.INVALID_RESET_PWD_TOKEN||s===ie.a.RESET_PWD_TOKEN_NOT_FOUND||s===ie.a.RESET_PWD_TOKEN_EXPIRED?i&&i(re(e)):s===ie.a.OUT_OF_SECQ_QUOTA||s===ie.a.OUT_OF_SECQ_2_STEP_QUOTA?(g(),a&&a({type:P,payload:{errorMessage:re(e)}})):(p(e.errorMessageLocalize),d(!u))})(Object(oe.a)(e),{phone:o,token:c,countryCode:l,countryIsoCode:_,answerData:m})}))},onBack:n,onUpdateCheckedList:e=>{const t=[];for(const a in e)e[a]&&t.push(a);c(t)}})},Ee=a("igA5"),ge=a("Mgpg"),Te=a("jDHv"),Ne=a("t3Jo");function Re(e,t){return new Ne.b(e,t)}var fe=function(e){const{ISOCode:t,phoneNumber:a}=e,s=Re(a,t);return o.a.createElement("div",{className:"reg-phonenumber"},"+",s.getCountryCode()," ",s.getPhone())};var Ce=new class{constructor(){this.countryCodeMap=new Map,this.data=[],this.ISOCodeMap=new Map,this.load()}getCountryCodeFromISOCode(e){if(!this.ISOCodeMap.has(e))return-1;const t=this.data[this.ISOCodeMap.get(e)];return t?t.country_code:-1}getIsoCodeFromCountryCode(e){if(!this.countryCodeMap.has(e))return"";const t=this.data[this.countryCodeMap.get(e)];return t?t.iso_country_code:""}load(){const e=a("6T4N"),t=e.countries.length;let s;for(let a=0;a<t;a++)s=e.countries[a],this.data.push(s),this.countryCodeMap.set(s.country_code,a),this.ISOCodeMap.set(s.iso_country_code,a)}};var Se=function(e){const{onClickToS:t}=e;return o.a.createElement("div",{key:"tos",className:"tos-agreement"},o.a.createElement(u.a,{textKey:"STR_TOS_TEXT_FIRST"}),o.a.createElement(u.a,{className:"term-link",onClick:t,textKey:"STR_TOS_TEXT_SECOND"}),o.a.createElement(u.a,{textKey:"STR_TOS_TEXT_THIRD"}))};var Ie=function(e){const{checked:t,className:a,content:s,contentRenderer:n,id:i,onCheck:r,shape:c="square"}=e;return o.a.createElement("div",{className:Object(T.a)("w-100 flx flx-al-c",a)},o.a.createElement("div",{className:"flx-centralized mr-8"},o.a.createElement(ue.a,{checked:t,onChange:e=>{"function"==typeof r&&r(e,i,s)},shape:c})),o.a.createElement("div",null,n||o.a.createElement("div",{className:"flx flx-al-c"},s)))},Oe=a("dbb5");function ye(e){const t=e[Object(Oe.a)()];if(!t)return o.a.createElement(o.a.Fragment,null);let a;if(t.args){const e=[];let s=t.text;for(let a=0;a<t.args.length;a++){const n=t.args[a],i=t.urls&&t.urls[a];let r;r=i?o.a.createElement("a",{className:"cursor-pointer",href:i,target:"_blank"},n):o.a.createElement("span",null,n);const c=s.indexOf(`$${a}$`),l=s.slice(0,c);e.push(o.a.createElement("span",null,l)),e.push(r),s=s.slice(c+`$${a}$`.length)}s&&e.push(o.a.createElement("span",null,s)),a=o.a.createElement(o.a.Fragment,null,e)}else a=o.a.createElement("span",null,t.text);return o.a.createElement("div",null,a)}function be(e){const{terms:t=[],onCheck:a}=e;return o.a.createElement(o.a.Fragment,null,t.map(((e,t)=>null==e?null:o.a.createElement(Ie,{key:e.id,className:Object(T.a)(0!==t&&"mt-8"),contentRenderer:ye(e.content),id:e.id,onCheck:a}))))}var ve=function(e){var t;const{className:a,onTickChanged:s,termsOfServiceData:n}=e,i=o.a.useRef({});return o.a.createElement("div",{className:Object(T.a)("w-100",a)},o.a.createElement("div",null,J.default.str("STR_TOS_AGREEMENTS")),o.a.createElement("div",{className:"mt-16"},o.a.createElement(be,{onCheck:(e,t)=>{if(i.current[t]=e,"function"==typeof s){var a;let e;const t="string"==typeof(null===(a=n.GDPR)||void 0===a?void 0:a.required)&&n.GDPR.required.split("-");if(t)for(let a=0;a<t.length;a++){if(!i.current.hasOwnProperty(t[a])||!i.current[t[a]]){e=!1;break}e=!0}s(Object(d.a)({},i.current),e)}},terms:null===(t=n.GDPR)||void 0===t?void 0:t.terms})))};const Pe=Te.ModuleContainer.resolve(ge.ZLoggerFactory).createZLogger("login",["register"]),Ae="SMS",Le="VOICE";let we,Me,ke;const xe=new class{check(e,t){var a,s,n;if(null!==(a=this.cachePhone)&&void 0!==a&&a.hasOwnProperty(e)&&(null===(s=this.cachePhone[e])||void 0===s?void 0:s.iso)===t)return null===(n=this.cachePhone[e])||void 0===n?void 0:n.error;return null}pushCachePhone(e,t,a){this.cachePhone||(this.cachePhone={}),this.cachePhone[e]={phone:e,iso:t,error:a}}removeCachePhone(e){this.cachePhone&&delete this.cachePhone[e]}},De=1,Ue=2,Ge=3,qe=4,Fe=0,Ke=1,We=2,je=1,Qe=2;class Be extends o.a.Component{constructor(e){super(e),this.setCaptchaImage=(e,t)=>{this.prevCaptchaImage=this.state.captchaImg,e?this.setState({captchaImg:e,errorMessage:t||J.default.str("STR_ERR_NEED_INPUT_CAPTCHA")}):this.setState({captchaImg:null})},this.showSendOTPConfirmPopup=e=>{if(!this.props.dispatch)return;const{countryCode:t,phoneNumber:a}=e;this.props.dispatch({type:D,payload:{message:J.default.trans("STR_CONFIRM_OTP_TEXT",[t,a]),callback:e=>{e&&this._getActiveCode()},confirmText:J.default.str("STR_CONFIRM"),cancelText:J.default.str("STR_CLOSE")}})},this.verifyPhoneNumber=()=>{this.setState({errorMessage:null});const e=s.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode);if(!e)return!1;this.setBlocking(!1),this.__checkInvalidPhone(e,this.state.countryIsoCode)||this.callVerifyPhoneNumber(e)},this.callVerifyPhoneNumber=e=>{this.setBlocking(!0);const t=this.state.activeType===R.ACTIVE_TYPE_LOGIN?R.ACTIVE_TYPE_REGISTER:this.state.activeType,a={context:Qe,captchaToken:this.captchaToken,captchaAnswer:this.state.captchaAnswer};E.default.verifyPhoneNumberV2(this.imei,e,this.state.countryIsoCode,t,a).then((t=>{this.setBlocking(!1);const{data:a}=t;Pe.zsymb(21,"C2tn71",["verifyPhoneNumber V2 success {}","JstzvG"],a),this.handleVerifyPhoneNumberSuccess(R.ACTIVE_TYPE_LOGIN,Object(d.a)(Object(d.a)({},a),{},{phoneNumber:e,countryCode:this.state.countryCode}))})).catch((e=>{this.setBlocking(!1),Pe.zsymb(21,"Gxh0Wg",["verifyPhoneNumber {}","rVF2CU"],e),this._handleError(e)}))},this.handleVerifyPhoneNumberSuccess=(e,t)=>{if(!t)return;this.state.captchaImg&&this.setCaptchaImage(null);const{quota_info:a,manual_sms:s,phone_id:n}=t;a&&(this.verifyTypes=a.filter((e=>"ZALO"!==e.type))||[]),null!=s&&s.hint&&this.setManualSmsHint(s.hint),n&&(this.encryptedPhoneData={phoneNumber:t.phoneNumber,phoneId:t.phone_id});const{activated:o}=t;e===R.ACTIVE_TYPE_REGISTER?o?(W(j.SIGNUP_STEP_EXIST_ACCOUNT),this.setState({errorMessage:J.default.str("STR_ERROR_EXISTING_ACCOUNT")})):(t.terms_of_services&&this.setTermsOfService(t.terms_of_services),this.setState({reviewPhoneNum:!0,errorMessage:null})):o?this.showSendOTPConfirmPopup(t):this.setState({errorMessage:J.default.str("STR_SIGNIN_ERROR_UNKNOWN_PHONE_NUMBER")})},this.onAnswerSeqSuccess=()=>{this.setState({step:qe})},this.onBackToLoginPassword=()=>{this.props.dispatch({type:A})},this.onBackToPhoneValidation=e=>{this.setState({step:De,errorMessage:e})},this.onToSTickChanged=(e,t)=>{t!==this.state.isToSRequirementsMet&&this.setState({isToSRequirementsMet:t})},this.dispatch=e.dispatch;let t=this.props.lastData;this.state={step:De,countryCode:e.activeType===R.ACTIVE_TYPE_LOGIN&&e.countryCode||ke||84,countryIsoCode:e.activeType===R.ACTIVE_TYPE_LOGIN&&e.countryIsoCode||Me||"VN",phoneNumber:e.activeType===R.ACTIVE_TYPE_LOGIN&&e.phoneNumber||we||"",activeCode:"",infoMessage:null,errorMessage:null,captchaImg:"",captchaAnswer:"",activeType:e.activeType,cooldown:0,facebookAvatar:"",reviewPhoneNum:!1,enableChangePW:!1,blocking:!1,newPassword:"",rules:null,blockSubmitOTP:!1,otpScreen:Fe,isToSRequirementsMet:!1},t?(this.passwordInvalid=t.passwordInvalid,this.state.phoneNumber=t.phone,this.state.countryCode=t.countryCode,this.state.countryIsoCode=t.countryIsoCode,this.passwordInvalidName=t.displayName):(this.passwordInvalid=!1,this.passwordInvalidName=""),this.verifyType=this.props.verifyType&&this.props.verifyType.length>0?this.props.verifyType:null,this.captchaToken=null,this.rateLimited=!1,this.manualSmsHint=null,this.verifyTypes=this.props.verifyTypes?this.props.verifyTypes:[],this.imei=E.default.getZaloClientID(),this.newStep=!0,this.encryptedPhoneData={phoneNumber:"",phoneId:""},this.termsOfServiceData=null,this._confirmGetActiveCode=this._confirmGetActiveCode.bind(this),this._getActiveCode=this._getActiveCode.bind(this),this._validateActiveCode=this._validateActiveCode.bind(this),this._handlePhoneNumberChange=this._handlePhoneNumberChange.bind(this),this._handleCaptchaAnswerChange=this._handleCaptchaAnswerChange.bind(this),this._handleError=this._handleError.bind(this),this._onLoginSuccesss=this._onLoginSuccesss.bind(this),this._getLoginCaptcha=this._getLoginCaptcha.bind(this),this._onInputType=this._onInputType.bind(this),this._cooldown=this._cooldown.bind(this),this._showTermsOfService=this._showTermsOfService.bind(this),this.allowSendActiveCodeTimestamp=0}componentWillMount(){this.state.activeType===R.ACTIVE_TYPE_REGISTER?W(j.SIGNUP_STEP_INPUT_NUMBER):this.state.activeType===R.ACTIVE_TYPE_LOGIN&&W(j.FORGOT_STEP_INPUT_NUMBER),s.default.getPasswordRules(this.imei,m.default).then((e=>{this.setState({rules:e})})).catch((e=>{}))}componentWillReceiveProps(e){e.activeType!==this.state.activeType&&(e.activeType===R.ACTIVE_TYPE_REGISTER?W(j.SIGNUP_STEP_INPUT_NUMBER):e.activeType===R.ACTIVE_TYPE_LOGIN&&W(j.FORGOT_STEP_INPUT_NUMBER),this.setState({activeType:e.activeType})),e.lastData&&e.lastData!==this.props.lastData&&e.lastData.questionData&&this.setState({questionData:e.lastData.questionData})}componentWillUnmount(){this.unmounted=!0,this.state.activeType===R.ACTIVE_TYPE_REGISTER&&(we=this.state.phoneNumber,Me=this.state.countryIsoCode,ke=this.state.countryCode)}handleErrorRejectOTPOnStrangeDevice(e){let t;if(this.verifyType=null,e.data.manual_sms){const a=e.data.manual_sms;t=this.state.otpScreen===Ke?a.error&&a.instruction&&`${a.error} ${a.instruction}`:a.hint&&a.instruction&&`${a.hint} ${a.instruction}`}t&&this.setManualSmsHint(t);let a=null;this.state.step===Ue&&(a=e.errorMessageLocalize),this.setState({otpScreen:We}),this._showActiveCodeRequestLimitMessage(a)}handleCaptchaErrors(e){const{data:t,errorCode:a,errorMessageLocalize:s}=e;var n;(this.state.activeType===R.ACTIVE_TYPE_REGISTER?W(j.SIGNUP_STEP_INPUT_NUMBER_NEED_CAPTCHA):this.state.activeType===R.ACTIVE_TYPE_LOGIN&&W(j.FORGOT_STEP_INPUT_NUMBER_NEED_CAPTCHA),a===ie.a.CAPTCHA_REQUIRED)?t&&(this.captchaToken=(null===(n=t.captcha)||void 0===n?void 0:n.token)||null,this.setCaptchaImage("data:image/png;base64,"+t.captcha.captcha_img,s)):(this.prevCaptchaImage&&!this.state.captchaImg&&this.setCaptchaImage(this.prevCaptchaImage),this.setState({errorMessage:s}))}handleTopLevelError(e){if(e.errorCode===ie.a.REQUIRE_LOGIN_QR){const t={};return e.data&&(t.data=e.data),e.errorMessageLocalize&&(t.errorMessage=e.errorMessageLocalize),this.props.dispatch({type:P,payload:t})}if(e.errorCode===ie.a.OUT_OF_SECQ_QUOTA)return this.props.dispatch({type:P,payload:{errorMessage:re(e)}})}_handleError(e){const t=Object(oe.a)(e);if(0===t.errorCode)return Pe.zsymb(18,"1GY32-",e);if(this.handleTopLevelError(t),t.errorCode===ie.a.REJECTED_OTP)return this.handleErrorRejectOTPOnStrangeDevice(t);if(t.errorCode===ie.a.INVALID_CAPTCHA||t.errorCode===ie.a.CAPTCHA_EXPIRED||t.errorCode===ie.a.CAPTCHA_REQUIRED||t.errorCode===ie.a.CAPTCHA_RETRY_RATE_LIMIT_EXCEEDED)return this.handleCaptchaErrors(t);let a=re(t);if(t.errorCode===Y&&(this.setState({blockSubmitOTP:!0}),this._blockOTPTimer&&clearTimeout(this._blockOTPTimer),this._blockOTPTimer=setTimeout((()=>{this.setState({blockSubmitOTP:!1})}),9e5)),t.errorCode!==ie.a.INVALID_PARAM||this.state.step!==De||this.state.captchaImg||(a=J.default.str("STR_SIGNIN_ERROR_INVALID_PHONE_NUMBER")),a||(a=t.code===R.NetWorkError.NO_NETWORK?J.default.str("STR_SIGNIN_ERROR_NO_NETWORK"):`Error: ${t.errorCode} - ${t.errorMessage}`),t&&t.blocking_time_left){let e=Math.round(t.blocking_time_left/1e3);const s=Math.floor(e/60);e-=60*s,a=`${a} ${J.default.str("STR_RETRY_AFTER")} ${s?s+` ${J.default.str("STR_MINS")} `:""}${e} ${J.default.str("STR_SECONDS")}.`}this.setState({errorMessage:a})}_verifyPhoneNumber(e=!1,t=!1){if(this.verifyType)return this._getActiveCode();const a=s.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode);if(!a)return!1;this.setBlocking(!1),this.__checkInvalidPhone(a,this.state.countryIsoCode)||(this.setState({errorMessage:null}),this.props.dispatch({type:D,payload:{message:J.default.trans("STR_CONFIRM_OTP_TEXT",[this.state.countryCode,a]),callback:t=>{this.props.dispatch({type:D}),t?this.callVerifyPhoneNumber(a):(this.newStep=!0,e||this.onRegisterBack())},confirmText:e?J.default.str("STR_CONFIRM"):J.default.str("STR_SIGNIN_REGISTER"),cancelText:e&&!0!==t?J.default.str("STR_CLOSE"):J.default.str("STR_LATER")}}))}__showInvalidPhoneErrorCode(){setTimeout((()=>{this.setState({errorMessage:J.default.str("STR_SIGNIN_ERROR_INVALID_PHONE_NUMBER"),blocking:!1})}),300)}__checkInvalidPhone(e,t){let a=xe.check(e,t);return 18025===(null==a?void 0:a.error_code)&&(this.setState({blocking:!0,errorMessage:null}),this.__showInvalidPhoneErrorCode(),a)}_updateVerifyType(){this.verifyTypes=this.verifyTypes.filter((e=>e.quota)).sort(((e,t)=>e.priority-t.priority)),this.verifyTypes.length?this.verifyType=this.verifyTypes[0].type:this.verifyType=null}_canSubmitGetActiveCode(){return!!s.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode)&&(!this.captchaToken||this.state.captchaAnswer&&this.state.captchaAnswer.length>3)}_confirmGetActiveCode(){this.props.dispatch({type:D,payload:{title:"Zalo",message:J.default.str("STR_RESEND_ACTIVATION_CODE_CONFIRM"),compact:!0,confirmText:J.default.str("STR_CONFIRM"),cancelText:J.default.str("STR_CANCEL"),callback:e=>{this.props.dispatch({type:D}),e?this._getActiveCode():this.newStep=!0}}})}_cooldown(){if(this.unmounted)return;const e=this.state.cooldown-1;this.setState({cooldown:e}),e>0&&setTimeout(this._cooldown,1e3)}_showActiveCodeRequestLimitMessage(e){this.rateLimited=!0,this.newStep=!0,this.setState({infoMessage:this.manualSmsHint,errorMessage:null!=e?e:null,step:Ue}),this.state.activeType===R.ACTIVE_TYPE_REGISTER?W(j.SIGNUP_STEP_WAIT_MANUAL_CODE):this.state.activeType===R.ACTIVE_TYPE_LOGIN&&W(j.FORGOT_STEP_WAIT_MANUAL_CODE)}setManualSmsHint(e){this.manualSmsHint=e}async _getActiveCode(){if(this.state.blocking)return;if(this.saveUserToSConfirmedData(),this.setState({errorMessage:null}),!this._canSubmitGetActiveCode())return;const e=this.state.activeType;if(this._updateVerifyType(),!this.verifyType){let t=!0;if(e===R.ACTIVE_TYPE_LOGIN&&this.encryptedPhoneData.phoneNumber===this.state.phoneNumber&&this.encryptedPhoneData.phoneId)try{const e={context:Qe},a=await E.default.verifyPhoneExtra(this.encryptedPhoneData.phoneId,e);if(a){const{data:e}=a;e&&e.hasOwnProperty("allowOTP")&&!e.allowOTP&&(t=!1)}}catch(n){Pe.zsymb(21,"51uKoN",["verify phone extra {}","-vQHnQ"],n)}if(t)return this._showActiveCodeRequestLimitMessage()}if(e===R.ACTIVE_TYPE_REGISTER)switch(this.verifyType){case Ae:W(j.SIGNUP_STEP_WAIT_SMS_CODE);break;case Le:W(j.SIGNUP_STEP_WAIT_CALL_CODE)}else if(e===R.ACTIVE_TYPE_LOGIN)switch(this.verifyType){case Ae:W(j.FORGOT_STEP_WAIT_SMS_CODE);break;case Le:W(j.FORGOT_STEP_WAIT_CALL_CODE)}const t=s.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode);this.setBlocking(!0);const a={context:e===R.ACTIVE_TYPE_REGISTER?je:Qe};E.default.getActiveCode(this.imei,t,this.state.countryIsoCode,this.verifyType||"SMS",this.captchaToken,this.state.captchaAnswer,this.state.activeType,a).then((()=>{this.setBlocking(!1),this.newStep=!0,this.setState({step:Ue,otpScreen:Ke,errorMessage:null,cooldown:10}),setTimeout(this._cooldown,1e3),this.verifyTypes[0].quota--})).catch((e=>{this.setBlocking(!1),this._handleError(e)}))}_canSubmitValidateActiveCode(){const e=this.state.activeCode;return!this.state.blockSubmitOTP&&e&&6===e.length}_onChangePassword(){if(this.state.blocking)return;let e=this.pwRef.value,t=this.repeatPwRef.value;if(t!==e)return void this.setState({errorMessage:J.default.str("STR_CONFORM_PW_NOT_MATCH")});this.setBlocking(!0);let{activeType:a,phoneNumber:s,countryIsoCode:n,countryCode:o}=this.state;a!==R.ACTIVE_TYPE_REGISTER?E.default.loginByResetPassword(s,this.imei,e,t,this.authToken,"+07:00",o,n,J.default.getCurrentLanguageName()).then((e=>{try{Pe.zsymb(21,"7nrGio",["loginByResetPassword success {}","7cxod9"],e)}catch(t){}Ee.default.getInstance().removeItem("FORGOT_PASSWORD"),this.setBlocking(!1),this._onLoginSuccesss()})).catch((e=>{try{Pe.zsymb(21,"Kw4GzH",["loginByResetPassword err","ZK4BET"],JSON.stringify(e))}catch(t){}this.setBlocking(!1),this._handleError(e)})):E.default.signUpWithPassword(s,n,e,t,this.imei,this.authToken,"+07:00",J.default.getCurrentLanguageName()).then((e=>{this.setBlocking(!1),this._onLoginSuccesss()})).catch((e=>{this.setBlocking(!1),this._handleError(e)}))}_validateActiveCode(){if(this.state.blocking)return;this.setState({errorMessage:null});const e=this.state.phoneNumber,t=this.state.activeCode;if(!this._canSubmitValidateActiveCode())return;const a=Date.now();if(this.allowSendActiveCodeTimestamp>a)return void this._handleError({error_code:18012,data:{blocking_time_left:this.allowSendActiveCodeTimestamp-a}});W(j.LOGIN_STEP_SUBMIT_OTP);let n=this.state.activeType===R.ACTIVE_TYPE_LOGIN;this.setBlocking(!0),E.default.validateActiveCode(this.imei,e,this.state.countryIsoCode,this.state.countryCode,t,"+07:00",this.state.activeType,n).then((e=>{this.setBlocking(!1);const{data:t}=e||{};if(t&&(t.token&&(this.authToken=t.token),t.enk&&s.default.setDecryptKey(t.enk),1===t.requireSEQ))return this.showSecurityQuestions(t.question);this.onShowUpdatePwState()})).catch((e=>{this.setBlocking(!1),e&&e.data&&e.data.blocking_time_left&&(this.allowSendActiveCodeTimestamp=Date.now()+e.data.blocking_time_left),this._handleError(e)}))}_onLoginSuccesss(){f()}_handlePhoneNumberChange(e){this.verifyType&&(this.verifyType=null),this.setState({countryCode:e.countryCode,countryIsoCode:e.countryIsoCode,phoneNumber:e.phoneNumber,errorMessage:null})}_handleCaptchaAnswerChange(e){this.setState({captchaAnswer:e.target.value,errorMessage:null})}_getLoginCaptcha(){m.default.getLoginCaptcha(E.default.getZaloClientID()).then((e=>{0===e.data.error_code&&(this.captchaToken=e.data.data.token,this.setState({captchaImg:"data:image/png;base64,"+e.data.data.captcha_img}))})).catch((e=>{Pe.zsymb(21,"CXat5v",["_getLoginCaptcha error {}","wJkhOP"],e)}))}checkNumberKey(e){let t=e.keyCode;return t>47&&t<58||t>95&&t<112}checkPrintableKey(e){let t=e.keyCode;return this.checkNumberKey(e)||32==t||t>64&&t<91||t>185&&t<193||t>218&&t<223}_onInputType(e){if(13===e.which)this.state.step!==De||this.state.activeType!==R.ACTIVE_TYPE_LOGIN||this.passwordInvalid?this.state.step===Ue?this._validateActiveCode():this.state.reviewPhoneNum||this.firstVerifyPhoneNumber():this.verifyPhoneNumber();else if(this.state.step===Ue){let t=this.state.activeCode,a=e.target.selectionStart!==e.target.selectionEnd;if(!this.checkPrintableKey(e))return;this.checkNumberKey(e)?a||t.length>6&&(e.preventDefault(),e.stopPropagation()):(e.preventDefault(),e.stopPropagation())}}_showTermsOfService(e){e.preventDefault(),e.stopPropagation(),window.open("http://zalo.me/zalo/dieukhoan/")}isBackLogin(){return this.state.reviewPhoneNum&&this.state.step===De}onRegisterBack(e=!1){const t=()=>{this.isBackLogin()?this.setState({reviewPhoneNum:!1,errorMessage:""}):this.props.onLogin&&this.props.onLogin(),this.props.dispatch({type:G})};this.state.step!==qe?(this.resetTermsOfService(),t()):this.props.dispatch({type:D,payload:{message:J.default.str(e?"STR_DISCARD_RESET_PW":"STR_DISCARD_REGISTER"),callback:e=>{e?t():this.props.dispatch({type:D})},confirmText:J.default.str("STR_CONFIRM"),cancelText:J.default.str("STR_CLOSE")}})}showSecurityQuestions(e){this.setState({step:Ge,questionData:e,errorMessage:null})}onShowUpdatePwState(){this.setState({step:qe,errorMessage:null})}onInputChangePW(e){let t=this.pwRef.value,a=this.repeatPwRef.value,n=s.default.checkValidPassword(t,"",this.state.rules||[]),o=s.default.checkValidPassword(a,t,this.state.rules||[]),i=!!t&&!!a&&o;this.passwordCheckingMsg=n?i?"":"STR_PASSWORD_DONT_MATCH":"STR_INVALID_PW",this.setState({enableChangePW:i,errorMessage:null,newPassword:t})}firstVerifyPhoneNumber(){if(this.state.blocking)return;this.setState({errorMessage:null});let e=s.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode);if(this.__checkInvalidPhone(this.state.phoneNumber,this.state.countryIsoCode))return;if(!e)return xe.pushCachePhone(this.state.phoneNumber,this.state.countryIsoCode,{error_code:18025}),void this.__showInvalidPhoneErrorCode();this.setBlocking(!0);const t={context:je,captchaToken:this.captchaToken,captchaAnswer:this.state.captchaAnswer};E.default.verifyPhoneNumberV2(this.imei,e,this.state.countryIsoCode,R.ACTIVE_TYPE_REGISTER,t).then((e=>{this.setBlocking(!1);const{data:t}=e;Pe.zsymb(3,"_UKZJO",["first verifyPhoneNumberV2 success {}","OJKpvV"],t),this.handleVerifyPhoneNumberSuccess(R.ACTIVE_TYPE_REGISTER,t)})).catch((e=>{this.setBlocking(!1),Pe.zsymb(3,"BL0WME",["first verifyPhoneNumberV2 {}","BunA00"],e),this._handleError(e)}))}setBlocking(e=!0){this.setState({blocking:e})}isToSRequirementsMet(){return!this.termsOfServiceData||this.state.isToSRequirementsMet}setTermsOfService(e){this.termsOfServiceData=e}resetTermsOfService(){this.termsOfServiceData=null,this.setState({isToSRequirementsMet:!1})}saveUserToSConfirmedData(){if(this.termsOfServiceData&&this.state.isToSRequirementsMet){const{GDPR:e}=this.termsOfServiceData;if(e&&e.data){const t=Re(this.state.phoneNumber,Ce.getIsoCodeFromCountryCode(this.state.countryCode));let a=`+${t.getCountryCode()}${t.getPhone()}`;Ee.default.getInstance().setItem(R.RegisterLocalStorageKeys.TOS_CONFIRMED_DATA,JSON.stringify(Object(d.a)(Object(d.a)({},e.data),{},{phoneNumber:a})))}}}render(){let e=null;const t=e=>{const{fgPage:t}=e;return o.a.createElement("div",{className:"footer-btn"},o.a.createElement(te.a,{type:"tertiary-neutral",onClick:e=>this.onRegisterBack(t),size:"medium",textKey:"STR_CANCEL"}))};let a,s;this.state.captchaImg&&(s=o.a.createElement("div",{className:"z-input flx-1"},o.a.createElement(ee.a,{required:!0,textKey:"STR_INPUT_CAPTCHA",className:"login-pass__group__captcha",inputRef:e=>{e&&this.newStep&&this.verifyType&&(e.focus(),this.newStep=!1)},name:"captcha",type:"text",maxLength:"16",value:this.state.captchaAnswer,onChange:this._handleCaptchaAnswerChange,onKeyPress:this._onInputType})),a=o.a.createElement("div",{className:"login-pass__group flx captcha-section w100 flx flx-al-c"},s,o.a.createElement("div",{id:"captcha",className:"login-pass__captcha flx flx-al-c"},o.a.createElement("img",{src:this.state.captchaImg,alt:"captcha"}),o.a.createElement("div",{className:"dib login-pass__captcha__refresh"},o.a.createElement("i",{className:"fa fa-reload btn",onClick:this._getLoginCaptcha})))));let n={marginTop:"24px",width:"100%"};if(this.state.step===De){let s,i=null,r=null,c=null,l=o.a.createElement(u.a,{textKey:"STR_CREATE_NEW_ACCOUNT",tagName:"div",className:"register-title"}),h=this.passwordInvalid||this._canSubmitGetActiveCode(),d=null;if(this.state.activeType===R.ACTIVE_TYPE_LOGIN?this.passwordInvalid?s=o.a.createElement("p",null,o.a.createElement(u.a,{textKey:"STR_HI"})," ",o.a.createElement("strong",null,this.passwordInvalidName),", ",o.a.createElement(u.a,{textKey:"STR_INVALID_PASSWORD_MESSAGE"})):(i=o.a.createElement(u.a,{textKey:"STR_ENTER_PHONE_FOR_ACTIVATION_CODE",tagName:"div",className:"register-desc"}),l=o.a.createElement(u.a,{textKey:"STR_PASSWORD_RECOVERY",tagName:"div",className:"register-title"}),d=o.a.createElement(te.a,{size:"large",textKey:"STR_CONTINUE",onClick:()=>this.verifyPhoneNumber(),disabled:!h||this.state.blocking,style:n,loading:this.state.blocking})):this.state.reviewPhoneNum&&(this.termsOfServiceData?(c=o.a.createElement(ve,{className:"mt-16",onTickChanged:this.onToSTickChanged,termsOfServiceData:this.termsOfServiceData}),h=h&&this.isToSRequirementsMet(),a&&(n.marginTop="16px")):c=o.a.createElement(Se,{onClickToS:this._showTermsOfService})),!d)if(this.state.reviewPhoneNum)d=o.a.createElement(te.a,{disabled:!h||this.state.blocking,format:"full-width",loading:this.state.blocking,onClick:()=>this._getActiveCode(),size:"large",style:n,textKey:this.state.activeType===R.ACTIVE_TYPE_REGISTER?"STR_REGISTER_NEW_ACCOUNT":"STR_CONTINUE"});else{let e=!0,t=6;84===this.state.countryCode&&(t=9),(this.state.blocking||!this.state.phoneNumber||this.state.phoneNumber.length<t)&&(e=!1),d=o.a.createElement(te.a,{size:"large",textKey:"STR_CONTINUE",onClick:e=>this.firstVerifyPhoneNumber(),disabled:!e,style:n,loading:this.state.blocking})}e=o.a.createElement("div",{className:"login-pass reg-padding flx flx-1 flx-col flx-al-c "+(this.state.activeType===R.ACTIVE_TYPE_LOGIN?" register-page":"")},o.a.createElement("img",{src:ne,className:"sign-in-logo"}),l,i||o.a.createElement(u.a,{textKey:this.state.reviewPhoneNum?"STR_REVIEW_REGISTER_PHONE_NUMBER":"STR_CREATE_ACCOUNT_CONFIRM_TXT",tagName:"div",className:"register-desc"}),this.state.activeType!==R.ACTIVE_TYPE_REGISTER?this.passwordInvalid?o.a.createElement("img",{src:se,style:{marginTop:"20px",marginBottom:"32x"}}):"":null,r,s&&o.a.createElement("div",{style:{marginTop:r?"":"34px"},className:"info-message"},s),!this.passwordInvalid&&(this.state.reviewPhoneNum?o.a.createElement(fe,{ISOCode:Ce.getIsoCodeFromCountryCode(this.state.countryCode),phoneNumber:this.state.phoneNumber}):o.a.createElement(N.a,{ref:e=>this._phoneInput=e,onKeyPress:this._onInputType,inputRef:e=>{e&&this.newStep&&!this.verifyType&&(e.focus(),this.newStep=!1)},value:this.state.phoneNumber,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode,onChange:this._handlePhoneNumberChange,phoneNumber:this.state.phoneNumber,borderBottomOnly:!0})),c,a,this.state.errorMessage?o.a.createElement("div",{className:"error-message",style:{minHeight:"40px"}},this.state.errorMessage):null,d,o.a.createElement("div",{className:"flx-1"}),o.a.createElement(t,{fgPage:!1}))}else if(this.state.step===Ue){let a=null;switch(this.verifyType){case"ZALO":a=o.a.createElement(u.a,{textKey:"STR_VERIFY_ZALO",className:"reg-active-code-desc",tagName:"div"});break;case"SMS":a=o.a.createElement("div",{className:"reg-active-code-desc"},o.a.createElement(u.a,{textKey:"STR_VERIFY_ACCOUNT_DESC"})," ",o.a.createElement("span",{className:"act-phone-num"},"(+",this.state.countryCode,") ",this.state.phoneNumber));break;case"VOICE":a=o.a.createElement(u.a,{textKey:"STR_VERIFY_CALL",className:"reg-active-code-desc",tagName:"div"});break;default:a=o.a.createElement("div",{className:"reg-active-code-desc"},this.state.infoMessage)}const s=this._canSubmitValidateActiveCode();e=o.a.createElement("div",{className:"login-pass reg-padding flx flx-1 flx-col flx-al-c"},o.a.createElement("img",{src:ne,className:"sign-in-logo"}),o.a.createElement(u.a,{textKey:"STR_VERIFY_ACCOUNT",tagName:"div",className:"register-title"}),this.passwordInvalid?o.a.createElement("img",{src:se,style:{marginTop:"20px",marginBottom:"12px"}}):"",a,o.a.createElement("div",{className:"error-message",style:{marginBottom:"0",marginTop:"16px"}},this.state.errorMessage),o.a.createElement("div",{className:"z-input w100",id:"regActiveCode",onClick:()=>{this.activeCodeRef&&this.activeCodeRef.focus()}},o.a.createElement("input",{required:!0,ref:e=>{e&&this.newStep&&(e.focus(),this.newStep=!1),this.activeCodeRef=e},disabled:this.state.blockSubmitOTP,name:"activecode",className:"active-code-v2",type:"text",onKeyDown:this._onInputType,onChange:e=>{var t;this.setState({activeCode:(null===(t=e.target)||void 0===t?void 0:t.value)||"",errorMessage:null})},placeholder:J.default.str("STR_ACTIVATION_CODE"),maxLength:6})),o.a.createElement(te.a,{textKey:"STR_CONTINUE",size:"large",onClick:this._validateActiveCode,disabled:!s||this.state.blocking,style:{marginTop:"28px",width:"100%"},loading:this.state.blocking}),this.state.cooldown>0&&o.a.createElement("div",{style:{color:"var(--text-primary)"},className:"reg-act-resend-spacing"},o.a.createElement(u.a,{textKey:"STR_ACTIVATION_CODE_TEXT",style:{marginRight:"5px"}}),this.state.cooldown,o.a.createElement(u.a,{textKey:"STR_SECOND",style:{marginLeft:"5px"}}),"."),!this.rateLimited&&!this.state.cooldown&&o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{textKey:"STR_NOT_RECEIVE_ACTIVE_CODE",className:"reg-active-code-desc reg-act-resend-spacing"}),o.a.createElement(te.a,{textKey:"STR_RESEND_CODE",onClick:this._confirmGetActiveCode,type:"tertiary-primary",icon:"outline-reload",className:"reg-act-resend-spacing",disabled:this.state.blocking})),o.a.createElement("div",{className:"flx-1"}),o.a.createElement(t,{fgPage:!1}))}else if(this.state.step===Ge){const t={userData:{phone:this.state.phoneNumber,token:this.authToken,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode},questionData:this.state.questionData};e=o.a.createElement(me,{data:t,dispatch:this.props.dispatch,onAnswerSuccess:this.onAnswerSeqSuccess,onBack:this.onBackToLoginPassword,onBackToPhoneValidation:this.onBackToPhoneValidation})}else this.state.step===qe&&(e=o.a.createElement("div",{className:"login-pass reg-padding flx flx-1 flx-col flx-al-c register-page"},o.a.createElement("img",{src:ne,className:"sign-in-logo"}),o.a.createElement(u.a,{textKey:3===this.state.activeType?"STR_UPDATE_LOGIN_PASSWORD":"STR_CREATE_LOGIN_PASSWORD",tagName:"div",className:"register-title"}),o.a.createElement("div",{style:{marginTop:"12px"}},o.a.createElement(u.a,{textKey:"STR_NOTE",className:"bold"}),"Â ",o.a.createElement(u.a,{textKey:"STR_CREATE_NEW_PW_DESCRIPTION",className:"info-message"})),o.a.createElement(ae.a,{textKey:"STR_NEW_PASSWORD",inputRef:e=>this.pwRef=e,domRef:this.pwRef,className:"w100 flx-init",style:{marginTop:"20px"},onChange:this.onInputChangePW.bind(this),onKeyPress:e=>{13===(null==e?void 0:e.which)&&(this._onChangePassword(),e.stopPropagation())}}),o.a.createElement(ae.a,{textKey:"STR_CONFIRM_NEW_PASSWORD",inputRef:e=>this.repeatPwRef=e,domRef:this.repeatPwRef,className:"w100 flx-init",style:{marginTop:"16px"},onChange:this.onInputChangePW.bind(this),onKeyPress:e=>{13===(null==e?void 0:e.which)&&(this._onChangePassword(),e.stopPropagation())},compareValue:this.state.newPassword}),this.state.errorMessage?o.a.createElement("div",{className:"error-message",style:{marginBottom:"0",marginTop:"16px"}},this.state.errorMessage):null,o.a.createElement(te.a,{size:"large",textKey:"STR_CONFIRM",onClick:this._onChangePassword.bind(this),disabled:!this.state.enableChangePW||this.state.blocking,style:n,loading:this.state.blocking,title:this.passwordCheckingMsg}),o.a.createElement("div",{className:"flx-1"}),o.a.createElement(t,{fgPage:this.state.activeType!==R.ACTIVE_TYPE_REGISTER})));return e}}var Ve=Be,ze=a("qhFK"),He=a("bsME"),Ye=a("h0sc"),$e=a("MEZx"),Xe=a("iQAb"),Ze=a("3xbP");const Je={windowId:Ze.c,name:"LOGIN_PW_POPUP"};class et extends o.a.Component{constructor(e){super(e),this.resetErrorMessage=()=>{this._showErrorMessage("")},this.dispatch=e.dispatch,this.visibleComponentName=this.props.visibleComponentName,this.timeoutAutoReqCapcha=null;let t=e.recentdata,a={phoneNumber:e.state.phoneNumber,countryCode:e.state.countryCode,countryIsoCode:"VN",selectCountry:!1,avatar:null,timeout:0,confirmTimeout:0,showCaptcha:!1,enableRequestLogin:e.state.phoneNumber&&e.state.phoneNumber.length>=6,showRequestLoginTooltip:e.state.phoneNumber&&e.state.phoneNumber.length>=6,enablePasswordLogin:!1,showPopupLogin:!1,isRemember:e.isRemember,enableRetry:!1,showLoading:!1,blocking:!1,menuShown:!1};t&&(a.phoneNumber=t.phone,a.avatar=t.avatar,a.displayName=t.displayName,a.countryIsoCode=t.iso,a.countryCode=t.code,a.avatar&&(a.enableRequestLogin=!0,a.showRequestLoginTooltip=!0)),this.state=a,this.toFocus="phone",this.isLoginSuccess=!1,this.countLoginFail=0,this.getLoginCaptcha=this._getLoginCaptcha.bind(this),this._signIn=this._signIn.bind(this),this._onTypeCaptcha=this._onTypeCaptcha.bind(this),this._handlePhoneNumberChange=this._handlePhoneNumberChange.bind(this),this._handlePasswordChange=this._handlePasswordChange.bind(this),this._handleBackButtonClick=this._handleBackButtonClick.bind(this),this._handleCaptchaChange=this._handleCaptchaChange.bind(this)}componentWillMount(){this.state.avatar||this._getLoginCaptcha()}componentWillReceiveProps(e){if(this.props.state.phoneNumber!==e.state.phoneNumber&&this.setState({phoneNumber:e.state.phoneNumber}),this.props.recentdata!==e.recentdata&&this.props.recentdata&&!e.recentdata){const t={avatar:null,enablePasswordLogin:!1,enableRetry:!1,isRemember:e.isRemember};this._requireCaptcha?(t.showCaptcha=!0,t.showRequestLoginTooltip=!0,t.enableRequestLogin=!0):(t.showCaptcha=!1,t.phoneNumber="",t.countryIsoCode="VN",t.countryCode=84,t.showRequestLoginTooltip=!1,t.enableRequestLogin=!1),this.setState(t),this._getLoginCaptcha(),this.toFocus="phone",this._password&&(this._password.value="",this.setState({enablePasswordLogin:!1}))}else!this.props.isVisible&&e.isVisible?this._getLoginCaptcha():e!==this.props.isRemember&&this.setState({isRemember:e.isRemember})}componentDidMount(){Ye.ModalManagerV2.addModal(Je),Ye.ModalManagerV2.subscribeTriggers(Object(d.a)(Object(d.a)({},Je),{},{trigger:e=>{this.setState({showPopupLogin:e})}})),J.default.callUpdate(this.resetErrorMessage),this.setFocus()}componentWillUpdate(e){e.state.captchaToken||this.state.avatar||this._getLoginCaptcha()}componentDidUpdate(e){this.props.state.captchaImg!==e.state.captchaImg&&this._captcha&&document.activeElement!==this._captcha&&(this._captcha.value="")}componentWillUnmount(){Ye.ModalManagerV2.delModal(Je),J.default.removeUpdate(this.resetErrorMessage)}get Logger(){return this._Logger||(this._Logger=Te.ModuleContainer.resolve(ge.ZLoggerFactory).createZLogger("login",["login-pwd"])),this._Logger}_successLogin(){this.isLoginSuccess=!0,f()}_failLogin(e){2==this.countLoginFail?(this.countLoginFail=0,Ye.ModalManagerV2.openModal(Object(d.a)(Object(d.a)({},Je),{},{params:!0}))):this.countLoginFail++;let t=J.default.str("STR_SIGNIN_ERROR_INCORRECT_INFO"),a=!1;if("ERR_CONNECTION_TIMED_OUT"===e.error_code||"ERR_CONNECTION_TIMED_OUT"===e||"ERR_CONNECTION_TIMED_OUT"===e.code)t=J.default.str("STR_COMPOSE_TIP_69");else if(e.error_code){let s=re(e,this.state);s&&(t=s),a=18029===e.error_code,18017===e.error_code&&this._password&&(this._password.value="",this.setState({enablePasswordLogin:!1}))}this._showErrorMessage(t),this._getLoginCaptcha(!0),W(j.LOGIN_STEP_INPUT_INVALID_PHONE_PASS),a&&this.props.signInAnother&&(this._requireCaptcha=!0,this.props.signInAnother(!1),this.setState({showCaptcha:!0}))}_showErrorMessage(e){this.dispatch({type:S,payload:e})}_signIn(){const e=()=>{setTimeout((()=>{this.setState({blocking:!1})}),300)},t=Ee.default.getInstance();this.setState({blocking:!0},(()=>{"activeElement"in document&&document.activeElement.blur();const a=Date.now();if(this.lastSignIn&&a-this.lastSignIn<700)return void e();this.lastSignIn=a;const s=!this._captcha||!this._captcha.value;if(!this.state.phoneNumber){this.toFocus="phone",this._showErrorMessage(J.default.str("STR_SIGNIN_ERROR_EMPTY_PHONE"));let t=j.LOGIN_STEP_INPUT_EMPTY_INFO_PASS+"_Phone";return(!this._password.value||!this.state.avatar&&s)&&(this._password.value||this.state.avatar||!s?this._password.value?t+="Cap":t+="Pass":t+="AllEmpty"),W(t),void e()}if(!this._password.value){this.toFocus="password",this._showErrorMessage(J.default.str("STR_SIGNIN_ERROR_EMPTY_PASSWORD"));let e=j.LOGIN_STEP_INPUT_EMPTY_INFO_PASS+"_Pass";return s&&(e+="Cap"),void W(e)}if(!this.state.avatar&&s)return this.toFocus="captcha",this._showErrorMessage(J.default.str("STR_SIGNIN_ERROR_EMPTY_CAPTCHA")),W(j.LOGIN_STEP_INPUT_EMPTY_INFO_PASS+"_Cap"),void e();let n=E.default;const o=_.default.authDomain;W(j.LOGIN_STEP_LOGIN_PASS),n.loginWithPassword(this.state.phoneNumber,this._password.value,this.state.avatar?"":this._captcha?this._captcha.value:"",this.props.state.captchaToken,E.default.getZaloClientID(),0,null,{code:this.state.countryCode,iso:this.state.countryIsoCode}).then((()=>{t.removeItem("FORGOT_PASSWORD"),setTimeout((()=>{He.a.onSucess()}),0),this._successLogin()})).catch((a=>{if(this.Logger.zsymb(21,"FQjxb3",["signIn failed {}","LczplV"],a&&(a.error_code||a.code)||a),a){if("ERR_NO_NETWORK"===a.code)return setTimeout((()=>{He.a.onError("ERR_NO_NETWORK",o)}),0),this._showErrorMessage(J.default.str("STR_SIGNIN_ERROR_NO_NETWORK")),void e();if(a.error_code&&a.error_code===ie.a.SECURITY_QUESTION_REQUIRED&&a.data)setTimeout((()=>{He.a.onSucess()}),0),this.Logger.zsymb(3,"_s1DcV",["re security {}","NtAGvR"],a),a.data.cptch_cert&&t.setItem("captcha_cert",a.data.cptch_cert),this.dispatch({type:I,payload:{phone:this.state.phoneNumber,password:this._password?this._password.value:"",captcha:a.data.cptch_cert?null:this._captcha?this._captcha.value:"",captchaToken:a.data.cptch_cert?null:this.props.state.captchaToken,questionData:a.data,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode,eCode:a.error_code}});else if(a.error_code&&a.error_code===ie.a.PASSWORD_NOT_SET){setTimeout((()=>{He.a.onSucess()}),0);let e=this.state.phoneNumber;a.data&&a.data.display_name&&(e=String(a.data.display_name)),this.lastVisibleLoginComponentName=this.visibleComponentName,this.dispatch({type:L,payload:{phone:this.state.phoneNumber,captcha:this._captcha?this._captcha.value:"",captchaToken:this.props.state.captchaToken,passwordInvalid:!0,activeType:3,displayName:e,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode}})}else if(!a.error_code||a.error_code!==ie.a.OUT_OF_SECQ_QUOTA&&a.error_code!==ie.a.OUT_OF_SECQ_2_STEP_QUOTA)if(!a.error_code||a.error_code!==ie.a.SENSITIVE_FLOW_REQUIRE_OTP_OR_CONFIRM_MOBILE&&a.error_code!==ie.a.SENSITIVE_FLOW_REQUIRE_OTP)this._isRecycleSimOrChangedPhone(a)||this._failLogin(a);else{const e=a.data.cptch_cert?null:this.props.state.captchaToken,t=a.data.cptch_cert?null:this._captcha?this._captcha.value:"";this.props.dispatch({type:q,payload:{phone:this.state.phoneNumber,password:this._password?this._password.value:"",captchaAnswer:t,captchaToken:e,questionData:a.data,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode,eCode:a.error_code}})}else{const e=Object(oe.a)(a),t={};e.data&&(t.data=e.data),e.errorMessageLocalize&&(t.errorMessage=re(e)),this.props.dispatch({type:P,payload:t})}}e()}))}))}_getLoginCaptcha(e=!1){this.props.isVisible&&W(j.LOGIN_STEP_GET_CAPTCHA_PASS);const t=e=>{(e||this.props.isMaybeReq&&this.props.isMaybeReq(this.visibleComponentName)&&!this.timeoutAutoReqCapcha)&&(this.Logger.zsymb(3,"yWVHuX",["req capcha login","xdzvlD"]),e&&this.timeoutAutoReqCapcha&&(clearTimeout(this.timeoutAutoReqCapcha),this.timeoutAutoReqCapcha=null),m.default.getLoginCaptcha(E.default.getZaloClientID()).then((e=>{if(0==e.data.error_code)return this.props.isVisible&&W(j.LOGIN_STEP_READY_LOGIN_PASS),this.isLoginSuccess||(this.timeoutAutoReqCapcha=setTimeout((()=>{this.timeoutAutoReqCapcha=null,t()}),1e3*e.data.data.expiration_time)),this.dispatch({type:y,payload:e});this.props.isVisible&&W(j.LOGIN_STEP_ENTER_LOGIN_PASS)})).catch((e=>{this.props.isVisible&&W(j.LOGIN_STEP_ENTER_LOGIN_PASS),this.Logger.zsymb(21,"9MP6Ma",["getLoginCaptcha error {}","XgINcy"],e&&(e.error_code||e.code)||e)})))};t(e)}_toggleClass(e,t){e&&(e.className.indexOf(t)>=0?e.className=e.className.replace(t,""):e.className+=" "+t)}_handlePhoneNumberChange(e){this.setState({countryCode:e.countryCode,countryIsoCode:e.countryIsoCode,phoneNumber:e.phoneNumber,enableRequestLogin:e.phoneNumber.length>=6,showRequestLoginTooltip:e.phoneNumber.length>=6&&(!this._password||this._password.value.length<6),enablePasswordLogin:e.phoneNumber.length>=6&&this._password&&this._password.value.length>=3&&this._captcha&&this._captcha.value.length>=1,enableRetry:e.phoneNumber.length>=6&&this._captcha&&this._captcha.value.length>=1}),this._showErrorMessage(null)}_handlePasswordChange(e){const t={showRequestLoginTooltip:this.state.phoneNumber.length>=6&&e.target.value.length<6,enablePasswordLogin:this.state.phoneNumber.length>=6&&e.target.value.length>=3};this.state.avatar||(t.enablePasswordLogin=t.enablePasswordLogin&&this._captcha&&this._captcha.value.length>=1,t.showCaptcha=e.target.value.length>0),this.setState(t),this._showErrorMessage(null)}_handleCaptchaChange(e){this.setState({enablePasswordLogin:this.state.phoneNumber.length>=6&&this._password&&this._password.value.length>=3&&e.target.value.length>=1,enableRetry:e.target.value.length>=1}),this._showErrorMessage(null)}_onTypeCaptcha(e){13==e.which&&(this.state.enablePasswordLogin&&this._signIn(),e.preventDefault())}_handleBackButtonClick(){this._showErrorMessage(null),this.setState({showCaptcha:!1,enableRequestLogin:this.state.phoneNumber.length>=6}),this.confirmTimer&&(clearInterval(this.confirmTimer),this.confirmTimer=null),this.timer&&(clearTimeout(this.timer),this.timer=null)}runConfirmTimer(){this.confirmTimer=setInterval((()=>{let e=this.state.confirmTimeout-1;e<=0?(this.confirmTimer&&(clearInterval(this.confirmTimer),this.confirmTimer=null),this._getLoginCaptcha(!0),this.toFocus="captcha"):this.setState({confirmTimeout:e})}),1e3)}_isRecycleSimOrChangedPhone(e){let t=!1;return e&&e.error_code&&([18041,18042,18043].includes(e.error_code)?(t=!0,this._showErrorMessage(e.error_message_localize?e.error_message_localize:J.default.str("STR_SIGNIN_ERROR_RECYCLE_SIM"))):18044==e.error_code&&(t=!0,this._showErrorMessage(e.error_message_localize?e.error_message_localize:J.default.str("STR_SIGNIN_ERROR_CHANGED_NUMPHONE")),this.props.signInAnother&&this.props.signInAnother(!1))),t}_renderCaptchaSection(){let e=null,t=null;return t=o.a.createElement("div",{className:"z-input flx-1"},o.a.createElement(ee.a,{id:"captcha-txt",required:!0,textKey:"STR_INPUT_CAPTCHA",className:"login-pass__group__captcha",onKeyPress:this._onTypeCaptcha,onChange:this._handleCaptchaChange,type:"text",onFocus:()=>this.toFocus="captcha",inputRef:e=>{this._captcha=e},maxLength:"100",title:""})),e=o.a.createElement("div",{id:"captcha",className:"login-pass__captcha flx flx-center flx-al-c"},o.a.createElement("img",{src:this.props.state.captchaImg,alt:"captcha"}),o.a.createElement(te.a,{icon:"outline-reload",onClick:this._getLoginCaptcha.bind(this,!0),type:"tertiary-neutral",size:"large"})),o.a.createElement("div",{className:"login-pass__group flx captcha-section"},t,e)}_onClosePopupLogin(){Ye.ModalManagerV2.closeModal(Je)}_checkRemember(){this.props.checkRemember&&this.props.checkRemember(!this.state.isRemember),this.setState({isRemember:!this.state.isRemember})}onSignUp(){this.props.onSignUp&&this.props.onSignUp()}onShowOtherOptions(){this.otherOptionsMenuRef&&this.otherOptionsMenuRef.show(null,this.otherOptionsRef)}showMobileLoginChecking(){this.props.signInWithMobileRequest&&this.props.signInWithMobileRequest()}setFocus(){this._password&&("password"===this.toFocus||this.state.avatar)?this._password.focus():this._phoneInput&&this._phoneInput.focus()}render(){let e,t,a,s=null,n=null,i=null,r=null,c=null;s=o.a.createElement(ae.a,{id:"password-txt",title:"STR_INPUT_PASSWORD_REQUEST",textKey:"STR_PASSWORD",onFocus:e=>this.toFocus="password",inputRef:e=>{this._password=e},domRef:this._password,onKeyPress:this._onTypeCaptcha,onChange:this._handlePasswordChange,"data-id":"txt_Login_Psw"}),i=o.a.createElement(u.a,{textKey:"STR_SIGNIN_FORGET",tagName:"div",onClick:()=>this.props.onForgotPasswordClick(this.state.phoneNumber,this.state.countryIsoCode,this.state.countryCode),className:"signin-forget-pw signin-mid-container "+(this.state.blocking?" disabled":"")});let l=[{textKey:"STR_SIGNIN_BY_MOBILE",onclick:this.showMobileLoginChecking.bind(this)}];this.state.avatar&&l.push({textKey:"STR_SIGNIN_OTHER",onclick:()=>this.props.signInAnother(!0)}),r=l.length?o.a.createElement(te.a,{size:"medium",textKey:l.length>1?"STR_OPTHER_OPTIONS":l[0].textKey,ref:e=>this.otherOptionsRef=e,onClick:l.length>1?this.onShowOtherOptions.bind(this):l[0].onclick,className:"footer-btn",type:"tertiary-neutral",disabled:this.state.blocking,isActive:this.state.menuShown}):null,c=l.length>1?o.a.createElement($e.default,{popoverProps:{identity:{windowId:Ze.c,name:R.PopoverIdentitiesDefine.LOGIN_PASSWORD},anchorEl:this.otherOptionsRef},ref:e=>this.otherOptionsMenuRef=e,items:[{textKey:"STR_SIGNIN_BY_MOBILE",onclick:this.showMobileLoginChecking.bind(this)},this.state.avatar?{textKey:"STR_SIGNIN_OTHER",onclick:()=>this.props.signInAnother(!0)}:null].filter((e=>!!e)),onShow:()=>{this.setState({menuShown:!0})},onClose:()=>{this.setState({menuShown:!1})}}):null,a=1==this.props.configOptionRemember?o.a.createElement("p",{className:"login-page__main-bottom",style:{paddingLeft:"14px",width:"170px"},onClick:this._checkRemember.bind(this)},o.a.createElement("i",{className:"clickable"+(this.state.isRemember?" fa fa-fill-checkbox-square":" fa fa-uncheckbox-square"),style:{color:"var(--text-information)",fontSize:"var(--f14)",cursor:"pointer",position:"relative",top:"2px"}}),o.a.createElement(u.a,{className:"clickable",textKey:"STR_REMEMBER_SESSION",style:{paddingLeft:"6px"}})):null,e=this.state.avatar?o.a.createElement("div",{className:"flx flx-col flx-al-c flx-1"},o.a.createElement(he.d,{size:"xxl",target:{avatar:this.state.avatar,displayName:this.state.displayName}}),o.a.createElement(Xe.a,{className:"login-pass__recent__name truncate"},this.state.displayName)):o.a.createElement(N.a,{idElementInputPhone:"usrID-txt",idElementSelectCountry:"country-txt",onKeyPress:this._onTypeCaptcha,onFocus:()=>{this.toFocus="phone"},inputRef:e=>{this._phoneInput=e},value:this.state.phoneNumber,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode,onChange:this._handlePhoneNumberChange,phoneNumber:this.state.phoneNumber,borderBottomOnly:!0,"data-id":"txt_Login_Phone"}),this.state.showCaptcha&&(n=this._renderCaptchaSection());let h=o.a.createElement(te.a,{textKey:"STR_SIGNIN",onClick:this._signIn,disabled:!this.state.enablePasswordLogin||this.state.blocking,className:"wi signin-btn",size:"large",loading:this.state.blocking,"data-id":"btn_Login_LoginwPsw"});return this.state.showPopupLogin&&Ye.ModalManagerV2.isVisible(Je)&&(t=o.a.createElement(Ye.default,{visible:!0,title:o.a.createElement(u.a,{textKey:"STR_REQUEST_LOGIN"}),styleTitle:{fontSize:"var(--f14)",fontWeight:"var(--semibold)"},className:"no-padding",border:"no-border",showCloseButton:!0,onCancel:this._onClosePopupLogin.bind(this),width:"350px",footer:{confirm:{textKey:"STR_SIGNIN_REQUEST_LOGIN_TOOLTIP",click:()=>{this._onClosePopupLogin(),this.showMobileLoginChecking()},disabled:!this.state.enableRequestLogin},cancel:{textKey:"STR_POPUP_SIGNIN_QR",click:()=>{this._onClosePopupLogin(),this.props.dispatch({type:P})},disabled:!this.state.enablePasswordLogin},direction:"col"}},o.a.createElement("div",{className:"flx"},o.a.createElement("div",{className:"login-pass",style:{width:"100%",padding:"16px"}},o.a.createElement("div",{style:{marginBottom:"4px"}},o.a.createElement(u.a,{textKey:"STR_POPUP_LOGIN_WITHOUT_PW"})))))),o.a.createElement("div",{className:"flx flx-col flx-1 h100 login-container-in-tabs "+(this.state.avatar?" comeback":""),style:this.props.innerState?{padding:"0 16px"}:null},o.a.createElement("div",{className:"login-pass"},e,s,null,n,a,t,o.a.createElement("div",{className:"error-message"+(this.props.state.loginFail&&this.props.state.errorMessage?" ":" hidden"),style:{marginBottom:"0"}},this.props.state.loginFail&&this.props.state.errorMessage)),o.a.createElement("div",{className:"login-pass flx flx-col flx-1"},h,h&&null,null,o.a.createElement("div",{className:"flx flx-col flx-1"},i,o.a.createElement("div",{className:"flx-1"}),r,c),null))}}var tt=et,at=a("97kL"),st=(a("Enw1"),a("4prX")),nt=a("Iawr"),ot=a("Yi2m"),it=a("gwig"),rt=a("PoHQ"),ct=a("FInY"),lt=a("ZwwW"),ht=a("zRkS"),ut=a("Ff2n");const dt=["tabOffset","tabs","onChange","tabOnly"];function _t(e){let{tabOffset:t=0,tabs:a=[],onChange:s=null,tabOnly:n=null}=e;Object(ut.a)(e,dt);const[i,r]=o.a.useState(t);o.a.useEffect((()=>{r(t)}),[t]);let c=null,l=[];var h;a&&a.length>0&&(null!=n?c=(null===(h=a[n])||void 0===h?void 0:h.domContent)||null:l=a.map(((e,t)=>{if(!e)return null;let{domContent:a,textKey:n=""}=e;return i===t&&(c=a),o.a.createElement("div",{className:"tab-container "+(t===i?"selected-tab":""),key:"tab_"+t,onClick:e=>function(e){r(e),s&&s(e)}(t)},o.a.createElement(u.a,{textKey:n,tagName:"div"}))})));return o.a.createElement("div",{className:"tabs-container w100 h100 flx flx-col rel"},n?null:o.a.createElement("div",{className:"tabs-main flx flx-al-c"},l),o.a.createElement("div",{className:"flx-1 flx"},c))}var pt=function(e){const t=Object(n.useRef)(null);return Object(n.useEffect)((()=>{t.current&&t.current.focus()}),[]),o.a.createElement(ee.a,{required:!0,textKey:"STR_INPUT_OTP_PLACEHOLDER",className:"otp-input",name:"captcha",maxLength:"6",inputRef:t,disabled:!!e.disabled,onChange:()=>{let a=t.current.value;e.onInputOTP&&e.onInputOTP(a)},onKeyPress:a=>{if("Enter"===a.key){let s=t.current&&t.current.value;return e.callSubmit(s),a.preventDefault(),void a.stopPropagation()}}})};var mt=function(e){const[t,a]=Object(n.useState)(0),s=Object(n.useRef)(null);return Object(n.useEffect)((()=>{if(t)return s.current=setTimeout((()=>{a(t-1)}),1e3),()=>clearTimeout(s.current)}),[t]),Object(n.useEffect)((()=>{a(e.timeout)}),[e.timeout,e.startCountdown]),o.a.createElement("div",{onClick:e.onClick,className:"resend-otp flx flx-center "+(t||!e.enable?"disable":"")},o.a.createElement(u.a,{textKey:"STR_RESEND",className:"btn-link"}),t?o.a.createElement("span",{className:"btn-link"}," (",t,"s)"):o.a.createElement("div",{className:"btn-link flx flx-al-c"},"Â ",o.a.createElement(ht.a,{className:"icon-outline-reload btn-link"})))};var Et=function(e){const{error:t}=e,a=Object(n.useRef)(null),[s,i]=Object(n.useState)(0);if(Object(n.useEffect)((()=>{if(e.error&&e.error.timeout){let s=e.error.timeout;t=s,clearInterval(a.current),a.current=null,i(t),a.current=setInterval((()=>{i(t--),0===t&&(clearInterval(a.current),a.current=null)}),1e3)}var t}),[e.error]),!t)return o.a.createElement("div",null);switch(t.eCode){case Q:return o.a.createElement("div",{className:"text-center request-login-info error"},o.a.createElement(u.a,{tagName:"div",textKey:"STR_REMEMBER_LOGIN_REJECTED"}),o.a.createElement(u.a,{tagName:"div",textKey:"STR_PLEASE_RETRY"}));case B:return o.a.createElement("div",{className:"text-center request-login-info error"},o.a.createElement(u.a,{tagName:"div",textKey:"STR_REMEMBER_LOGIN_TIMEOUT"}));case V:return o.a.createElement("div",{className:"error-message"},o.a.createElement(u.a,{textKey:"STR_SIGNIN_ERROR_NO_NETWORK"}));case H:return o.a.createElement("div",{className:"text-center request-login-info error"},o.a.createElement(u.a,{textKey:"STR_REQUEST_TIMES_LIMIT",textArguments:[Math.floor(s/60),Math.round(s%60)]}));case $:case X:return o.a.createElement("div",{className:"text-center request-login-info error"},o.a.createElement("span",null,t.eMessage));case Z:return o.a.createElement("div",{className:"text-center request-login-info error"},o.a.createElement(u.a,{textKey:"STR_OTP_REQUEST_LIMIT"}));default:return o.a.createElement("div",{className:"text-center request-login-info error"},t.eMessage?o.a.createElement("span",null,t.eMessage):o.a.createElement(u.a,{textKey:"STR_ERROR_OCCURED"}))}};var gt=function(e){return o.a.createElement(te.a,{textKey:"STR_VERIFY",className:"wi signin-btn",size:"large",onClick:()=>{e.disable||e.onClick&&e.onClick()},disabled:e.disable,loading:e.blocking})};function Tt(e){const t=Object(n.useRef)(null);Object(n.useEffect)((()=>{t.current&&t.current.focus()}),[]);return o.a.createElement("div",{className:"z-input",style:{flex:"1"}},o.a.createElement(ee.a,{id:"captcha-txt",required:!0,textKey:"STR_INPUT_CAPTCHA",className:"login-pass__group__captcha",onKeyPress:a=>{if(13==a.which){let a=t.current.value;e.onSubmit&&e.onSubmit(a)}},onChange:()=>{let a=t.current.value;e.onInputCaptcha&&e.onInputCaptcha(a)},type:"text",inputRef:t,maxLength:"100"}))}var Nt=function(e){const{className:t}=e;let a=null,s=null;s=o.a.createElement(Tt,e);const n="data:image/png;base64,"+e.captcha.captcha_img;a=o.a.createElement("div",{id:"captcha",className:"login-pass__captcha"},o.a.createElement("img",{src:n,alt:"captcha"}),o.a.createElement("div",{className:"dib login-pass__captcha__refresh",style:{marginRight:"0"}},o.a.createElement("i",{className:"fa fa-reload btn",onClick:e.getLoginCaptcha})));const i=Object(T.a)("login-pass__group flx captcha-section",t);return o.a.createElement("div",{className:i},s,a)};const Rt=Te.ModuleContainer.resolve(ge.ZLoggerFactory).createZLogger("login",["sensitive-login","opt-confirm"]),ft=new s.LocalId,Ct={NONE:0,NORMAL:1,MANUAL_SMS:2};function St(e){const{instructionText:t,lastData:a,screen:s}=e;let n;return n=s===Ct.MANUAL_SMS?o.a.createElement(u.a,{textKey:t}):o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{textKey:"STR_VERIFY_ACCOUNT_DESC"}),o.a.createElement("span",{className:"act-phone-num"},"Â (+",a.countryCode,")",a.phone&&a.phone.slice(1))),n}function It(e){const{enableRetryOTP:t,otpCountdown:a,screen:s,startCountdown:n,resendOTP:i}=e;let r=null;return s===Ct.NORMAL&&(r=o.a.createElement("div",{className:"flx resend-otp-container"},o.a.createElement(u.a,{textKey:"STR_DONT_RECEIVE_OTP",tagName:"div"}),o.a.createElement(mt,{onClick:i,timeout:a,startCountdown:n,enable:t}))),r}var Ot=function(e){const t=Object(n.useRef)(null),[a,s]=(Object(n.useRef)(null),Object(n.useState)(!1)),[i,r]=Object(n.useState)(null),[c,l]=Object(n.useState)(null),[h,d]=Object(n.useState)(!1),[_,p]=Object(n.useState)(!1),[m,g]=Object(n.useState)(!0),[T,N]=Object(n.useState)(15),[R,f]=Object(n.useState)(!1),[C,S]=Object(n.useState)(""),[I,O]=Object(n.useState)({prev:-1,current:Ct.NONE}),y=Object(n.useRef)(null),b=e.state&&e.state.pass,v=b&&b.lastData,[P,A]=Object(n.useState)(),L=Object(n.useRef)(),w=Object(n.useRef)(),M=o.a.useRef();Object(n.useEffect)((()=>{L.current=v.captchaToken?v.captchaToken:"",w.current=v.captchaAnswer?v.captchaAnswer:"",x();const e=()=>{r(null)};return J.default.callUpdate(e),()=>{J.default.removeUpdate(e)}}),[]);const k=(e,a)=>{const s=Object(oe.a)(e);let n=s.errorCode||z,o=0;s.data&&s.data.time_left&&(o=s.data.time_left);let i="";switch(n){case Y:case H:o=o||900,p(!0),t.current=setTimeout((()=>{p(!1),r(null)}),1e3*o);break;case Z:g(!1),N(0);break;case ie.a.REJECTED_OTP:if(I.current===Ct.NORMAL){var c;if(r(null),null!==(c=s.data)&&void 0!==c&&c.manual_sms){var h;const e=null===(h=s.data)||void 0===h?void 0:h.manual_sms,t=e.error&&e.instruction&&`${e.error} ${e.instruction}`;t&&S(t)}}else{var u;if(null!==(u=s.data)&&void 0!==u&&u.manual_sms){var d;const e=null===(d=s.data)||void 0===d?void 0:d.manual_sms,t=e.hint&&e.instruction&&`${e.hint} ${e.instruction}`;t&&S(t)}I.current===Ct.MANUAL_SMS&&r({eCode:n,eMessage:s.errorMessageLocalize||""})}return void D(Ct.MANUAL_SMS);case ie.a.CAPTCHA_REQUIRED:{const e=s.data;e&&e.captcha&&q(e.captcha),i=s.errorMessageLocalize||"";break}case ie.a.INVALID_CAPTCHA:case ie.a.CAPTCHA_EXPIRED:case ie.a.CAPTCHA_RETRY_RATE_LIMIT_EXCEEDED:i=s.errorMessageLocalize||""}i?(l(i),r(null)):(l(null),r({eCode:n,timeout:o,eMessage:s.errorMessageLocalize||""}))},x=()=>{if(!m)return;s(!a);let e=E.default.getZaloClientID(),t=v.countryIsoCode?v.countryIsoCode:"VN",n=v.phone;const o=ft.next();N(15),E.default.sendLoginOTP(e,n,t,L.current,w.current).then((()=>{D(Ct.NORMAL),ft.valid(o)})).catch((e=>{Rt.zsymb(21,"brJyty",["get OTP error {}","BkL_Br"],e&&(e.error_code||e.code)||e),k(e)}))},D=e=>{O({prev:I.current,current:e})},U=()=>{if(!h)return;r(null),f(!0);let t={question_type:"otp",answer_type:"otp",answers:y.current||""};E.default.loginWithPassword(v.phone,v.password,w.current,L.current,E.default.getZaloClientID(),1,t,{code:v.countryCode,iso:v.countryIsoCode}).then((()=>{e.successLogin()})).catch((e=>{f(!1),k(e)}))},G=()=>{M.current&&(clearTimeout(M.current),M.current=null)},q=(e,t=!0)=>{G(),A(e.captcha_img),L.current=e.token,t&&(M.current=setTimeout((()=>{F()}),1e3*e.expiration_time))},F=()=>{G(),E.default.getCaptcha().then((e=>{const{data:t}=e;t&&q(t)})).catch((e=>{Rt.zsymb(21,"FJE96l",["callGetCaptcha {}","tiLE0U"],e&&(e.error_code||e.code)||e)}))};return o.a.createElement("div",{className:"sensitive-login-container"},o.a.createElement("div",{className:"sensitive-login"},o.a.createElement("div",{className:"sensitive-login-title"},o.a.createElement(u.a,{textKey:"STR_VERIFY_ACCOUNT"})),o.a.createElement("div",{className:"sensitive-login-desc"},o.a.createElement(St,{instructionText:C,screen:I.current,lastData:v})),o.a.createElement(Et,{error:i}),o.a.createElement(pt,{callSubmit:U,onInputOTP:e=>{y.current=e,d(!!y.current)},disabled:_}),o.a.createElement("div",{className:"otp-separater"}),P?o.a.createElement(Nt,{className:"mt-16",captcha:{captcha_img:P},onInputCaptcha:e=>{w.current=e},getLoginCaptcha:()=>{F()}}):null,c?o.a.createElement("div",{className:"mt-8"},o.a.createElement(u.a,{className:"f12 error",textKey:c})):null,o.a.createElement(gt,{onClick:U,disable:!h||R||_,blocking:R}),o.a.createElement(It,{enableRetryOTP:m,otpCountdown:T,screen:I.current,startCountdown:a,resendOTP:x})))};var yt=function(e){const[t,a]=Object(n.useState)(e.timeout),s=Object(n.useRef)(null);return Object(n.useEffect)((()=>{if(t)return s.current=setTimeout((()=>{a(t-1)}),1e3),()=>clearTimeout(s.current)}),[t]),Object(n.useEffect)((()=>{a(e.timeout)}),[e.timeout]),o.a.createElement("div",null,t?o.a.createElement(u.a,{className:"mobile-confirm-countdown",textKey:"STR_REQUEST_LOGIN_PENDING",textArguments:[t,t>1?"s":""]}):o.a.createElement(te.a,{textKey:e.textKey||"STR_RETRY",onClick:()=>{t||e.disable||e.onClick&&e.onClick()},className:"wi signin-btn",size:"large",disabled:e.disable||e.blocking,loading:e.blocking}))};const bt=new s.LocalId;var vt=function(e){const t=o.a.useRef(null),a=o.a.useRef(null),i=o.a.useRef(null),[r,c]=Object(n.useState)(30),[l,h]=Object(n.useState)(null),[d,_]=Object(n.useState)(null),[p,g]=Object(n.useState)(!1),[T,N]=Object(n.useState)(!1),R=e.state.pass&&e.state.pass.lastData||{};Object(n.useEffect)((()=>{C();const e=()=>{_(null)};return J.default.callUpdate(e),()=>{clearTimeout(a.current),clearTimeout(i.current),J.default.removeUpdate(e)}}),[]);const f=()=>{a.current&&(clearTimeout(a.current),c(0),a.current=null),h({});const e=()=>{m.default.getLoginCaptcha(E.default.getZaloClientID()).then((t=>{t.data&&0==t.data.error_code&&t.data.data?(h(t.data.data),a.current=setTimeout((()=>{a.current=null,c(0),e()}),1e3*t.data.data.expiration_time)):h({})})).catch((e=>{s.default.error("_getLoginCaptcha error ",e&&(e.error_code||e.code)||e)}))};e()},C=()=>{const a=Date.now();t.current&&a-t.current<700||(N(!0),t.current=a,E.default.loginWithPopup(R.phone,R.countryIsoCode,l?l.token:null,p||null).then((t=>{h(null),g(null),_(null),c(30);const a=bt.next();E.default.awaitQRConfirm(t.url,t.timeout).then((()=>{bt.valid(a)?e.successLogin():s.default.error("request-login: invalid request id")})).catch((e=>{N(!1),c(0),bt.valid(a)?(18010==e?_({eCode:Q}):-10==e?_({eCode:B}):e&&e.code&&("ERR_NO_NETWORK"===e.code||"ERR_CONNECTION_TIMED_OUT"===e.code)?_({eCode:V}):_({eCode:z}),f()):s.default.error("request-login: invalid request id")}))})).catch((e=>{if(N(!1),s.default.error("request login popup error",e&&(e.error_code||e.code)||e),e)if(e.error_code===H){let t=900;e.data&&e.data.time_left&&(t=e.data.time_left),_({eCode:H,timeout:t,eMessage:""}),i.current=setTimeout((()=>{_(null),c(0)}),1e3*t)}else e.error_code===$?(_({eCode:e.error_code,timeout:0,eMessage:e.error_message_localize||""}),h(e.data),c(0)):(_({eCode:e.error_code,timeout:0,eMessage:e.error_message_localize||""}),f(),c(0));else _({eCode:z,timeout:0,eMessage:""}),f()})))};return o.a.createElement("div",{className:"sensitive-login-container"},o.a.createElement("div",{className:"sensitive-login"},o.a.createElement("div",{className:"sensitive-login-title"},o.a.createElement(u.a,{textKey:"STR_VERIFY_ACCOUNT"})),o.a.createElement("div",{className:"sensitive-login-desc"},o.a.createElement(u.a,{textKey:d&&d.eCode===$?"STR_LOGIN_WAITING_REQ_CAPT":"STR_REMEMBER_LOGIN_WAITING"})),o.a.createElement(Et,{error:d}),l?o.a.createElement(Nt,{getLoginCaptcha:f,captcha:l,onInputCaptcha:e=>{g(e)},onSubmit:C}):null,o.a.createElement(yt,{onClick:C,timeout:r,disable:!p||!l||!l.captcha_img,blocking:T,textKey:d&&d.eCode===$?"STR_CONFIRM":""})))};const Pt=!1;class At extends o.a.Component{constructor(e){super(e),this._successLogin=()=>{f()},this._useOTP=()=>{this.setState({method:2})},this._useAnotherWay=()=>{let e=2;2===this.state.method&&(e=1),this.setState({method:e})},this._back=()=>{this.props.dispatch({type:G})},this.state={method:"otp"===e.defaultOption?2:1},this.lastSignIn=null}render(){let e=null,t=this.state.method;return 1===t?e=o.a.createElement(vt,{state:this.props.state,successLogin:this._successLogin}):2===t&&(e=o.a.createElement(Ot,{state:this.props.state,successLogin:this._successLogin})),o.a.createElement("div",{style:{height:"100%",position:"relative"}},e,o.a.createElement("div",{className:"sensitive-login-footer"},o.a.createElement("div",{className:"try-another-way"},o.a.createElement(u.a,{textKey:"STR_TRY_ANOTHER_WAY"}),o.a.createElement(u.a,{textKey:1===t?"STR_SEND_OTP":"STR_SEND_MOBILE_CONFIRM",tagName:"a",onClick:this._useAnotherWay,className:"btn-link try-another-btn"})),o.a.createElement("div",{className:"back-btn"},o.a.createElement(u.a,{textKey:"STR_BACK",onClick:this._back}))))}}var Lt=At;const wt=["onBack","data","error","state","onSuccess","onError"],Mt=new s.LocalId;function kt(e){let{onBack:t,data:a=null,error:s=null,state:n=null,onSuccess:i=null,onError:r=null}=e,c=Object(ut.a)(e,wt);const[l,h]=o.a.useState((null==a?void 0:a.phone)||""),[p,g]=o.a.useState((null==a?void 0:a.code)||84),[T,R]=o.a.useState((null==a?void 0:a.iso)||"VN"),[C,S]=o.a.useState(null),[I,O]=o.a.useState(null),[b,v]=o.a.useState(!1),[A,L]=o.a.useState(-1),[w,M]=o.a.useState(!1),[k,x]=o.a.useState(!1),D=o.a.useRef(null),U=o.a.useRef(null),G=o.a.useRef(null);function q(){l&&(K(),j())}function F(e){G.current&&(clearTimeout(G.current),G.current=null),G.current=setTimeout((()=>{let t=e-1;t<0?L(-1):F(t)}),1e3),L(e)}function K(){G.current&&(clearTimeout(G.current),G.current=null),L(-1),O(null),M(!1)}function W(e,t){const a=Object(oe.a)(e);if(0===a.errorCode)return;const s=function(e){if(e.errorCode===ie.a.REQUIRE_LOGIN_QR){const t={};if(e.data&&(t.data=e.data),e.errorMessageLocalize&&(t.errorMessage=e.errorMessageLocalize),"function"==typeof c.dispatch)return c.dispatch({type:P,payload:t}),!0}return!1}(a);var n;s||(O(a),a?function(e){let t=!1;return e&&e.error_code&&([18041,18042,18043].includes(e.error_code)?(t=!0,O(e.error_message_localize?e.error_message_localize:J.default.str("STR_SIGNIN_ERROR_RECYCLE_SIM"))):18044==e.error_code&&(t=!0,O(e.error_message_localize?e.error_message_localize:J.default.str("STR_SIGNIN_ERROR_CHANGED_NUMPHONE")))),t}(e)||(a.errorCode===ie.a.CAPTCHA_REQUIRED?a.data.captcha_img&&S({captcha_img:"data:image/png;base64,"+a.data.captcha_img,token:null===(n=a.data)||void 0===n?void 0:n.token}):"ERR_NO_NETWORK"!==a.code&&"ERR_CONNECTION_TIMED_OUT"!==a.code||(setTimeout((()=>{const{originUrl:e}=t||{};He.a.onError(a.code,e)}),0),O(J.default.str("STR_SIGNIN_ERROR_NO_NETWORK")))):O(J.default.str("STR_ERROR_OCCURED")))}function j(){if(!b)return v(!0),new Promise(((e,t)=>{var a;if(b)return t("blocking_state");const s=_.default.authDomain;E.default.loginWithPopup(l,T,null!=C&&C.token?C.token:null,null!=C&&C.token?null==D||null===(a=D.current)||void 0===a?void 0:a.value:null).then((a=>{v(!1);let{url:n,timeout:o}=a;F(o);const i=Mt.next();E.default.awaitQRConfirm(n,o).then((s=>{if(!Mt.valid(i))return t();K(),f(),e(a)})).catch((e=>{if(!Mt.valid(i))return t(e);if(K(),18010===e)O(J.default.str("STR_REMEMBER_LOGIN_REJECTED"));else if(-10===e)M(!0),C&&V();else{let t=J.default.str("STR_ERROR_OCCURED");e&&e.code&&("ERR_NO_NETWORK"===e.code||"ERR_CONNECTION_TIMED_OUT"===e.code)&&(t=J.default.str("STR_SIGNIN_ERROR_NO_NETWORK"),c.dispatch({type:y,payload:{data:e}}),setTimeout((()=>{He.a.onError(e.code,s)}),0),O(t))}t(e)}))})).catch((e=>{K(),v(!1);W(e,{originUrl:s}),t(e)}))}))}function Q(e){13==e.which&&(j(),e.preventDefault())}function B(){O(null),M(!1),z()}function V(){const e=()=>{U.current&&(clearTimeout(U.current),U.current=null),m.default.getLoginCaptcha(E.default.getZaloClientID()).then((t=>{0==t.data.error_code&&(U.current=setTimeout((()=>{U.current=null,e()}),1e3*t.data.data.expiration_time),c.dispatch({type:y,payload:t}))})).catch((e=>{}))};e()}function z(e){var t;(e||(e={phoneNum:l}),null!=C&&C.token)&&(e=Object(d.a)(Object(d.a)({},e),{},{captcha:(null==D||null===(t=D.current)||void 0===t?void 0:t.value)||""}));let{phoneNum:a,captcha:s}=e;x(!(!a||b||!s&&void 0!==s))}return o.a.useEffect((()=>{z()}),[]),o.a.useEffect((()=>{n.captchaToken?null!=C&&C.token&&n.captchaToken!==(null==C?void 0:C.token)&&S({token:n.captchaToken,captcha_img:n.captchaImg}):V()}),[n]),o.a.useEffect((()=>{I&&V()}),[I]),o.a.createElement("div",{className:"flx flx-col flx-1 login-padding mobile-login-page"},c.noNetworkUI||null,o.a.createElement("img",{src:ne,className:"sign-in-logo"}),o.a.createElement(u.a,{textKey:"STR_MOBILE_LOGIN",className:"sigin-title"}),o.a.createElement(u.a,{textKey:"STR_MOBILE_GUIDE",className:"register-desc"}),o.a.createElement(N.a,{onChange:function(e){let t=e.phoneNumber;h(t),g(e.countryCode),R(e.countryIsoCode),O(null),z({phoneNum:t})},value:l,countryCode:p,countryIsoCode:T,phoneNumber:l,onKeyPress:e=>{13===(null==e?void 0:e.which)&&q()}}),function(){if(A>=0)return A<=0?null:o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{textKey:"STR_REMEMBER_LOGIN_WAITING",tagName:"div",className:"mobile-login-subdesc"}),o.a.createElement(u.a,{textKey:"STR_REQUEST_LOGIN_PENDING",tagName:"div",className:"mobile-login-countdown",textArguments:[A,A>1?"s":""]}));if(null==C||!C.token)return null;let e=null,t=null;t=o.a.createElement("div",{className:"z-input flx-1"},o.a.createElement(ee.a,{id:"captcha-txt",required:!0,textKey:"STR_INPUT_CAPTCHA",className:"login-pass__group__captcha",onKeyPress:Q,onChange:B,type:"text",inputRef:D,maxLength:"100",title:""}));let{captcha_img:a}=C;return e=o.a.createElement("div",{id:"captcha",className:"login-pass__captcha flx flx-center flx-al-c"},o.a.createElement("img",{src:a,alt:"captcha"}),o.a.createElement(te.a,{icon:"outline-reload",onClick:V,type:"tertiary-neutral",size:"large"})),o.a.createElement("div",{className:"login-pass__group flx captcha-section"},t,e)}(),function(){let e=null;return w?e=o.a.createElement(o.a.Fragment,null,o.a.createElement(u.a,{textKey:"STR_REMEMBER_LOGIN_TIMEOUT",tagName:"div"})):I&&(I.constructor===Object?e=re(I):I.constructor===String&&(e=I)),e?o.a.createElement("div",{className:"error-message",style:{marginBottom:0}},e):null}(),A>-1?null:o.a.createElement(te.a,{textKey:I?"STR_RETRY":"STR_CONTINUE",onClick:q,className:"wi sign-in-waiting-retry-btn",size:"large",disabled:!k||b,loading:b}),o.a.createElement(te.a,{type:"tertiary-neutral",size:"medium",textKey:"STR_BACK",onClick:t,className:"footer-btn",disabled:b}))}const xt=0,Dt=1;function Ut(){const[e,t]=o.a.useState(xt);function a(){setTimeout((()=>{t(Dt)}),12e4)}return o.a.useEffect((()=>{a()}),[]),e===xt?o.a.createElement("div",{className:"flx flx-al-c flx-center no-network-banner"},o.a.createElement(ht.a,{className:"outline-disconnect"}),o.a.createElement(u.a,{tagName:"div",textKey:"STR_INFO_NO_NETWORK"})):o.a.createElement("div",{className:"login-pass reg-padding flx flx-1 flx-col flx-al-c no-network-page"},o.a.createElement("img",{src:ne,className:"sign-in-logo"}),o.a.createElement(ht.a,{className:"icon-disconnect no-network-icon"}),o.a.createElement(u.a,{textKey:"STR_CANT_CONNECT_1",tagName:"div",className:"no-network-title"}),o.a.createElement(u.a,{textKey:"STR_CANT_CONNECT_3",tagName:"div",className:"no-network-desc"}),o.a.createElement("div",{className:"flx-1"}),o.a.createElement(te.a,{type:"tertiary-neutral",size:"medium",textKey:"STR_BACK_TO_LOGIN",onClick:function(){t(xt),a()}}))}var Gt=a("Nd7d"),qt=a("AtyM"),Ft=a("Uqjx"),Kt=a("rkiK"),Wt=a("/n5c");let jt=0;function Qt(e){let{qrcodeImg:t,onClose:a}=e;function s(){a&&a()}return o.a.createElement("div",{className:"qr-guide",onClick:s},o.a.createElement("div",{className:"qr-guide__content",onClick:e=>{e.preventDefault(),e.stopPropagation()}},o.a.createElement("img",{src:ne,className:"sign-in-logo"}),o.a.createElement(u.a,{textKey:"STR_SCAN_QR_GUIDE",tagName:"div",className:"sigin-title"}),o.a.createElement("img",{src:t,className:"qr-guide__img"}),o.a.createElement("div",{className:"qr-guide__steps"},o.a.createElement("div",{className:"v-line"+(J.default.currentLanguage()===R.LANG_INDEX_EN?" eng":"")}),o.a.createElement("div",{className:"flx flx-al-c step-line first-line"},o.a.createElement("div",{className:"num"},"1"),o.a.createElement(u.a,{textKey:"STR_QR_GUIDE_LINE1",tagName:"div",className:"desc"})),o.a.createElement("div",{className:"flx flx-al-c step-line"},o.a.createElement("div",{className:"num"},"2"),o.a.createElement("div",{className:"flx flx-al-c desc line-2"},o.a.createElement(u.a,{textKey:"STR_QR_GUIDE_LINE2_1",tagName:"div"}),o.a.createElement("i",{className:"fa fa-qrcode-icon",style:{fontSize:"var(--f24)",marginLeft:"5px",marginRight:"5px"}}),o.a.createElement(u.a,{textKey:"STR_QR_GUIDE_LINE2_2",tagName:"div"}))),o.a.createElement("div",{className:"flx flx-al-c step-line"},o.a.createElement("div",{className:"num"},"3"),o.a.createElement(u.a,{textKey:"STR_QR_GUIDE_LINE3",tagName:"div",className:"desc"}))),o.a.createElement(te.a,{textKey:"STR_CLOSE",type:"tertiary-neutral",onClick:s,style:{marginTop:"24px"},size:"medium",className:"footer-btn"})))}const Bt=991;class Vt extends o.a.Component{constructor(e){super(e),this._getQRCode=this._getQRCode.bind(this),this.tryLoadQR=this.tryLoadQR.bind(this),this.dispatch=e.dispatch,this.state={isRemember:e.isRemember,showGuide:!1,menuShown:!1,didloadqr:!1};{const e=async()=>{await Te.ModuleContainer.resolve(Wt.a).tryFlushAll(),await $zFileManager.cleanupLogFileDescriptors(),$zsub.$zwindow.removeListenUnloadZLog(e)};$zsub.$zwindow.onUnloadZLog(e)}}componentWillReceiveProps(e){e.state.qrTimeout&&e.state.qrTimeout>Date.now()&&!this.timer&&this.triggerUIBlockLoadQR(e.state.qrTimeout)}componentWillMount(){this.props.state.qrTimeout&&this.props.state.qrTimeout>Date.now()?this.triggerUIBlockLoadQR(this.props.state.qrTimeout):this.tryLoadQR()}componentWillUnmount(){this.timer&&(clearTimeout(this.timer),this.timer=null)}get Logger(){return this._Logger||(this._Logger=Te.ModuleContainer.resolve(ge.ZLoggerFactory).createZLogger("pc",["loginqr"])),this._Logger}triggerUIBlockLoadQR(e){if(e&&e>Date.now())return this.setState({timeout:Math.max(e-Date.now(),0)}),this._startTimer(),void(this.overQRRequest=!0)}tryLoadQR(e=!1){var t;e&&this._getQRCode(),18012===this.props.state.qrErrorCode&&(null===(t=this.props.state)||void 0===t?void 0:t.qrTimeout)>Date.now()||this.props.state.qrcodeImg&&!this.props.state.qrExpired||this._getQRCode()}_signalQRExpired(e){this.dispatch({type:K,payload:{isExpired:e}})}_doWaitScanQR(e){setTimeout((()=>{He.a.onSucess()}),0),this._signalQRExpired(!1),this.dispatch({type:v,payload:""}),this.dispatch({type:b,payload:e});let t=E.default;this.props.isVisible&&W(j.LOGIN_STEP_WAITING_SCAN);let a=91059,s=Date.now(),n=qt.a.now();t.awaitQRScan(e.data.chk_wait_scan,e.data.qr_timeout,e.data.qr_retry).then((o=>(this.dispatch({type:k,payload:{currentDisplayName:o.display_name,currentAvatar:o.avatar}}),this.dispatch({type:P}),W(j.LOGIN_STEP_WAITING_CONFIRM),st.default.increaseSuccess(a,0,qt.a.now()-n),a=91060,s=Date.now(),n=qt.a.now(),t.awaitQRConfirm(e.data.chk_wait_cfirm,e.data.qr_timeout,e.data.qr_retry)))).then((()=>{st.default.increaseSuccess(a,0,qt.a.now()-n),f()})).catch((t=>{this.dispatch({type:k,payload:{currentDisplayName:"",currentAvatar:""}});let o="number"==typeof t?t:-1;if(t&&"object"==typeof t){if(-20==t.error_code)return this.Logger.zsymb(0,"nfKOfx","gen qrcode token 2"),void this._doWaitScanQR(Object(d.a)(Object(d.a)({},t),{},{data:Object(d.a)(Object(d.a)({},e.data),t.data)}));t.error_code}18010==t?(this.dispatch({type:v,payload:J.default.str("STR_REMEMBER_LOGIN_REJECTED")}),this._signalQRExpired(!0)):(-10==t?this.Logger.zsymb(21,"xw9Vf5",["qr timeout {}","8uHfcp"],t):this.Logger.zsymb(21,"ls-Ghz",["login fail {}","pguZ2a"],t),this.dispatch({type:v,payload:J.default.str("STR_QR_EXPIRED")}),this._signalQRExpired(!0)),st.default.increaseFailed(a,0,qt.a.now()-n,o,s)}))}_startTimer(){this.timer||(this.timer=setInterval((()=>{const e=this.state.timeout-1e3;e<=0?(jt=0,this.overQRRequest=!1,this.setState({timeout:0}),this.dispatch({type:v,qrErrorCode:Bt}),this.timer&&(clearInterval(this.timer),this.timer=null)):this.setState({timeout:e})}),1e3))}_getQRCode(){if(this.overQRRequest)return;this.props.isVisible&&W(j.LOGIN_STEP_GET_QR),this.setState({timeout:0}),this.timer&&(clearTimeout(this.timer),this.timer=null);let e=ct.a.getUidLogin();const t=_.default.authDomain,a=(e=!1)=>{const t=()=>{this.setState({didloadqr:!e})};e?t():setTimeout((()=>{t()}),2e3)};a(!0);const s=e=>{this.overQRRequest=!0,setTimeout((()=>{He.a.onSucess()}),0);let t=12e4;e&&e.data.data&&e.data.data.time_left&&(t=e.data.data.time_left),this.Logger.zsymb(0,"vk13a2","Over hit QR, pending: ",t),this.dispatch({type:v,payload:J.default.str("STR_QR_ERROR_REQUEST_LIMIT"),qrErrorCode:18012,qrTimeout:Date.now()+t}),this._signalQRExpired(!0),this.setState({timeout:t,didloadqr:!0}),this._startTimer()};jt>3?s():m.default.getQRCode(E.default.getZaloClientID(),e,J.default.getCurrentLanguageName()).then((e=>{if(this.Logger.zsymb(3,"JIuBWD",["axios getQRCode","uA-5oy"]),e.data.data&&0===e.data.error_code)return this._doWaitScanQR(e.data);if(e.data&&18012==e.data.error_code)s(e);else{if(e.request&&e.request.responseURL)try{let a=new URL(e.request.responseURL),s=new URL(t);a&&s&&a.origin&&s.origin&&a.origin!==s.origin&&setTimeout((()=>{He.a.onError(e.status,t,e.request.responseURL)}),0)}catch(a){}else e&&e.status&&setTimeout((()=>{He.a.onError(e.status,t,!1,200!==e.status)}),0);this.dispatch({type:v,payload:J.default.str("STR_QR_ERROR_UNKNOWN")+(e.data&&e.data.error_code?` (${e.data.error_code})`:"")})}this.Logger.zsymb(18,"iWqvM4",e.data.error_message)})).catch((e=>{var s;this.Logger.zsymb(21,"prkTfm",["getQRCode error {}","I_ftAX"],e),a(),this.dispatch({type:v,payload:-10===e?"":111===(null==e||null===(s=e.data)||void 0===s?void 0:s.error_code)?J.default.str("STR_TOAST_CONNECTION_FAILED"):J.default.str("STR_ERROR_OCCURED")}),!e||"ERR_NO_NETWORK"!==e.code&&"ERR_CONNECTION_TIMED_OUT"!==e.code||setTimeout((()=>{He.a.onError(e.code,t)}),0)}))}_showTips(){this.dispatch({type:w})}_hideTips(){this.dispatch({type:M})}_checkRemember(){this.props.checkRemember&&this.props.checkRemember(!this.state.isRemember),this.setState({isRemember:!this.state.isRemember})}onShowOtherOptionsMenu(e){this.otherOptionsMenuRef&&this.otherOptionsMenuRef.show(e,this.otherOptionsRef)}getQRLoadingUI(){return this.state.didloadqr?null:o.a.createElement(o.a.Fragment,null,o.a.createElement(Gt.a,{size:27,version:3}),o.a.createElement(u.a,{textKey:"STR_LOADING",tagName:"div",className:"margin-top-8"}))}getQRIntroduction(e={}){const{qrData:t}=e;if(t&&t.introduction){let e=t.introduction.formatted;const a=t.introduction.localized;if("string"==typeof e&&Array.isArray(a)){const t=J.default.getCurrentLanguageName();for(let s=0;s<a.length;s++){const n=a[s];if(n){const a=n[t.toLowerCase()];a&&(e=e.replace(`$${s}$`,a))}}return o.a.createElement(Ft.a,{className:"mt-16 mb-8",config:{ALLOWED_ATTR:["class"]},html:e})}}return o.a.createElement(u.a,{textKey:"STR_QR_GUIDE",className:"qr-guide-title"})}getContentOCR(){return o.a.createElement("div",{id:"qrcode-ocr"},o.a.createElement(u.a,{className:"ocr-highlight",textKey:"STR_OCR_BLUE"}),o.a.createElement(u.a,{textKey:"STR_OCR_BLACK"}))}render(){let e=null;const t=this.props.state;let a=t.qrErrorMessage;if(18012===t.qrErrorCode&&this.state.timeout){const e=Math.floor(this.state.timeout/60/1e3),t=Math.round(this.state.timeout/1e3%60);a=o.a.createElement("span",null,J.default.trans("STR_QR_ERROR_REQUEST_LIMIT_WOTIME"),"Â ",0!==e?`${e} ${J.default.trans("STR_MIN")} `:"",`${t} ${J.default.trans(t>1?"STR_SECONDS":"STR_SECOND")}`)}let s=null;const{currentAvatar:n,currentDisplayName:i}=t;n&&i&&(s=o.a.createElement("div",{className:"qr-ava-overlay flx flx-al-c flx-col"},o.a.createElement("img",{src:n,className:"qr-ava"}),o.a.createElement(Xe.a,{className:"qr-name truncate"},i),o.a.createElement(u.a,{textKey:"STR_QR_AWAIT_DESC",tagName:"div",className:"qr-desc"})));const r=this.overQRRequest||t.qrNeedsRefresh&&(a||t.qrErrorCode);this.props.onSignInOther;return e=o.a.createElement("div",{id:"qrcode",className:"flx flx-col flx-al-c h100 "+(t.qrNeedsRefresh?" disabled":"")},s||o.a.createElement("div",{id:"qrcode-container",className:_.default.login.qr_v2?"qr-v2":""},o.a.createElement("img",{id:"qrcode-img",className:Object(T.a)(t.qrNeedsRefresh?" disabled":"",_.default.login.qr_v2?"qr-v2":""),src:t.qrcodeImg,style:t.qrNeedsRefresh&&a?{opacity:this.qrErrorFromLoad?0:.9}:null,onLoad:()=>{this.qrErrorFromLoad=!1,this.setState({didloadqr:!0})},onError:()=>{this.qrErrorFromLoad=!0,setTimeout((()=>{this.setState({didloadqr:!0})}),2e3)}}),r||!this.state.didloadqr?o.a.createElement("div",{id:"qrcode-expired",className:"qrcode-expired fadeInAndOut",onClick:()=>{this.overQRRequest||(jt++,this.props.dispatch({type:P}),setTimeout((()=>{this._getQRCode()}),0))}},o.a.createElement("div",{className:"flx flx-col flx-center flx-al-c qr-reload-container fadeInAndOut"+(this.overQRRequest?" not-allowed":this.state.didloadqr?"":" hover-default")},r?o.a.createElement(o.a.Fragment,null,o.a.createElement(ht.a,{className:this.overQRRequest?"icon-outline-report":"outline-reload"}),o.a.createElement(u.a,{textKey:this.overQRRequest?"STR_QR_LIMIT_REACHED":"STR_CLICK_TO_RETRY",className:"reload-title"})):this.getQRLoadingUI())):null,_.default.login.ocr_text?this.getContentOCR():null),a&&this.state.didloadqr?o.a.createElement("div",{className:"error-message"},a):null,s?null:o.a.createElement(o.a.Fragment,null,this.getQRIntroduction(t),o.a.createElement("div",{className:"flx flx-al-c dark-href",onClick:()=>{this.setState({showGuide:!0})}},o.a.createElement(u.a,{textKey:"STR_SIGNIN_QR_GUIDE"}))),o.a.createElement(te.a,{size:"medium",textKey:"STR_SIGNIN_BY_MOBILE",ref:e=>this.otherOptionsRef=e,onClick:this.props.onSignInOther,className:"footer-btn",type:"tertiary-neutral"}),this.state.showGuide&&o.a.createElement(Qt,{qrcodeImg:t.qrcodeImg,onClose:()=>{this.setState({showGuide:!1})}})),o.a.createElement("div",{className:"login-qr h100"},e)}}class zt extends o.a.Component{constructor(e){super(e),this.dispatch=e.dispatch,this.activeType=1,this.accessToken=null,this._onLoginSuccess=this._onLoginSuccess.bind(this),this.isMaybeReq=this.isMaybeReq.bind(this),this._isFocus=!0,this._onVisiblityChanged=(e,t)=>{switch(t){case"blur":document.body.className=document.body.className.replace(" active",""),this._isFocus=!1;break;case"focus":document.body.className.indexOf("active")<0&&(document.body.className+=" active"),!this._isFocus&&this.LoginPassword?(this._isFocus=!0,this.LoginPassword.getLoginCaptcha()):this._isFocus=!0}},this.state={recentdata:E.default.getMostRecentLoggedInData(),configOptRemember:this.getConfigOptionRemember(),languageSelection:J.default.currentLanguage(),isMenuShow:!1,innerLoginPwState:0,refresh:!1,showNoNetwork:!window.navigator.onLine},J.default.loadDBLanguage(),this.pendingReq=!1,rt.o.listenEvent(rt.j,(e=>{this.pendingReq&&e==it.a.CONNECTED&&(this.pendingReq=!1,this.getServerConfig())})),s.default.checkNetwork((e=>{this.setState({showNoNetwork:!e})})),this.setConfigOptionRememberWhenLoginSuccess(this.state.configOptRemember),this.initStateRemember(),this._checkRemember=this._checkRemember.bind(this),this.showMenu=(e,t)=>{this.menu&&this.menu.show(e,t)},this.refresh=()=>{this.setState({refresh:!this.state.refresh})}}componentWillReceiveProps(e){this.props.state.common.visibleComponentName!==e.state.common.visibleComponentName&&("LOGIN_QR"===e.state.common.visibleComponentName?this.lastTabIndex=0:"LOGIN_PASSWORD"===e.state.common.visibleComponentName&&(this.lastTabIndex=1))}initStateRemember(){this.state.isRemember=this.state.configOptRemember!==R.OPTION_SHOW_CHECKBOX||!this.state.recentdata||!s.default.valueValid(this.state.recentdata.isRemember)||this.state.recentdata.isRemember,this.lastTabIndex=this.getLastLoginTab(),E.default.setValueRememberLogin(this.state.isRemember)}getConfigOptionRemember(){let e=Ee.default.getInstance().getItem(R.KEY_CONFIG_OPTION_REMEMBER);return s.default.valueValid(e)||(e=R.OPTION_DEFAULT_REMEMBER,this._needUpdateStateRemember=!0),"number"!=typeof e&&(e="string"==typeof e?parseInt(e):R.OPTION_DEFAULT_REMEMBER),(e>2||e<0)&&(e=R.OPTION_DEFAULT_REMEMBER),e}setConfigOptionRememberWhenLoginSuccess(e){Ee.default.getInstance().setItem(R.KEY_CONFIG_NEW_REMEMBER,e)}isMaybeReq(e){return this._isFocus&&this.props.state.common.visibleComponentName===e}_onGetImei(){return{imei:E.default.getZaloClientID(),installerType:"unknown",autoUpdaterConfig:_.default.auto_updater}}_loginPass(){this.dispatch({type:A}),W(j.LOGIN_STEP_ENTER_LOGIN_PASS)}componentDidMount(){ze.a.isDone()||ze.a.init(),$zsub.$zapp.onClickNoti(this.focusMainWindow),$zresource.onRequestImei(this._onGetImei),it.b.getStateNetwork()==it.a.DISCONNECT?this.pendingReq=!0:setTimeout((()=>{this.getServerConfig()}),100),this.updateLanguage=()=>{this.setState({languageSelection:J.default.currentLanguage()})},J.default.callUpdate(this.updateLanguage),Kt.default.cancel(Kt.MetricName.start_up_time)}componentWillUnmount(){$zsub.$zwindow.removeListenVisibilityChange(this._onVisiblityChanged),$zresource.removeListenRequestImei(this._onGetImei),$zsub.$zapp.removeListenClickNoti(this.focusMainWindow),J.default.removeUpdate(this.updateLanguage)}get Logger(){return this._Logger||(this._Logger=Te.ModuleContainer.resolve(ge.ZLoggerFactory).createZLogger("main",["login"])),this._Logger}getServerConfig(){this.timeoutReq&&(clearTimeout(this.timeoutReq),this.timeoutReq=null),this.pendingReq=!1;const e=e=>{const t=Ee.default.getInstance();if(e.config_option_remember){let a=e.config_option_remember;["number","string"].includes(typeof a)&&("string"==typeof a&&(a=parseInt(a)),!isNaN(a)&&a>=0&&a<=2&&(t.setItem(R.KEY_CONFIG_OPTION_REMEMBER,a),this._needUpdateStateRemember&&(this.setConfigOptionRememberWhenLoginSuccess(a),this.setState({configOptRemember:a}),this._needUpdateStateRemember=!1)))}if(e.sentry_config){a("2ua2").default.saveSentryConfig(e.sentry_config)}e.auto_relaunch_mode&&e.auto_relaunch_timeout,t.checkExist("l-lg-t")||(this.lastTabIndex=e.default_login_method||0,this.refresh()),this.checkHasNewMsg(e.prelogin_operate)};let t=lt.b.getServerConfig();t.already_fetch_server_info_first_time?t&&e(t):lt.b.getServerInfo().then((()=>{t=lt.b.getServerConfig(),t&&e(t)}))}checkHasNewMsg(e){if(!e||!e.is_enable)return;if(!E.default.getLastViewKey(E.default.getLastUserId()))return void this.Logger.zsymb(3,"aV66u8",["hasNewMsg no viewerkey","NWGLq6"]);const t=e.req_configs.timeline,a=this.checkHasNewMsgTimes||0;if(a<t.length){const s=t[a],n=60;setTimeout((()=>{E.default.hasNewMsg().then((t=>{this.Logger.zsymb(3,"ttSwvp",["hasNewMsg result {}","1eEAP0"],t),this.setHasNewMsg(t,e.toast_notify),this.checkHasNewMsg(e)}))}),s*n*1e3+Math.floor(Math.random()*e.req_configs.extra_time)*n*1e3)}this.checkHasNewMsgTimes=a+1}focusMainWindow(){$zwindow.focus();let e=null;switch(this.checkHasNewMsgTimes||0){case 1:e=1900201;break;case 2:e=1900202;break;case 3:e=1900203;break;case 4:e=1900204}e&&(ot.e.logAction(e),ot.e._log())}setHasNewMsg(e,t){if(e){const e=t&&t[J.default.getCurrentLanguageName()]?t[J.default.getCurrentLanguageName()]:t.vi,a={leftButtonText:e&&e.button_content?e.button_content:J.default.str("STR_VIEWMORE"),leftFunc:"focusMainWindow",rightButtonText:null,rightFunc:null,size:{w:324,h:80},eventOnClose:!0};nt.a.createNotify(e&&e.title?e.title:J.default.str("STR_NEW_MESSAGE_LONG"),"",t&&t.icon?t.icon:"https://chat.zalo.me/favicon-96x96.v1.png",null,null,!1,2,a),ot.e.logAction(19001),ot.e._log()}$zapp.updateBadgeCount(0)}_toggleRegister(e){this.activeType=1,e?this.state.recentdata?this.props.dispatch({type:D,payload:{title:J.default.str("STR_ZALO_CONFIRM_TITLE"),message:J.default.str("STR_CONFIRM_CANCEL_LOGIN_FOR_REGISTRATION"),compact:!0,confirmText:J.default.str("STR_YES"),cancelText:J.default.str("STR_NO"),callback:e=>{this.props.dispatch({type:D}),e&&(E.default.setMostRecentLoggedInUserInfo(null),E.default.removeLastViewKey(),E.default.setLastUserId(null),this.setState({recentdata:null}),this.dispatch({type:L}))}}}):this.dispatch({type:L}):this.props.state.pass.security?this.props.dispatch({type:S,payload:""}):this.dispatch({type:this.lastTabIndex?A:P})}_toggleForgotPassword(e,t,a){this.activeType=3,this.defaultPhoneNumber=e,this.defaultCountryIsoCode=t,this.defaultCountryCode=a,this.dispatch({type:L})}_onLoginSuccess(){f().then(this.flushZLogMemory)}_signInAnother(e){this.Logger.zsymb(3,"GbBism",["sign in as another user","_Gd5La"]),this.props.dispatch({type:G}),e&&this.state.recentdata?this.props.dispatch({type:D,payload:{title:"Zalo",message:J.default.str("STR_SIGNIN_CONFIRM_ANOTHER_ACCOUNT"),compact:!0,confirmText:J.default.str("STR_YES"),cancelText:J.default.str("STR_NO"),callback:e=>{this.props.dispatch({type:D}),e&&(E.default.clearLastSignin(),this.setState({recentdata:null}),this._checkRemember(!0,!1))}}}):(E.default.setMostRecentLoggedInUserInfo(null),E.default.removeLastViewKey(),E.default.setLastUserId(null),this.setState({recentdata:null}),this._checkRemember(!0,!1))}_checkRemember(e,t=!0){E.default.setValueRememberLogin(e),t&&E.default.setValueActionLogRemember(e?117066:117067),this.setState({isRemember:e})}onShowMenu(e){this.showMenu(e,this.menuBtn)}closeMenu(){this.menu&&this.menu.close()}onChangeLanguage(e){J.default.changeToLang(e),this.setState({languageSelection:e}),$zapp.changeLanguage(e),this.closeMenu()}onOpenAbout(){this.props.dispatch&&this.props.dispatch({type:at.PopupActions.TOGGLE_APP_INFO}),this.closeMenu()}onOpenDevTools(){this.closeMenu()}changeAdminConfig(e){let t=!!_.default.adminConfig[e];if(_.default.adminConfig[e]=!t,this.forceUpdate(),"onStagingDevAuth"===e)p.b.onStagingDevAuth=!0,Object(_.ChangeToDevDomain)("authDomain");else if("removeImei"===e)try{Ee.default.getInstance().removeItem("z_uuid")}catch(a){}}getAdminConfigs(){return[]}setLastLoginTab(e){Ee.default.getInstance().setItem("l-lg-t",e)}getLastLoginTab(){let e=Ee.default.getInstance().getItem("l-lg-t");return e=e?JSON.parse(e):1,e}onPwChangeView(e){this.props.onChangeView&&this.props.onChangeView(e),this.setState({innerLoginPwState:e})}_renderSecurityAuth(){const e=this.props.state.pass.lastData;switch(e.eCode){case ie.a.SECURITY_QUESTION_REQUIRED:case ie.a.PASSWORD_NOT_SET:return o.a.createElement(pe,{data:e,dispatch:this.props.dispatch,onBack:()=>this._toggleRegister(!1),onLoginSuccess:this._onLoginSuccess});case ie.a.SENSITIVE_FLOW_REQUIRE_OTP_OR_CONFIRM_MOBILE:case ie.a.SENSITIVE_FLOW_REQUIRE_OTP:{let t="confirm_mobile";return e.questionData&&e.questionData.default_option?t=e.questionData.default_option:e.eCode===ie.a.SENSITIVE_FLOW_REQUIRE_OTP&&(t="otp"),o.a.createElement(Lt,{dispatch:this.props.dispatch,defaultOption:t,state:this.props.state})}default:return null}}loginWithMobileRequest(){this.props.dispatch({type:F}),setTimeout((()=>{this._signInAnother(!1)}),1e3)}render(){let e;const t="REGISTER"===this.props.state.common.visibleComponentName;let a="MOBILE_LOGIN"===this.props.state.common.visibleComponentName,s=!(!t||!this.props.state.common.lastData||void 0===this.props.state.common.lastData.answerSecurityFail)&&this.props.state.common.lastData.answerSecurityFail,n=o.a.createElement(Ut,null);const i=e=>{let t=`:flag-${e}:`;return o.a.createElement("span",{className:"emoji-sizer emoji-outer ",style:(a=t,{background:`url(${_.default.emojiImg})`,backgroundSize:"6500%",backgroundPosition:_.default.emojiMapPos[a],WebkitUserDrag:"none",marginLeft:"5px",verticalAlign:"text-bottom",height:"18px"})});var a};if(this.props.state.pass.security)e=o.a.createElement("div",{id:"loginPageMain",className:" login-page__content__container h100 login-padding flx flx-col "},o.a.createElement("img",{src:ne,className:"sign-in-logo"}),this._renderSecurityAuth());else if(t){this.props.state.common.lastData&&this.props.state.common.lastData.activeType&&(this.activeType=this.props.state.common.lastData.activeType);let t=this.props.state.common.lastData&&this.props.state.common.lastData.verifyType?this.props.state.common.lastData.verifyType:null,a=this.props.state.common.lastData&&this.props.state.common.lastData.quotaInfo?this.props.state.common.lastData.quotaInfo:[];e=o.a.createElement("div",{className:"flx flx-center flx-1 h0"},o.a.createElement(Ve,{dispatch:this.props.dispatch,activeType:this.activeType,accessToken:this.accessToken,lastData:this.props.state.common.lastData,phoneNumber:this.defaultPhoneNumber,countryIsoCode:this.defaultCountryIsoCode,countryCode:this.defaultCountryCode,answerSecurityFail:s,verifyType:t,verifyTypes:a,onLogin:()=>this._toggleRegister(!1)}))}else if(a)e=o.a.createElement(kt,{data:this.LoginPassword?{phone:this.LoginPassword.state.phoneNumber,iso:this.LoginPassword.state.countryIsoCode,code:this.LoginPassword.state.countryCode}:this.state.recentdata,state:this.props.state.pass,dispatch:this.props.dispatch,onBack:()=>{this.props.dispatch(this.lastTabIndex?{type:A,payload:{errorMessage:""}}:{type:P})}});else{let t=o.a.createElement(tt,{ref:e=>this.LoginPassword=e,state:this.props.state.pass,recentdata:this.state.recentdata,isVisible:"LOGIN_PASSWORD"===this.props.state.common.visibleComponentName,dispatch:this.props.dispatch,onForgotPasswordClick:(...e)=>this._toggleForgotPassword(...e),visibleComponentName:this.props.state.common.visibleComponentName,signInAnother:this._signInAnother.bind(this),signInWithMobileRequest:this.loginWithMobileRequest.bind(this),isMaybeReq:this.isMaybeReq,checkRemember:this._checkRemember,configOptionRemember:this.state.configOptRemember,isRemember:this.state.isRemember,onSignUp:()=>this._toggleRegister(!0),onChangeView:this.onPwChangeView.bind(this),innerState:this.state.innerLoginPwState}),a="STR_LOGIN_ACCOUNT";e=o.a.createElement("div",{id:"loginPageMain",className:" login-page__content__container h100 login-padding flx flx-col "},o.a.createElement("img",{src:ne,className:"sign-in-logo"}),o.a.createElement(u.a,{textKey:a,className:"sigin-title",tagName:"div"}),o.a.createElement(_t,{onChange:e=>{this.lastTabIndex!=e&&(this.lastTabIndex=e,this.setLastLoginTab(e),this.setState({initialState:0},(()=>{0===e?this.props.dispatch({type:P}):1===e&&this.props.dispatch({type:A,payload:{errorMessage:""}})})))},tabOnly:this.state.innerLoginPwState?1:null,tabOffset:void 0!==this.lastTabIndex&&null!==this.lastTabIndex?this.lastTabIndex:1,tabs:[{textKey:"STR_SIGNIN_QR",domContent:o.a.createElement(Vt,{state:this.props.state.qr,ref:e=>this.LoginQR=e,isVisible:"LOGIN_QR"===this.props.state.common.visibleComponentName,dispatch:this.props.dispatch,checkRemember:this._checkRemember,configOptionRemember:this.state.configOptRemember,recentdata:this.state.recentdata,isRemember:this.state.isRemember,onSignUp:()=>this._toggleRegister(!0),onSignInOther:this.loginWithMobileRequest.bind(this)})},{textKey:"STR_SIGNIN_PASS",domContent:t}]}),o.a.createElement(te.a,{icon:"icon-outline-menu",type:"tertiary-neutral",size:"medium",ref:e=>this.menuBtn=e,onClick:this.onShowMenu.bind(this),className:"login-setting-btn",isActive:this.state.isMenuShow}))}let r;return this.props.state.common.confirm&&(r=o.a.createElement(g.default,{visible:!0,onCloseConfirm:()=>this.props.dispatch({type:D,payload:null}),okType:this.props.state.common.confirm.type,compact:this.props.state.common.confirm.compact,preventPageClickForceClose:this.props.state.common.confirm.preventPageClickForceClose,title:this.props.state.common.confirm.headerText,onOk:()=>this.props.state.common.confirm.callback(!0),onCancel:(e,t)=>this.props.state.common.confirm.callback(!1,t),okText:this.props.state.common.confirm.confirmText,cancelText:this.props.state.common.confirm.cancelText,message:this.props.state.common.confirm.message,width:this.props.state.common.confirm.width,zIndex:this.props.state.common.confirm.zIndex,windowContainer:this.props.state.common.confirm.windowContainer,showCloseButton:!0})),o.a.createElement("div",{id:"loginPage",className:"flx flx-col default login-page w100",style:{marginTop:"40px"}},o.a.createElement("div",{style:{height:"fit-content",position:"absolute",width:"100%",display:this.state.showNoNetwork?"block":"none"},className:this.state.showNoNetwork?"slideInDown":"slideOutUp"},n),r,o.a.createElement("div",{id:"loginPageContent",className:Object(T.a)(["flx","flx-col","login-page__content","w100",this.state.showNoNetwork?"slideDown":""])},e),o.a.createElement($e.default,{popoverProps:{identity:{windowId:Ze.c,name:R.PopoverIdentitiesDefine.SWITCH_LANGUAGE}},ref:e=>this.menu=e,onShow:()=>{this.setState({isMenuShow:!0})},onClose:()=>{this.setState({isMenuShow:!1})},items:[{type:$e.MENU_ITEM_TYPE.SUBMENU,textKey:"STR_MENU_LANGUAGE",items:[{text:"Tiáº¿ng Viá»t",icon:{html:i("vn")},onclick:()=>this.onChangeLanguage(R.LANG_INDEX_VI),checked:this.state.languageSelection==R.LANG_INDEX_VI},{text:"English",icon:{html:i("us")},onclick:()=>this.onChangeLanguage(R.LANG_INDEX_EN),checked:this.state.languageSelection==R.LANG_INDEX_EN}]},{textKey:"STR_ABOUT",onclick:this.onOpenAbout.bind(this)},...this.getAdminConfigs()]}))}}zt.propTypes={state:h.a.object.isRequired,dispatch:h.a.func.isRequired};var Ht=zt,Yt=(a("y1FZ"),a("J39W")),$t=a("IeCS"),Xt=a("/PY/"),Zt=a("ro+J"),Jt=a("Dprd"),ea=a("cHDa"),ta=a("Q97H"),aa=a("mkWZ");class sa extends o.a.Component{constructor(e){super(e),this.state={refresh:!1},this._handleCloseApp=this._handleCloseApp.bind(this),this._onIgnoreBackwardAndForward=this._onIgnoreBackwardAndForward.bind(this),this._clearLastLoginUserId()}_clearLastLoginUserId(){try{s.default.info("remove most recent logged in userId");const e=Ee.default.getInstance();e.removeItem(s.RECENT_USER_ID),"y"===e.getItem("already_login")&&e.removeItem("already_login")}catch(e){s.default.error(e)}}componentDidMount(){ze.a.isDone()||ze.a.init("/login"),s.default.isWeb()||window.addEventListener("mouseup",this._onIgnoreBackwardAndForward)}componentWillUnmount(){s.default.isWeb()||window.removeEventListener("mouseup",this._onIgnoreBackwardAndForward)}_onIgnoreBackwardAndForward(e){3!==e.button&&4!==e.button||e.preventDefault()}_trackingRightAfterInstall(){Jt.default.getInstallSource().then((({installSrc:e,justInstalled:t})=>{t&&e&&(ze.a.trackEvent("distribution","extra_install_launch",e),$zlogin.loginAfterInstall(e))})).catch((e=>{s.default.error("Failed to get install resource ",e)}))}_toggleAppInfo(){this.props.dispatch({type:U})}_handleCloseApp(){const e=()=>{ea.b.deactiveApp(),ta.a.clearSessionBeforeQuit(),ta.a.closeDB($zapp.requestQuitAppImmediately)},t=E.default.getLastLogoutTime();if(Date.now()-t>864e5){let a=J.default.str("STR_LOGOUT_CONFIRM_HEADER"),s=J.default.str("STR_LOGOUT_CONFIRM_TEXT");if(!t){a=J.default.str("STR_LOGOUT_CONFIRM_HEADER_NEW");const e=[o.a.createElement("div",{key:"1_a"},o.a.createElement(u.a,{textKey:"STR_LOGOUT_CONFIRM_TEXT_NEW_1_A"}),o.a.createElement("br",null),o.a.createElement(u.a,{textKey:"STR_LOGOUT_CONFIRM_TEXT_NEW_1_B"})),J.default.str("STR_LOGOUT_CONFIRM_TEXT_NEW_2")];s=e[Math.floor(Math.random()*e.length)]}this.props.dispatch({type:D,payload:{headerText:a,message:s,preventPageClickForceClose:!0,type:"",zIndex:1e4,confirmText:J.default.str("STR_SIGNIN"),cancelText:J.default.str("STR_MENU_QUIT"),callback:(t,a)=>{this.props.dispatch({type:D}),t?ot.e.logAction(117242):a===g.ConfirmModalConstant.ModalClosedReason.CTAButtonClicked&&(ot.e.logAction(117241),setTimeout((()=>{e()}),600)),ot.e._log()}}})}else e()}render(){return o.a.createElement("div",{id:"loginIndex",className:"lg-index",style:{display:"none"}},o.a.createElement("div",{className:"titlebar-os draggable"}),o.a.createElement("div",{className:"flx flx-center flx-1 h0"},o.a.createElement("div",{key:"main",className:"dib fl-r lg-index__main flx-1 w100 h100 "},o.a.createElement(Zt.a,null,o.a.createElement(Ht,Object(c.a)({},this.props,{ref:e=>this.loginRef=e,onChangeView:e=>this.setState({refresh:!this.state.refresh})}))))),o.a.createElement(Zt.a,null,this.props.state.common.showAppInfo?o.a.createElement(Yt.a,{cancel:this._toggleAppInfo.bind(this)}):null,this.props.state.common.showAppUpdateInfo?o.a.createElement($t.default,{info:this.props.state.common.showAppUpdateInfo,cancel:()=>{Ye.ModalManagerV2.closeModal({windowId:Ze.c,name:R.ModalIdentitiesDefine.APP_UPDATE_INFO})}}):null,this.props.state.common.showAppDownloadUpdate?o.a.createElement(Xt.default,{info:this.props.state.common.showAppDownloadUpdate,cancel:()=>{Ye.ModalManagerV2.closeModal({windowId:Ze.c,name:R.ModalIdentitiesDefine.APP_DOWNLOAD_UPDATE})}}):null),o.a.createElement(aa.a,null))}}var na=sa,oa=a("ANjH");a("YaU7");a("vA3+").b,Te.ModuleContainer.resolve(ge.ZLoggerFactory).createZLogger("login",["question"]);o.a.Component;o.a.Component;const ia={qrErrorMessage:"",qrNeedsRefresh:!1,qrErrorCode:null,qrTimeout:null,qrData:null,qrcodeImg:"",showTips:!1,currentDisplayName:"",currentAvatar:"",qrExpired:!1},ra={captchaImg:"",captchaToken:"",loginFail:!1,errorMessage:"ÄÄng nháº­p khÃ´ng thÃ nh cÃ´ng - Login failed",security:Pt,lastData:null,phoneNumber:"",countryCode:84},ca={confirm:null,errorMessage:"",lastData:null,showAppInfo:!1,showAppUpdateInfo:!1,showAppDownloadUpdate:!1,showSetting:!1,visibleComponentName:"LOGIN_PASSWORD"};const la=Object(oa.b)({qr:(e=ia,t)=>{switch(t.type){case b:return Object(d.a)(Object(d.a)({},e),{},{qrcodeImg:"data:image/png;base64,"+t.payload.data.base64_qr,qrNeedsRefresh:!1,qrErrorCode:null,qrTimeout:null});case v:{const a=Object(d.a)(Object(d.a)({},e),{},{qrErrorMessage:t.payload,qrNeedsRefresh:!0,qrErrorCode:null,qrTimeout:null});return null!=t.qrNeedsRefresh&&(a.qrNeedsRefresh=t.qrNeedsRefresh),null!=t.qrErrorCode&&(a.qrErrorCode=t.qrErrorCode),t.qrTimeout&&(a.qrTimeout=t.qrTimeout),a}case P:{const a=Object(d.a)(Object(d.a)({},e),{},{qrNeedsRefresh:!1});return t.payload&&(t.payload.errorMessage&&(a.qrErrorMessage=t.payload.errorMessage),t.payload.data&&(a.qrData=t.payload.data)),a}case w:return Object(d.a)(Object(d.a)({},e),{},{showTips:!0});case M:return Object(d.a)(Object(d.a)({},e),{},{showTips:!1});case k:return Object(d.a)(Object(d.a)({},e),{},{currentDisplayName:t.payload.currentDisplayName,currentAvatar:t.payload.currentAvatar});case x:return ia;case F:case A:return Object(d.a)(Object(d.a)({},e),{},{qrErrorMessage:""});case K:return Object(d.a)(Object(d.a)({},e),{},{qrExpired:t.payload.isExpired});default:return e}},pass:(e=ra,t)=>{switch(t.type){case A:{let a=Object(d.a)(Object(d.a)({},e),{},{loginFail:!0,security:!1});return t.payload&&(null!=t.payload.phoneNumber&&(a=Object(d.a)(Object(d.a)({},a),{},{phoneNumber:t.payload.phoneNumber,countryCode:t.payload.countryCode})),null!=t.payload.errorMessage&&(a=Object(d.a)(Object(d.a)({},a),{},{errorMessage:t.payload.errorMessage}))),a}case I:{let a=[ie.a.SECURITY_QUESTION_REQUIRED,ie.a.PASSWORD_NOT_SET,ie.a.SENSITIVE_FLOW_REQUIRE_OTP_OR_CONFIRM_MOBILE,ie.a.SENSITIVE_FLOW_REQUIRE_OTP].indexOf(t.payload.eCode)>=0;a&&(a=C);const s=Object(d.a)(Object(d.a)({},e),{},{lastData:Object(d.a)({},e.lastData),loginFail:!0,security:a});return t.payload&&(s.lastData=Object(d.a)(Object(d.a)({},s.lastData),t.payload)),s}case q:return Object(d.a)(Object(d.a)({},e),{},{lastData:t.payload,loginFail:!0,security:!0});case O:return Object(d.a)(Object(d.a)({},e),{},{lastData:Object(d.a)(Object(d.a)({},e.lastData),{},{questionData:t.payload})});case S:return Object(d.a)(Object(d.a)({},e),{},{loginFail:!0,errorMessage:t.payload,security:!1,lastData:null});case P:return Object(d.a)(Object(d.a)({},e),{},{lastData:null,security:!1});case y:return Object(d.a)(Object(d.a)({},e),{},{captchaImg:"data:image/png;base64,"+t.payload.data.data.captcha_img,captchaToken:t.payload.data.data.token});case G:return Object(d.a)(Object(d.a)({},e),{},{security:!1,lastData:null,loginFail:!1,countryCode:84,errorMessage:""});case x:return ra;default:return e}},common:(e=ca,t)=>{var a;switch(t.type){case A:return Object(d.a)(Object(d.a)({},e),{},{visibleComponentName:"LOGIN_PASSWORD",errorMessage:void 0!==(null===(a=t.payload)||void 0===a?void 0:a.errorMessage)?t.payload.errorMessage:e.errorMessage,confirm:null});case P:return Object(d.a)(Object(d.a)({},e),{},{visibleComponentName:"LOGIN_QR"});case L:{const a=Object(d.a)(Object(d.a)({},e),{},{visibleComponentName:"REGISTER"});return t.payload&&(a.lastData=Object(d.a)(Object(d.a)({},e.lastData),t.payload)),a}case at.PopupActions.TOGGLE_CONFIRM:case D:return Object(d.a)(Object(d.a)({},e),{},{confirm:t.payload});case U:case at.PopupActions.TOGGLE_APP_INFO:return Object(d.a)(Object(d.a)({},e),{},{showAppInfo:!e.showAppInfo});case at.PopupActions.TOGGLE_SETTING:return Object(d.a)(Object(d.a)({},e),{},{showSetting:!e.showSetting});case at.PopupActions.SHOW_APP_UPDATE_INFO:return Object(d.a)(Object(d.a)({},e),{},{showAppUpdateInfo:t.payload});case at.PopupActions.SHOW_APP_DOWNLOAD_UPDATE:return Object(d.a)(Object(d.a)({},e),{},{showAppDownloadUpdate:t.payload});case F:var s;return Object(d.a)(Object(d.a)({},e),{},{passingError:(null===(s=t.payload)||void 0===s?void 0:s.error)||null,visibleComponentName:"MOBILE_LOGIN"});case I:return Object(d.a)(Object(d.a)({},e),{},{visibleComponentName:"SECQ"});default:return e}}});var ha=Object(oa.d)(la),ua=a("CzFt"),da=a("YGiT"),_a=a("hI9i");a("U96N"),Object(da.a)();a("2ua2").default.init();s.default.checkSupport();const pa=Object(r.b)((function(e){return{state:e}}),(function(e){return{dispatch:t=>{Object(ua.c)(t),e(t)}}}))(na);Object(i.render)(o.a.createElement(r.a,{store:ua.a,context:ua.b},o.a.createElement(r.a,{store:ha},o.a.createElement(r.a,{store:_a.b,context:_a.a},o.a.createElement(pa,null)))),document.getElementById("app"));a("TGaw"),a("Ppsz");var ma=a("wH4e"),Ea=a("+eUS");Object(Ea.a)(ma.RunMode.Host)}}]);
//# sourceMappingURL=../sourcemaps/lazy/login-startup.2ff8e07e3f2b9301118b.js.map