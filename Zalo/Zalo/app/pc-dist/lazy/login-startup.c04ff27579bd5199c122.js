(this.webpackJsonp=this.webpackJsonp||[]).push([[23],{"0goA":function(e,t,a){"use strict";t.a="assets/logo-new.146dfa01c78183631d33b77999a18288.svg"},"36dD":function(e,t,a){},"47Cz":function(e,t,a){},"4I9T":function(e,t){},"6LLQ":function(e,t,a){"use strict";t.a="assets/icon-warning.aba0fe2b3ce9e1275b1effba1f00f45c.svg"},BMoG:function(e,t){},Pszc:function(e,t){},U96N:function(e,t,a){},"Xu+P":function(e,t,a){},cy9f:function(e,t,a){},hGpA:function(e,t,a){},o30X:function(e,t){},t3EU:function(e,t,a){},w4sY:function(e,t,a){},xNPa:function(e,t,a){},y65y:function(e,t,a){},yQh1:function(e,t,a){},zn3J:function(e,t,a){"use strict";a.r(t);a("TlRV"),a("m+NF");var n,o=a("J25b"),s=a("jDHv");Object(s.singleton)(o.b)(n=class{getHourNow(){return(new Date).getHours()}getTimeNow(){return Date.now()}getSystemTimeNow(){return Date.now()}});a("bO0B"),a("dhzt"),a("jmmm"),a("xDXR"),a("WrSY"),a("LyOm"),a("lNuO"),a("xir9"),a("4Vil"),a("0rWR"),a("Lq8m"),a("EicM"),a("nUpV"),a("5yGw"),a("hRcX"),a("/2rj"),a("gpNb"),a("rhBN"),a("BP4/"),a("cF85"),a("9AEM"),a("fNRA"),a("7g9m");var r,i=a("drXQ"),c=a("Hw41"),l=a("DI/x"),u=a("x9oK"),d=a("xM06"),_=a("Uzj0"),h=a("Mgpg");let m=s.ModuleContainer.injectable()(r=Reflect.metadata("design:type",Function)(r=Reflect.metadata("design:paramtypes",[])(r=class{constructor(){this.logger=void 0,this.installContainer=null;const e=s.ModuleContainer.resolve(h.ZLoggerFactory);this.logger=e.createZLogger("db",["adapter-factory"])}async setupOnce(){return null===this.installContainer&&(this.installContainer=new _.b.Container,(async()=>{try{const e=s.ModuleContainer.resolve(c.b),t=await e.getPort(),a={typeID:d.i,data:{type:d.f,data:{}}};await t.invokeMessage(a),this.logger.zsymb(0,"TGNIlb","Done clear sessional pools"),this.installContainer.resolve()}catch(e){this.installContainer.reject(e)}})()),this.installContainer.promise}async createAdapter(e,t){if(await this.setupOnce(),t.sessional)throw new l.a(e,"Sessional database adapter is not allowed");return i.a.factory(e,t)}async getExistedPartitionKeys(e){await this.setupOnce();const t=s.ModuleContainer.resolve(c.b),a=await t.getPort(),n={typeID:d.i,data:{type:d.n,data:{fullname:e}}};return a.invokeMessage(n)}})||r)||r)||r;s.ModuleContainer.registerSingleton(u.c,m);a("6Pbj"),a("5lV7"),a("vUp1"),a("szdT"),a("Ws6j"),a("mneU"),a("tPRg"),a("dThN");var g=a("z0WU"),p=(a("XS0u"),a("q1tI")),y=a.n(p),E=a("i8i4"),f=a("/MKj"),S=a("Ff2n");function T(){return g.default.getZaloClientID()}var N=a("VTBJ"),R=a("IeCS"),I=a("/PY/"),C=a("ro+J"),v=a("J39W"),O=a("Ja3U"),b=a("3xbP"),A=a("Yi2m"),w=a("4prX"),P=a("KwLe"),M=a("nQja"),x=a("cHDa"),L=a("Q97H");function k(){x.b.deactiveApp(),L.a.clearSessionBeforeQuit(),L.a.closeDB($zapp.requestQuitAppImmediately,{})}var D=a("ZwwW");var U=a("Enw1");var G=a("igA5");const q={get:(e,t,a)=>Reflect.get(e,t,a),set:(e,t,a)=>Reflect.set(e,t,a)},j=new Proxy(G.default.getInstance(),q);function Q(){return j}var K=a("c51z");const B={get:(e,t,a)=>Reflect.get(e,t,a),set:()=>!1},F=new Proxy(K.default,B),z=y.a.createContext({token:""}),W=()=>y.a.useContext(z);var V=a("iuhU");let H=function(e){return e.Idle="Idle",e.LoginQR="LoginQR",e.LoginNormal="LoginNormal",e.ForgetPassword="ForgetPassword",e.LoginSuccess="LoginSuccess",e}({}),X=function(e){return e.WaitingScan="WaitingScan",e.TimeoutQR="TimeoutQR",e.WaitingAccept="WaitingAccept",e}({});const Y=new Proxy({main_choose_login_qr:"[main][choose-login-qr]",main_choose_login_normal:"[main][choose-login-normal]",main_forget_password:"[main][forget-password]",main_accepted_login:"[main][accepted-login]",qr_scaned:"[qr][scaned]",qr_timeout:"[qr][timeout]",qr_accepted_login:"[qr][accepted-login]",qr_regen_qr:"[qr][regen-qr]"},{get:(e,t,a)=>Reflect.get(e,t,a),set:()=>!1});class Z{constructor(){this.key=void 0,this.data=void 0,this.enterTime=void 0,this.exitTime=void 0,this.env=void 0}}class J{constructor(){this.stateKey=void 0,this.parrent=void 0,this.children=void 0}}class $ extends Z{constructor(e,t,a){super(),this.key=e,this.env=t,this.logger=a,this.data=void 0,this.enterTime=void 0,this.exitTime=void 0,this.data=null,this.enterTime=0,this.exitTime=0}_formatDateTime(e){return`${e.getFullYear()}-${(e.getMonth()+1).toString().padStart(2,"0")}-${e.getDate().toString().padStart(2,"0")}T${e.getHours().toString().padStart(2,"0")}:${e.getMinutes().toString().padStart(2,"0")}:${e.getSeconds().toString().padStart(2,"0")}.${e.getMilliseconds().toString().padStart(3,"0")}Z`}enter(){var e;this.enterTime=Date.now(),null===(e=this.logger)||void 0===e||e.zsymb(0,"v_xdss",`{job:"login-v2-state-machine",env:${this.env}} ${this._formatDateTime(new Date(this.enterTime))} state[${this.key}]: Enter`)}exit(){var e;this.exitTime=Date.now(),null===(e=this.logger)||void 0===e||e.zsymb(0,"N69taL",`{job:"login-v2-state-machine",env:${this.env}} ${this._formatDateTime(new Date(this.exitTime))} state[${this.key}]: Exit`)}error(...e){var t;null===(t=this.logger)||void 0===t||t.zsymb(18,"_5gInM",`{job:"login-v2-state-machine",env:${this.env}} ${this._formatDateTime(new Date)} state[${this.key}]: ${e}`)}noti(...e){var t;null===(t=this.logger)||void 0===t||t.zsymb(0,"Awb9C2",`{job:"login-v2-state-machine",env:${this.env}} ${this._formatDateTime(new Date)} state[${this.key}]: ${e}`)}}class ee extends J{constructor(e,t,a){super(),this.logger=a,this.stateKey=void 0,this.action=void 0,this.parrent=void 0,this.children=void 0,this.parrent=e,this.children=null,this.stateKey=X.WaitingScan;const n={};Object.keys(X).forEach((e=>{n[X[e]]=new $(X[e],t,this.logger)})),this.action=Object(N.a)({},n)}get state(){return this.action[this.stateKey]}transaction(e){this.action[this.stateKey].exit(),this.stateKey=e,this.action[this.stateKey].enter()}handler(e){let t=null;switch(e){case Y.qr_scaned:this.stateKey===X.WaitingScan&&(t=X.WaitingAccept);break;case Y.qr_timeout:this.stateKey!==X.WaitingScan&&this.stateKey!==X.WaitingAccept||(t=X.TimeoutQR);break;case Y.qr_regen_qr:this.stateKey===X.TimeoutQR&&(t=X.WaitingScan);break;case Y.qr_accepted_login:var a;if(this.stateKey===X.WaitingAccept)t=X.TimeoutQR,null===(a=this.parrent)||void 0===a||a.handler(Y.main_accepted_login)}if(t)return this.transaction(t),this.state;throw Error("state or event can not be adapted")}}class te extends J{constructor(e,t){super(),this.logger=t,this.stateKey=void 0,this.action=void 0,this.parrent=void 0,this.children=void 0;const a={};Object.keys(H).forEach((t=>{a[H[t]]=new $(H[t],e,this.logger)})),this.action=Object(N.a)({},a),this.stateKey=H.Idle,this.parrent=null,this.children=(new Map).set("LoginQRStateMachine",new ee(this,t)),this.action[this.stateKey].enter()}transaction(e){this.action[this.stateKey].exit(),this.stateKey=e,this.action[this.stateKey].enter(),e===H.LoginQR&&this.loginQrState.state.enter()}get state(){return this.action[this.stateKey]}get loginQrState(){var e;const t=null===(e=this.children)||void 0===e?void 0:e.get("LoginQRStateMachine");if(t&&this.children)return t;throw"This children haven't been init"}handler(e){let t=null;switch(e){case Y.main_choose_login_qr:this.stateKey!==H.Idle&&this.stateKey!==H.LoginNormal||(t=H.LoginQR);break;case Y.main_choose_login_normal:this.stateKey!==H.LoginQR&&this.stateKey!==H.ForgetPassword||(t=H.LoginNormal);break;case Y.main_forget_password:this.stateKey===H.LoginNormal&&(t=H.ForgetPassword);break;case Y.main_accepted_login:this.stateKey!==H.ForgetPassword&&this.stateKey!==H.LoginNormal&&this.loginQrState.state.key!==X.WaitingAccept||(t=H.LoginSuccess)}if(t)return this.transaction(t),this.state;throw Error("state or event can not be adapted")}}class ae{constructor(e,t){this.fn=void 0,this.scheduler=void 0,this.deps=[],this.fn=e,this.scheduler=t}_cleanupEffect(){this.deps.forEach((e=>{e.delete(this)})),this.deps.length=0}run(){this._cleanupEffect(),ae.activeEffect=this;const e=this.fn();return ae.activeEffect=null,e}}function ne(e,t){const a=new ae(e,t);return a.run(),a}ae.activeEffect=null;const oe=new WeakMap;function se(e,t){if(!ae.activeEffect)return;let a=oe.get(e);a||(a=new Map,oe.set(e,a));let n=a.get(t);n||(n=new Set,a.set(t,n)),n.has(ae.activeEffect)||(n.add(ae.activeEffect),ae.activeEffect.deps.push(n))}const re=new WeakMap;function ie(e){if(re.has(e))return re.get(e);const t=new Map,a=new Proxy(e,{get(e,a,n){if(t.has(a))return se(e,a),t.get(a);{const o=Object.getOwnPropertyDescriptor(e,a);let s=Reflect.get(e,a,o?n:e);return"function"==typeof s?s=s.bind(e):"object"==typeof s&&null!==s&&(s=ie(s)),t.set(a,s),se(e,a),s}},set:(e,a,n,o)=>(t.set(a,n),function(e,t){const a=oe.get(e);if(!a)return;const n=a.get(t);n&&new Set(n).forEach((e=>{e.scheduler?e.scheduler():e.run()}))}(e,a),Reflect.set(e,a,n,o))});return re.set(e,a),a}function ce(e){let t,a=!0;const n=ne((()=>{a&&(t=e(),a=!1)}),(()=>a=!0));return{get value(){return a&&n.run(),se({effectFn:n},"value"),t}}}function le(e){const[,t]=Object(p.useState)({}),a=Object(p.useRef)(e),n=Object(p.useRef)(ie(a.current)).current;return Object(p.useEffect)((()=>{ne((()=>{for(const e in a.current)n[e];t({})}))}),[n]),n}var ue=a("lCMA"),de=a("zRkS"),_e=a("NGyP"),he=a("iQAb"),me=a("wudS");function ge(){const e=Object(me.e)();return Array.isArray(e)?e.join(","):""}const pe=({data:e})=>y.a.createElement("div",{style:{width:"100%",display:"flex",flexDirection:"column",alignItems:"center",boxSizing:"border-box",gap:"16px"}},y.a.createElement(_e.a,{size:"xxl",target:Object(N.a)({},e),userId:ge()}),y.a.createElement(he.a,{className:"truncate",style:{fontSize:"16px",fontWeight:"600",lineHeight:"24px",color:"var(--text-primary)"}},e.displayName),y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_AWAIT_ACCEPTED",style:{color:"var(--text-secondary)",width:"90%",textAlign:"center",fontSize:"14px",lineHeight:"20px",fontWeight:400}})),ye=()=>y.a.createElement("div",{className:"instructions"},y.a.createElement("span",{key:"qr-login-guide-1",style:{display:"flex",flexDirection:"row",color:"var(--text-primary)",width:"100%",fontSize:"14px",lineHeight:"20px",fontWeight:400,alignItems:"center"}},"1.  ",y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_GUIDE_1",tagName:"div"})),y.a.createElement("span",{key:"qr-login-guide-2",style:{flexWrap:"wrap",display:"flex",flexDirection:"row",color:"var(--text-primary)",width:"100%",fontSize:"14px",lineHeight:"20px",fontWeight:400,alignItems:"center"}},"2.  ",y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_GUIDE_2_1",tagName:"div"}),y.a.createElement(de.a,{icon:"qr_code_20",style:{fontSize:"20px",width:"20px",height:"20px",marginTop:"2px",marginLeft:"1px",marginRight:"1px"}}),y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_GUIDE_2_2",tagName:"div"})),y.a.createElement("span",{key:"qr-login-guide-3",style:{display:"flex",flexDirection:"row",color:"var(--text-primary)",width:"100%",fontSize:"14px",lineHeight:"20px",fontWeight:400,alignItems:"center"}},"3.  ",y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_GUIDE_3",tagName:"div"}))),Ee="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDIiIGhlaWdodD0iNDIiIHZpZXdCb3g9IjAgMCA0MiA0MiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxnPgogICAgICAgIDxwYXRoCiAgICAgICAgICAgIGQ9Ik0yNy43MjA3IDMuNTg0M0MzMC4wMDc3IDQuNDY2NjYgMzIuMDk4NiA1Ljc5MDgzIDMzLjg3MzkgNy40ODEyM0MzNS42NDkxIDkuMTcxNjMgMzcuMDc0MSAxMS4xOTUxIDM4LjA2NzQgMTMuNDM2MkMzOS4wNjA2IDE1LjY3NzMgMzkuNjAyNyAxOC4wOTIxIDM5LjY2MjggMjAuNTQyN0MzOS43MjI4IDIyLjk5MzMgMzkuMjk5NSAyNS40MzE4IDM4LjQxNzIgMjcuNzE4OEMzNy41MzQ4IDMwLjAwNTggMzYuMjEwNyAzMi4wOTY3IDM0LjUyMDMgMzMuODcyQzMyLjgyOTkgMzUuNjQ3MyAzMC44MDYzIDM3LjA3MjIgMjguNTY1MiAzOC4wNjU1QzI2LjMyNDIgMzkuMDU4NyAyMy45MDk0IDM5LjYwMDggMjEuNDU4OCAzOS42NjA5QzE5LjAwODIgMzkuNzIwOSAxNi41Njk3IDM5LjI5NzYgMTQuMjgyNyAzOC40MTUzQzExLjk5NTYgMzcuNTMyOSA5LjkwNDggMzYuMjA4OCA4LjEyOTUxIDM0LjUxODRDNi4zNTQyMyAzMi44MjggNC45MjkyOCAzMC44MDQ1IDMuOTM2MDIgMjguNTYzNEMyLjk0Mjc2IDI2LjMyMjMgMi40MDA2NCAyMy45MDc1IDIuMzQwNjIgMjEuNDU2OUMyLjI4MDU5IDE5LjAwNjMgMi43MDM4NCAxNi41Njc4IDMuNTg2MTkgMTQuMjgwOEM0LjQ2ODU1IDExLjk5MzggNS43OTI3MiA5LjkwMjkxIDcuNDgzMTIgOC4xMjc2MkM5LjE3MzUyIDYuMzUyMzQgMTEuMTk3IDQuOTI3MzkgMTMuNDM4MSAzLjkzNDEzQzE1LjY3OTIgMi45NDA4NyAxOC4wOTQgMi4zOTg3NSAyMC41NDQ2IDIuMzM4NzNDMjIuOTk1MiAyLjI3ODcgMjUuNDMzNyAyLjcwMTk1IDI3LjcyMDcgMy41ODQzTDI3LjcyMDcgMy41ODQzWiIKICAgICAgICAgICAgc3Ryb2tlPSIjQzdFMEZGIiBzdHJva2Utd2lkdGg9IjQiIC8+CgogICAgICAgIDxwYXRoCiAgICAgICAgICAgIGQ9Ik0yNy43MjA3IDMuNTg0M0MzMS4zOTg1IDUuMDAzMjIgMzQuNTMyNyA3LjU1MDAyIDM2LjY3NCAxMC44NTk3QzM4LjgxNTQgMTQuMTY5NCAzOS44NTQxIDE4LjA3MiAzOS42NDExIDIyLjAwODMiCiAgICAgICAgICAgIHN0cm9rZT0iIzMzODRGRiIgc3Ryb2tlLXdpZHRoPSI0IiBzdHJva2UtbGluZWNhcD0icm91bmQiIC8+CiAgICAgICAgPGFuaW1hdGVUcmFuc2Zvcm0KICAgICAgICAgICAgYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIgogICAgICAgICAgICBiZWdpbj0iMHMiCiAgICAgICAgICAgIGR1cj0iNjAwbXMiCiAgICAgICAgICAgIHR5cGU9InJvdGF0ZSIKICAgICAgICAgICAgZnJvbT0iMCAyMSAyMSIKICAgICAgICAgICAgdG89IjM2MCAyMSAyMSIKICAgICAgICAgICAgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiCiAgICAgICAgLz4KCiAgICA8L2c+Cjwvc3ZnPg==";var fe=a("0goA");function Se(e){var t,a,n,o,s,r;return{base64Qr:null!==(t=null==e?void 0:e.base64_qr)&&void 0!==t?t:"",chkWaitCfirm:null!==(a=null==e?void 0:e.chk_wait_cfirm)&&void 0!==a?a:"",chkWaitScan:null!==(n=null==e?void 0:e.chk_wait_scan)&&void 0!==n?n:"",qrRetry:null!==(o=null==e?void 0:e.qr_retry)&&void 0!==o?o:0,qrTimeout:null!==(s=null==e?void 0:e.qr_timeout)&&void 0!==s?s:0,tokenId:null!==(r=null==e?void 0:e.token_id)&&void 0!==r?r:""}}function Te(e){var t,a;return{avatar:null!==(t=null==e?void 0:e.avatar)&&void 0!==t?t:"",displayName:null!==(a=null==e?void 0:e.display_name)&&void 0!==a?a:""}}a("Pszc"),a("4I9T");a("o30X"),a("BMoG");var Ne=a("fBUP"),Re=a("1pet");const Ie=new Proxy(Re,{get:(e,t,a)=>Reflect.get(e,t,a),set:()=>!1});function Ce(){return Ie}var ve=a("X4fA");class Oe{constructor(e){this.value=e,this._tag="Left"}}class be{constructor(e){this.value=e,this._tag="Right"}}const Ae=e=>new Oe(e),we=e=>new be(e);class Pe extends Error{constructor({code:e="STR_ERROR_UNKNOWN",name:t="ErrorApi",message:a="STR_ERROR_UNKNOWN",data:n=null}){super(a),this.code=void 0,this.message=void 0,this.name=void 0,this.data=void 0,this.code=e,this.message=a,this.name=t,this.data=n}}function Me(e){return 0===(null==e?void 0:e.error_code)?we(null==e?void 0:e.data):Ae(new Pe({code:null==e?void 0:e.error_code,message:null!==(t=null==e?void 0:e.error_message_localize)&&void 0!==t?t:null==e?void 0:e.error_message,data:(null==e?void 0:e.data)||null}));var t}async function*xe(e,t,a){for(let y=a;y>0;y--)try{var n,o,s,r,i;const a=await Ne.default.getStatusQRCode(e,t);if(200===(null==a?void 0:a.status)&&null!=a&&null!==(n=a.data)&&void 0!==n&&n.data&&0===(null==a||null===(o=a.data)||void 0===o?void 0:o.error_code))yield{data:a.data.data,error_code:a.data.error_code,error_message:a.data.error_message};else if(200===(null==a?void 0:a.status)&&null!=a&&null!==(s=a.data)&&void 0!==s&&s.data&&-20===(null==a||null===(r=a.data)||void 0===r?void 0:r.error_code))yield{data:a.data.data,error_code:a.data.error_code,error_message:a.data.error_message};else if(200===(null==a?void 0:a.status)&&18010===(null==a||null===(i=a.data)||void 0===i?void 0:i.error_code)){var c,l,u;yield{data:(null==a||null===(c=a.data)||void 0===c?void 0:c.data)||null,error_code:(null==a||null===(l=a.data)||void 0===l?void 0:l.error_code)||a.status,error_message:(null==a||null===(u=a.data)||void 0===u?void 0:u.error_message)||a.statusText}}else{var d,_,h,m,g;if(!(y-1>0))throw{data:(null==a||null===(d=a.data)||void 0===d?void 0:d.data)||null,error_code:(null==a||null===(_=a.data)||void 0===_?void 0:_.error_code)||(null==a||null===(h=a.data)||void 0===h?void 0:h.error)||a.status,error_message:(null==a||null===(m=a.data)||void 0===m?void 0:m.error_message)||(null==a||null===(g=a.data)||void 0===g?void 0:g.errorMsg)||a.statusText};yield null}}catch(p){throw p instanceof Error&&"Network Error"===p.message?new Pe({code:"STR_CONNECTION_ERROR",message:"STR_CONNECTION_ERROR",name:"Network Error"}):408===p.error_code?new Pe({code:"STR_LOGIN_QR_PAGE_QR_TIMEOUT_ERROR",message:"STR_LOGIN_QR_PAGE_QR_TIMEOUT_ERROR",name:"408"}):p}}a("yQh1");var Le=a("kEG/");const ke={get:(e,t,a)=>Reflect.get(e,t,a),set:()=>!1},De=new Proxy(Le.a,ke),Ue=()=>{const e=W(),t=Object(p.useRef)(null),a=Object(p.useRef)(null),n=le({loginQrStateKey:e.stateMachine.loginQrState.state.key,qrData:Se(),previewInfo:Te(),qrGenLimit:!1,countDownQRLimited:89,errorMessage:""}),o=ce((()=>n.loginQrStateKey===X.TimeoutQR||n.qrGenLimit)),s=ce((()=>!(n.loginQrStateKey===X.TimeoutQR||n.qrGenLimit||n.qrData.base64Qr)));async function r(){let t=!1;try{const e=await async function(e,t,a){try{const n=await Ne.default.getQRCode(e,t,a),o=Me(null==n?void 0:n.data);if("Right"===o._tag)return Se(null==o?void 0:o.value);throw o.value}catch(n){throw n instanceof Error&&"Network Error"===n.message?new Pe({code:"STR_CONNECTION_ERROR",message:"STR_CONNECTION_ERROR",name:"Network Error"}):n}}(T(),ge(),F.getCurrentLanguageName());i(e),setTimeout((()=>{n.qrData=e}),300),t=!0}catch(s){if(e.stateMachine.state.error(`Cause by _callBackGetQR : ${JSON.stringify(s)}`),s instanceof Pe)if("string"==typeof(null==s?void 0:s.code))n.errorMessage=F.str(s.code);else if(s.code===De.REQUEST_RATE_LIMIT_EXCEEDED){var a,o;n.errorMessage=s.message;let e=null!==(a=s.data)&&void 0!==a&&a.time_left&&"number"==typeof(null===(o=s.data)||void 0===o?void 0:o.time_left)?Math.round(s.data.time_left/1e3):89;e+=5-e%5,n.countDownQRLimited=e>20?e:20,n.qrGenLimit=!0}else n.errorMessage=s.message;else n.errorMessage=F.str("STR_ERROR_UNKNOWN");e.loginSession.loginQrStateStream.next(e.stateMachine.loginQrState.handler(Y.qr_timeout))}finally{e.loginSession.logInfoV2Stream.next({type:152402,subType:0,data:{qr_status:t}})}}async function i(t){try{n.previewInfo=await async function(e,t,a){const n=xe(e,t,a);try{for await(const e of n){if(null===e)continue;const t=Me(e);if("Right"===t._tag)return Te(t.value);throw t.value}}catch(o){throw o}throw new Pe({})}(t.chkWaitScan,t.qrTimeout,t.qrRetry),e.loginSession.loginQrStateStream.next(e.stateMachine.loginQrState.handler(Y.qr_scaned))}catch(a){if(e.stateMachine.state.error(`Cause by _callBackAwaitScanQR : ${JSON.stringify(a)}`),a instanceof Pe)if("string"==typeof(null==a?void 0:a.code))n.errorMessage=F.str(a.code);else{if(-20===a.code)return n.qrData=Se(a.data),void i(n.qrData);a.code===De.REQUEST_RATE_LIMIT_EXCEEDED?(n.qrGenLimit=!0,n.errorMessage=a.message):n.errorMessage=a.message}else n.errorMessage=F.str("STR_ERROR_UNKNOWN");e.loginSession.loginQrStateStream.next(e.stateMachine.loginQrState.handler(Y.qr_timeout))}}function c(){e.loginSession.logInfoV2Stream.next({type:152405,subType:0,data:{}}),e.loginSession.loginQrStateStream.next(e.stateMachine.loginQrState.handler(Y.qr_regen_qr))}async function l(){try{const t=await async function(e,t,a){const n=xe(e,t,a);try{for await(const e of n){if(null===e)continue;const t=Me(e);if("Right"===t._tag){var o,s,r;const e=t.value,a=G.default.getInstance(),n=null!==(o=null==e?void 0:e.uid)&&void 0!==o?o:"",i=null!==(s=null==e?void 0:e.dkey)&&void 0!==s?s:"";if(n&&i){const e=Object(me.c)(n);a.init(n,i),e||a.setItemForCurrentUser(Ce().FirstLoginLocalStorageKeys.IS_FIRST_LOGIN,"1")}g.default.extractPhoneInfoAndSaveRecent(e.profile.phonenum)||(a.removeItem(g.RECENT_PHONE),a.removeItem(g.RECENT_COUNTRY));const c=!!e.needSyncMsg||!!e.sync_msg_info;return a.setItem("z_needSyncMsg",c?"1":""),a.setItem(Ce().KEY_REMEMBER,ve.default.getValueRememberLogin()?"1":""),a.setItem(Ce().KEY_SET_VALUE_ACTION_LOG,`${ve.default.getValueActionLogRemember()}`),null!=e&&e.cptch_cert&&a.setItem("captcha_cert",e.cptch_cert),a.setItem("FORCE_GET_FRIEND_LIST","1"),await $zelectron.setAppCookie(null!==(r=null==e?void 0:e.zpw_sek)&&void 0!==r?r:""),n}throw t.value}}catch(i){throw i}throw new Pe({})}(n.qrData.chkWaitCfirm,n.qrData.qrTimeout,n.qrData.qrRetry);e.loginSession.loginQrStateStream.next(e.stateMachine.loginQrState.handler(Y.qr_accepted_login)),e.stateMachine.state.data={typeLogin:Ce().LOGIN_TYPE_QR},e.loginSession.loginStateStream.next(e.stateMachine.state),e.loginSession.logInfoV2Stream.next({type:152404,subType:0,data:{authentication_status:!0,login_method:"qr",uid:t}})}catch(t){e.stateMachine.state.error(`Cause by _callBackWaitingAccept: ${JSON.stringify(t)}`),t instanceof Pe?"string"==typeof(null==t?void 0:t.code)?n.errorMessage=F.str(t.code):n.errorMessage=t.message:n.errorMessage=F.str("STR_ERROR_UNKNOWN"),e.loginSession.loginQrStateStream.next(e.stateMachine.loginQrState.handler(Y.qr_timeout)),e.loginSession.logInfoV2Stream.next({type:152404,subType:0,data:{authentication_status:!1,login_method:"qr",error_code:(null==t?void 0:t.code)||(null==t?void 0:t.error_code)||t}})}}return Object(p.useEffect)((()=>{e.loginSession.loginQrStateStream.subscribe((e=>{e&&(n.loginQrStateKey=e.key)})),e.loginSession.loginStateStream.subscribe((t=>{if(t&&t.key===H.LoginNormal&&n.loginQrStateKey===X.WaitingScan&&n.errorMessage&&(n.errorMessage=""),t&&n.loginQrStateKey===X.TimeoutQR&&!n.qrGenLimit&&t.key===H.LoginQR)c();else if(t&&t.key===H.LoginQR&&!n.qrGenLimit&&n.loginQrStateKey===X.WaitingScan){var a,o,s;if(null!==(a=t.data)&&void 0!==a&&a.error_from_login_password)n.errorMessage=null!==(o=null===(s=Object(N.a)({},t.data))||void 0===s?void 0:s.error_from_login_password)&&void 0!==o?o:"",e.stateMachine.state.data=null}}))}),[]),Object(p.useEffect)((()=>{if(n.loginQrStateKey===X.WaitingScan){var t,a,o;if(null!==(t=e.stateMachine.state.data)&&void 0!==t&&t.error_from_login_password)n.errorMessage=null!==(a=null===(o=Object(N.a)({},e.stateMachine.state.data))||void 0===o?void 0:o.error_from_login_password)&&void 0!==a?a:"",e.stateMachine.state.data=null;else n.errorMessage="";r()}else n.loginQrStateKey===X.WaitingAccept?l():n.loginQrStateKey===X.TimeoutQR&&(n.previewInfo=Te(),n.qrData=Se())}),[n.loginQrStateKey]),Object(p.useEffect)((()=>{if(n.qrGenLimit){a.current=window.setInterval((()=>{n.countDownQRLimited>0&&n.countDownQRLimited--}),1e3);const e=n.countDownQRLimited;t.current=window.setTimeout((()=>{n.qrGenLimit=!1,n.countDownQRLimited=89,c(),t.current&&window.clearTimeout(t.current),a.current&&window.clearTimeout(a.current)}),1e3*e)}return()=>{t.current&&window.clearTimeout(t.current),a.current&&window.clearTimeout(a.current)}}),[n.qrGenLimit]),y.a.createElement(p.Fragment,null,y.a.createElement("div",{className:"login-qr-page",style:{gap:n.loginQrStateKey===X.WaitingAccept?"60px":void 0}},y.a.createElement("div",{className:"title"},y.a.createElement("img",{draggable:!1,src:fe.a,style:{height:"32px",alignSelf:"center"}}),y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_TITLE",style:{margin:"0",color:"var(--text-primary)",fontSize:"18px",lineHeight:"24px",fontWeight:600,alignSelf:"center"},tagName:"div"})),y.a.createElement("div",{className:"qr-scan"},n.loginQrStateKey!==X.WaitingAccept&&y.a.createElement(y.a.Fragment,null,y.a.createElement("div",{className:"login-qr__frame-qr",style:{border:"1px solid rgba(0, 0, 0, 0.1)"}},y.a.createElement("img",{draggable:!1,className:"qr-image"+(o.value&&!s.value?"--none":""),src:o.value?"data:image/png;base64,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":n.qrData.base64Qr?"data:image/png;base64,"+n.qrData.base64Qr:Ee,alt:"QR Code"}),y.a.createElement("div",{className:"mask"+(o.value?"":"--none"),style:{fontSize:"13px",lineHeight:"17px",fontWeight:400,alignSelf:"center",color:"var(--text-primary)",cursor:n.qrGenLimit?"not-allowed":"pointer"},onClick:e=>{e.stopPropagation(),!n.qrGenLimit&&o.value&&c()}},y.a.createElement(de.a,{style:{fontSize:"var(--f32)",color:n.qrGenLimit?"var(--icon-warning)":"var(--icon-information)"},icon:n.qrGenLimit?"TriangleWarning_24_Filled":"Retry_24_Line"}),y.a.createElement(ue.a,{textKey:n.qrGenLimit?"STR_QR_LIMIT_REACHED":"STR_LOGIN_QR_PAGE_RETRY_GET_QR"})),y.a.createElement("span",{style:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box",padding:"0"}},y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_QR_CODE_TEXT_1",style:{color:"var(--text-information)",fontSize:"13px",lineHeight:"18px",fontWeight:400,alignSelf:"center"}}),y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_QR_CODE_TEXT_2",style:{color:"var(--text-primary)",fontSize:"13px",lineHeight:"18px",fontWeight:400,alignSelf:"center"}}))),y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"70%",height:"fit-content",minHeight:"20px",alignItems:"center"}},y.a.createElement(ue.a,{textKey:`${n.errorMessage}`,tagName:"div",className:"login-error-message"+(n.errorMessage?"":"--none"),style:{textAlign:"center"}}),y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_QR_TIMEOUT_ERROR",tagName:"div",className:"login-error-message"+(!o.value||n.qrGenLimit||n.errorMessage?"--none":"")}),y.a.createElement(ue.a,{textKey:"STR_LOGIN_QR_PAGE_QR_LIMITED_ERROR",textArguments:[`${n.countDownQRLimited}`],tagName:"div",className:"login-error-message"+(o.value&&n.qrGenLimit&&!n.errorMessage?"":"--none")})),n.loginQrStateKey!==X.WaitingAccept&&y.a.createElement(ye,null)),n.loginQrStateKey===X.WaitingAccept&&y.a.createElement(pe,{data:n.previewInfo}))))};var Ge=a("v/qp"),qe=a("FInY");var je=a("wx14"),Qe=a("1ZEA");a("Q8hM"),a("xjxT");const Ke=e=>{const{domRef:t,onKeyPress:a,className:n,style:o,borderMode:s,needVerify:r=!1,compareValue:i=null,rules:c=[]}=e,[l,u]=y.a.useState(!1),[d,_]=y.a.useState(!1),[h,m]=y.a.useState(!1),[p,E]=y.a.useState("");return y.a.useEffect((()=>{m(g.default.checkValidPassword(p,i||"",c))}),[i]),y.a.createElement("div",{className:"rel z-input flx-1 flx-al-c "+(n||"")+(s?" border-mode ":""),style:o,onClick:()=>{t&&t.focus()}},y.a.createElement(Qe.a,Object(je.a)({},e,{required:!0,type:l?"text":"password",maxLength:"100",onKeyDown:function(e){if(e){let t=e.getModifierState("CapsLock");t!==d&&_(t)}a&&a(e)},onChange:function(t){var a;e.onChange&&e.onChange(t);let n=null==t||null===(a=t.target)||void 0===a?void 0:a.value;m(g.default.checkValidPassword(n,i||"",c)),E(n)},style:{height:"20px",padding:0,marginRight:"32px"}})),!1,h&&r?y.a.createElement(de.a,{className:"icon-solid-checked check-pw-icon "}):null,y.a.createElement(de.a,{icon:l?"Eye_Off_24_Line":"Eye_On_24_Line",className:"toggle-pw-visiblity",style:{width:"24px",height:"24px",fontSize:"24px",position:"absolute",right:"0px",top:"6px"},onClick:e=>{e&&(e.stopPropagation(),e.preventDefault()),u(!l)}}))};a("Xu+P");const Be=({onEnter:e,onChangeCaptcha:t,isReset:a,isInit:n})=>{const o=Object(p.useRef)(null),s=Object(p.useRef)(null),r=Object(p.useRef)(Number.MAX_SAFE_INTEGER-1),i=Object(p.useRef)(1),c=W(),l=le({captcha:{captchaImg:"",expirationTime:0,token:""},isLoading:!0}),u=Object(p.useCallback)((async()=>{if(null===s.current)try{l.isLoading=!0;const e=await async function(){try{const r=await Ne.default.getLoginCaptcha(T()),i=Me(null==r?void 0:r.data);var e,t,a,n,o,s;if("Right"===i._tag)return{captchaImg:null!==(e=null==i||null===(t=i.value)||void 0===t?void 0:t.captcha_img)&&void 0!==e?e:"",expirationTime:null!==(a=null==i||null===(n=i.value)||void 0===n?void 0:n.expiration_time)&&void 0!==a?a:0,token:null!==(o=null==i||null===(s=i.value)||void 0===s?void 0:s.token)&&void 0!==o?o:""};throw i.value}catch(r){if(r instanceof Error&&"Network Error"===r.message)throw new Pe({code:"STR_CONNECTION_ERROR",message:"STR_CONNECTION_ERROR",name:"Network Error"});throw r}}();o.current.value="",t("",""),l.captcha.captchaImg="data:image/png;base64,"+e.captchaImg,l.captcha.token=e.token,l.captcha.expirationTime=e.expirationTime,s.current=window.setInterval((()=>{var e,t;l.captcha.expirationTime>0?l.captcha.expirationTime-=1:(null!==s.current&&window.clearInterval(s.current),s.current=null,r.current=Number.MAX_SAFE_INTEGER-1,(""!==(null==o||null===(e=o.current)||void 0===e?void 0:e.value)||i.current>0)&&(i.current>0&&""===(null==o||null===(t=o.current)||void 0===t?void 0:t.value)&&(i.current-=1),l.captcha.captchaImg="",u()))}),1e3)}catch(e){c.stateMachine.state.error(`Cause by getCaptchaForLoginWithPassword: ${e instanceof Pe?e.message:e}`)}finally{setTimeout((()=>{l.isLoading=!1}),600)}}),[]);function d(){r.current>0&&(r.current--,null!==s.current&&window.clearInterval(s.current),s.current=null,i.current=1,u())}return Object(p.useEffect)((()=>()=>{null!==s.current&&window.clearInterval(s.current)}),[]),Object(p.useEffect)((()=>{a&&d()}),[a]),Object(p.useEffect)((()=>{n&&!a&&d()}),[n]),y.a.createElement("div",{className:Object(V.a)(["z-input","login-normal-page__captcha"]),style:{width:"100%",boxSizing:"border-box",padding:"0",height:"36px"}},y.a.createElement(Qe.a,{required:!0,textKey:"STR_INPUT_CAPTCHA",onKeyPress:t=>{e(t)},onChange:e=>{t(e.target.value,l.captcha.token)},type:"text",inputRef:o,style:{padding:"0",boxSizing:"border-box",color:"var(--text-primary)",fontSize:"14px",lineHeight:"20px",fontWeight:400,height:"36px"}}),y.a.createElement("div",{id:"captcha",className:"flx flx-center flx-al-c",style:{width:"fit-content",height:"fit-content",display:"flex",justifyContent:"center",alignItems:"center",gap:"8px",position:"absolute",bottom:"0px",right:"0px"}},y.a.createElement("img",{draggable:!1,src:l.isLoading?Ee:l.captcha.captchaImg,alt:"captcha",style:{height:l.isLoading?"20px":"34px"}}),l.isLoading?y.a.createElement("span",{style:{color:"var(--text-placeholder)",fontSize:"14px",lineHeight:"34px",fontWeight:400}},y.a.createElement(ue.a,{textKey:"STR_LOADING"})," ","..."):y.a.createElement(Ge.a,{icon:"outline-reload",onClick:()=>{d()},type:"tertiary-neutral",size:"large",disabled:0===r.current,style:{width:"24px",height:"24px",minWidth:"24px",minHeight:"24px",padding:"0"}})))};function Fe(e){var t,a,n,o,s,r,i;return{choices:null!==(t=null==e||null===(a=e.choices)||void 0===a?void 0:a.map((e=>function(e){var t,a,n;return{title:null!==(t=null==e?void 0:e.title)&&void 0!==t?t:"",value:null!==(a=null==e?void 0:e.value)&&void 0!==a?a:"",thumb:null!==(n=null==e?void 0:e.thumb)&&void 0!==n?n:""}}(e))))&&void 0!==t?t:[],content:null!==(n=null==e?void 0:e.content)&&void 0!==n?n:"",questionFormat:null!==(o=null==e?void 0:e.questionFormat)&&void 0!==o?o:0,questionType:null!==(s=null==e?void 0:e.questionType)&&void 0!==s?s:0,answerType:null!==(r=null==e?void 0:e.answerType)&&void 0!==r?r:0,cptchCert:null!==(i=null==e?void 0:e.cptch_cert)&&void 0!==i?i:""}}var ze=a("egaF"),We=a("O8ue");a("cy9f");function Ve(){const e=Math.round((new Date).getTimezoneOffset()/-60);return(e<0?"":"+")+(e>9?`${e}:00`:`0${e}:00`)}const He=({dataSecQues:e,dataUser:t,onBack:a,onSubmit:n,usedForResetPassword:o=!1})=>{var s,r;const i=e.content+` ${K.default.trans("STR_SECURITY_QUESTION_MESSAGE_SUBTEXT",[(null!==(s=e.answerType)&&void 0!==s?s:0).toString()])}`,c=Object(p.useRef)(null),l=le({checkedItems:new Array(0),messageError:""});async function u(){try{o&&t&&await async function({phone:e,token:t,answerData:a,options:n}){try{const o=T(),s=await Ne.default.loginByResetPassword(e,o,"","",t,Ve(),n.isoCode,F.getCurrentLanguageName(),a),r=Me(null==s?void 0:s.data);if("Right"===r._tag)return r.value;throw r.value}catch(o){if(o instanceof Error&&"Network Error"===o.message)throw new Pe({code:"STR_CONNECTION_ERROR",message:"STR_CONNECTION_ERROR",name:"Network Error"});throw o}}({answerData:{answers:Array.from(l.checkedItems).join(","),answer_type:e.answerType,question_type:e.questionType},options:{isoCode:t.isoCode},phone:t.phone,token:t.token}),await n({answers:Array.from(l.checkedItems).join(","),answer_type:e.answerType,question_type:e.questionType}),a()}catch(s){if(d(),s instanceof Pe){if(s.code===De.OUT_OF_SECQ_QUOTA||s.code===De.OUT_OF_SECQ_2_STEP_QUOTA)return void a(!0,`${(null==s?void 0:s.message)||""}`);l.messageError=s.message}else l.messageError=F.str("STR_ERROR_UNKNOWN")}}function d(){l.checkedItems.length>0&&(l.checkedItems=[])}return Object(p.useEffect)((()=>(c.current=window.setInterval((()=>{d()}),3e4),()=>{c.current&&window.clearInterval(c.current)})),[]),y.a.createElement("div",{className:"security-question-screen",style:{backgroundColor:"#FFFFFF",zIndex:12}},y.a.createElement("div",{className:"title"},y.a.createElement("img",{draggable:!1,src:fe.a,style:{height:"32px",alignSelf:"center"}}),y.a.createElement(ue.a,{textKey:"STR_LOGIN_ACCOUNT",style:{margin:"0",color:"var(--B95)",fontSize:"18px",fontWeight:"600",alignSelf:"center"},tagName:"div"}),y.a.createElement("span",{style:{margin:"0",color:"var(--B95)",fontSize:"14px",fontWeight:400,lineHeight:"20px",alignSelf:"center",textAlign:"center"}},`${i}`)),y.a.createElement("div",{className:"body"},y.a.createElement(ue.a,{className:Object(V.a)("error","text-center"),textKey:`${l.messageError}`}),y.a.createElement("div",{style:{display:"flex",flexDirection:"column",height:"230px",width:"100%",border:"1px solid rgba(0, 0, 0, 0.1)"}},y.a.createElement(ze.a,{autoHide:!1},(null!==(r=e.choices)&&void 0!==r?r:[]).map((e=>y.a.createElement(Xe,{key:"item_qs_"+e.value,id:e.value,thumb:e.thumb,title:e.title,onClick:e=>{!function(e){const t=l.checkedItems.indexOf(e);t>-1?l.checkedItems.splice(t,1):l.checkedItems.push(e),l.checkedItems=[...l.checkedItems]}(e)},checked:void 0!==l.checkedItems.find((t=>t===e.value))})))))),y.a.createElement("div",{className:"footer"},y.a.createElement(Ge.a,{disabled:l.checkedItems.length!==e.answerType,onClick:()=>{u()},size:"large",textKey:"STR_ANSWER",style:{width:"100%"}}),y.a.createElement(Ge.a,{type:"tertiary-primary",size:"large",textKey:"STR_BACK",onClick:a})))},Xe=({id:e,onClick:t,thumb:a,title:n,checked:o})=>y.a.createElement("div",{className:Object(V.a)("rel","flx flx-al-c","security-question-screen__list-friend__item"),onClick:()=>{t(e)}},a&&y.a.createElement(_e.a,{userId:e,target:{displzzayName:n,avatar:a},size:"l"}),y.a.createElement("div",{className:Object(V.a)("name",a&&"ml-12")},n),y.a.createElement(We.a,{className:"fl-r",checked:o}));a("hGpA"),a("y65y");var Ye=a("Z8OR");const Ze=Object(p.forwardRef)((({className:e,style:t,textKey:a,inputProps:n,onChange:o,countryCode:s=84,phoneNumber:r="",countryIsoCode:i="VN"},c)=>{const l=Object(p.useRef)(null),[u,d]=Object(p.useState)(!1);return Object(p.useImperativeHandle)(c,(()=>l.current),[]),y.a.createElement("fieldset",{className:Object(V.a)(["input-phone-v2",null!=e?e:""]),style:t},y.a.createElement("div",{className:"iso-picker",onClick:()=>{d(!0)}},"+"+s,y.a.createElement(de.a,{icon:"solid-down-1",style:{fontSize:"12px",corlor:"var(--icon-secondary)"}})),y.a.createElement("input",Object(je.a)({className:"phone",value:r,onChange:e=>{!function(e){let t=s,a=i,n=e.split("").filter((e=>e>="0"&&e<="9"||"+"===e)).join("").trim();if(n.startsWith("+")){const e=g.default.getPhoneNumber(n);e.isPossibleNumber()&&(t=e.getCountryCode(),a=e.getISOCountryCode(),n=e.getPhone())}o&&o({countryCode:t,countryIsoCode:a,phoneNumber:n})}(e.currentTarget.value)}},n,{ref:l,"data-translate-placeholder":a})),u&&y.a.createElement(Ye.a,{onCountrySelected:e=>{var t,a,n;(t=e)&&o&&o({countryCode:t.country_code,countryIsoCode:t.iso_country_code,phoneNumber:null!==(a=null===(n=l.current)||void 0===n?void 0:n.value)&&void 0!==a?a:""}),d(!1)},countries:[{country_code:93,iso_country_code:"AF",country_name:"Afghanistan"},{country_code:376,iso_country_code:"AD",country_name:"Andorra"},{country_code:244,iso_country_code:"AO",country_name:"Angola"},{country_code:1264,iso_country_code:"AI",country_name:"Anguilla"},{country_code:1268,iso_country_code:"AG",country_name:"Antigua and Barbuda"},{country_code:54,iso_country_code:"AR",country_name:"Argentina"},{country_code:297,iso_country_code:"AW",country_name:"Aruba"},{country_code:61,iso_country_code:"AU",country_name:"Australia"},{country_code:43,iso_country_code:"AT",country_name:"Austria"},{country_code:1242,iso_country_code:"BS",country_name:"Bahamas"},{country_code:973,iso_country_code:"BH",country_name:"Bahrain"},{country_code:880,iso_country_code:"BD",country_name:"Bangladesh"},{country_code:1246,iso_country_code:"BB",country_name:"Barbados"},{country_code:375,iso_country_code:"BY",country_name:"Belarus"},{country_code:32,iso_country_code:"BE",country_name:"Belgium"},{country_code:501,iso_country_code:"BZ",country_name:"Belize"},{country_code:229,iso_country_code:"BJ",country_name:"Benin"},{country_code:1441,iso_country_code:"BM",country_name:"Bermuda"},{country_code:975,iso_country_code:"BT",country_name:"Bhutan"},{country_code:591,iso_country_code:"BO",country_name:"Bolivia"},{country_code:387,iso_country_code:"BA",country_name:"Bosnia and Herzegovina"},{country_code:267,iso_country_code:"BW",country_name:"Botswana"},{country_code:55,iso_country_code:"BR",country_name:"Brazil"},{country_code:673,iso_country_code:"BN",country_name:"Brunei"},{country_code:359,iso_country_code:"BG",country_name:"Bulgaria"},{country_code:226,iso_country_code:"BF",country_name:"Burkina Faso"},{country_code:257,iso_country_code:"BI",country_name:"Burundi"},{country_code:855,iso_country_code:"KH",country_name:"Cambodia"},{country_code:237,iso_country_code:"CM",country_name:"Cameroon"},{country_code:1,iso_country_code:"CA",country_name:"Canada"},{country_code:1345,iso_country_code:"KY",country_name:"Cayman Islands"},{country_code:236,iso_country_code:"CF",country_name:"Central African Republic"},{country_code:235,iso_country_code:"TD",country_name:"Chad"},{country_code:56,iso_country_code:"CL",country_name:"Chile"},{country_code:86,iso_country_code:"CN",country_name:"China"},{country_code:269,iso_country_code:"KM",country_name:"Comoros"},{country_code:682,iso_country_code:"CK",country_name:"Cook Islands"},{country_code:506,iso_country_code:"CR",country_name:"Costa Rica"},{country_code:385,iso_country_code:"HR",country_name:"Croatia"},{country_code:53,iso_country_code:"CU",country_name:"Cuba"},{country_code:357,iso_country_code:"CY",country_name:"Cyprus"},{country_code:420,iso_country_code:"CZ",country_name:"Czech Republic"},{country_code:243,iso_country_code:"CD",country_name:"Democratic Republic of the Congo"},{country_code:45,iso_country_code:"DK",country_name:"Denmark"},{country_code:253,iso_country_code:"DJ",country_name:"Djibouti"},{country_code:1767,iso_country_code:"DM",country_name:"Dominica"},{country_code:1809,iso_country_code:"DO",country_name:"Dominican Republic"},{country_code:670,iso_country_code:"TL",country_name:"East Timor"},{country_code:593,iso_country_code:"EC",country_name:"Ecuador"},{country_code:20,iso_country_code:"EG",country_name:"Egypt"},{country_code:503,iso_country_code:"SV",country_name:"El Salvador"},{country_code:240,iso_country_code:"GQ",country_name:"Equatorial Guinea"},{country_code:372,iso_country_code:"EE",country_name:"Estonia"},{country_code:251,iso_country_code:"ET",country_name:"Ethiopia"},{country_code:298,iso_country_code:"FO",country_name:"Faroe Islands"},{country_code:679,iso_country_code:"FJ",country_name:"Fiji"},{country_code:358,iso_country_code:"FI",country_name:"Finland"},{country_code:33,iso_country_code:"FR",country_name:"France"},{country_code:220,iso_country_code:"GM",country_name:"Gambia"},{country_code:995,iso_country_code:"GE",country_name:"Georgia"},{country_code:49,iso_country_code:"DE",country_name:"Germany"},{country_code:233,iso_country_code:"GH",country_name:"Ghana"},{country_code:350,iso_country_code:"GI",country_name:"Gibraltar"},{country_code:30,iso_country_code:"GR",country_name:"Greece"},{country_code:299,iso_country_code:"GL",country_name:"Greenland"},{country_code:1473,iso_country_code:"GD",country_name:"Grenada"},{country_code:1671,iso_country_code:"GU",country_name:"Guam"},{country_code:502,iso_country_code:"GT",country_name:"Guatemala"},{country_code:224,iso_country_code:"GN",country_name:"Guinea"},{country_code:245,iso_country_code:"GW",country_name:"Guinea-Bissau"},{country_code:509,iso_country_code:"HT",country_name:"Haiti"},{country_code:504,iso_country_code:"HN",country_name:"Honduras"},{country_code:852,iso_country_code:"HK",country_name:"Hong Kong"},{country_code:36,iso_country_code:"HU",country_name:"Hungary"},{country_code:354,iso_country_code:"IS",country_name:"Iceland"},{country_code:91,iso_country_code:"IN",country_name:"India"},{country_code:62,iso_country_code:"ID",country_name:"Indonesia"},{country_code:98,iso_country_code:"IR",country_name:"Iran"},{country_code:964,iso_country_code:"IQ",country_name:"Iraq"},{country_code:353,iso_country_code:"IE",country_name:"Ireland"},{country_code:972,iso_country_code:"IL",country_name:"Israel"},{country_code:39,iso_country_code:"IT",country_name:"Italy"},{country_code:1876,iso_country_code:"JM",country_name:"Jamaica"},{country_code:81,iso_country_code:"JP",country_name:"Japan"},{country_code:44,iso_country_code:"JE",country_name:"Jersey"},{country_code:962,iso_country_code:"JO",country_name:"Jordan"},{country_code:7,iso_country_code:"KZ",country_name:"Kazakhstan"},{country_code:254,iso_country_code:"KE",country_name:"Kenya"},{country_code:686,iso_country_code:"KI",country_name:"Kiribati"},{country_code:965,iso_country_code:"KW",country_name:"Kuwait"},{country_code:996,iso_country_code:"KG",country_name:"Kyrgyzstan"},{country_code:856,iso_country_code:"LA",country_name:"Laos"},{country_code:371,iso_country_code:"LV",country_name:"Latvia"},{country_code:961,iso_country_code:"LB",country_name:"Lebanon"},{country_code:266,iso_country_code:"LS",country_name:"Lesotho"},{country_code:231,iso_country_code:"LR",country_name:"Liberia"},{country_code:218,iso_country_code:"LY",country_name:"Libya"},{country_code:423,iso_country_code:"LI",country_name:"Liechtenstein"},{country_code:370,iso_country_code:"LT",country_name:"Lithuania"},{country_code:352,iso_country_code:"LU",country_name:"Luxembourg"},{country_code:853,iso_country_code:"MO",country_name:"Macau"},{country_code:389,iso_country_code:"MK",country_name:"Macedonia"},{country_code:261,iso_country_code:"MG",country_name:"Madagascar"},{country_code:265,iso_country_code:"MW",country_name:"Malawi"},{country_code:60,iso_country_code:"MY",country_name:"Malaysia"},{country_code:960,iso_country_code:"MV",country_name:"Maldives"},{country_code:223,iso_country_code:"ML",country_name:"Mali"},{country_code:356,iso_country_code:"MT",country_name:"Malta"},{country_code:52,iso_country_code:"MX",country_name:"Mexico"},{country_code:691,iso_country_code:"FM",country_name:"Micronesia"},{country_code:373,iso_country_code:"MD",country_name:"Moldova"},{country_code:377,iso_country_code:"MC",country_name:"Monaco"},{country_code:976,iso_country_code:"MN",country_name:"Mongolia"},{country_code:382,iso_country_code:"ME",country_name:"Montenegro"},{country_code:1664,iso_country_code:"MS",country_name:"Montserrat"},{country_code:212,iso_country_code:"MA",country_name:"Morocco"},{country_code:258,iso_country_code:"MZ",country_name:"Mozambique"},{country_code:95,iso_country_code:"MM",country_name:"Myanmar"},{country_code:264,iso_country_code:"NA",country_name:"Namibia"},{country_code:977,iso_country_code:"NP",country_name:"Nepal"},{country_code:31,iso_country_code:"NL",country_name:"Netherlands"},{country_code:599,iso_country_code:"AN",country_name:"Netherlands Antilles"},{country_code:687,iso_country_code:"NC",country_name:"New Caledonia"},{country_code:64,iso_country_code:"NZ",country_name:"New Zealand"},{country_code:850,iso_country_code:"KP",country_name:"North Korea"},{country_code:47,iso_country_code:"NO",country_name:"Norway"},{country_code:968,iso_country_code:"OM",country_name:"Oman"},{country_code:970,iso_country_code:"PS",country_name:"Palestine"},{country_code:507,iso_country_code:"PA",country_name:"Panama"},{country_code:675,iso_country_code:"PG",country_name:"Papua New Guinea"},{country_code:595,iso_country_code:"PY",country_name:"Paraguay"},{country_code:51,iso_country_code:"PE",country_name:"Peru"},{country_code:63,iso_country_code:"PH",country_name:"Philippines"},{country_code:48,iso_country_code:"PL",country_name:"Poland"},{country_code:351,iso_country_code:"PT",country_name:"Portugal"},{country_code:1787,iso_country_code:"PR",country_name:"Puerto Rico"},{country_code:974,iso_country_code:"QA",country_name:"Qatar"},{country_code:242,iso_country_code:"CG",country_name:"Republic Of The Congo"},{country_code:262,iso_country_code:"RE",country_name:"Réunion Island"},{country_code:40,iso_country_code:"RO",country_name:"Romania"},{country_code:7,iso_country_code:"RU",country_name:"Russia"},{country_code:250,iso_country_code:"RW",country_name:"Rwanda"},{country_code:1869,iso_country_code:"KN",country_name:"Saint Kitts and Nevis"},{country_code:508,iso_country_code:"PM",country_name:"Saint Pierre and Miquelon"},{country_code:1784,iso_country_code:"VC",country_name:"Saint Vincent and The Grenadines"},{country_code:685,iso_country_code:"WS",country_name:"Samoa"},{country_code:239,iso_country_code:"ST",country_name:"Sao Tome and Principe"},{country_code:966,iso_country_code:"SA",country_name:"Saudi Arabia"},{country_code:221,iso_country_code:"SN",country_name:"Senegal"},{country_code:381,iso_country_code:"RS",country_name:"Serbia"},{country_code:248,iso_country_code:"SC",country_name:"Seychelles"},{country_code:232,iso_country_code:"SL",country_name:"Sierra Leone"},{country_code:65,iso_country_code:"SG",country_name:"Singapore"},{country_code:421,iso_country_code:"SK",country_name:"Slovakia"},{country_code:386,iso_country_code:"SI",country_name:"Slovenia"},{country_code:252,iso_country_code:"SO",country_name:"Somalia"},{country_code:27,iso_country_code:"ZA",country_name:"South Africa"},{country_code:82,iso_country_code:"KR",country_name:"South Korea"},{country_code:211,iso_country_code:"SS",country_name:"South Sudan"},{country_code:34,iso_country_code:"ES",country_name:"Spain"},{country_code:94,iso_country_code:"LK",country_name:"Sri Lanka"},{country_code:249,iso_country_code:"SD",country_name:"Sudan"},{country_code:597,iso_country_code:"SR",country_name:"Suriname"},{country_code:268,iso_country_code:"SZ",country_name:"Swaziland"},{country_code:46,iso_country_code:"SE",country_name:"Sweden"},{country_code:41,iso_country_code:"CH",country_name:"Switzerland"},{country_code:963,iso_country_code:"SY",country_name:"Syria"},{country_code:886,iso_country_code:"TW",country_name:"Taiwan"},{country_code:992,iso_country_code:"TJ",country_name:"Tajikistan"},{country_code:255,iso_country_code:"TZ",country_name:"Tanzania"},{country_code:66,iso_country_code:"TH",country_name:"Thailand"},{country_code:228,iso_country_code:"TG",country_name:"Togo"},{country_code:676,iso_country_code:"TO",country_name:"Tonga"},{country_code:1868,iso_country_code:"TT",country_name:"Trinidad and Tobago"},{country_code:216,iso_country_code:"TN",country_name:"Tunisia"},{country_code:90,iso_country_code:"TR",country_name:"Turkey"},{country_code:993,iso_country_code:"TM",country_name:"Turkmenistan"},{country_code:1649,iso_country_code:"TC",country_name:"Turks and Caicos Islands"},{country_code:256,iso_country_code:"UG",country_name:"Uganda"},{country_code:380,iso_country_code:"UA",country_name:"Ukraine"},{country_code:971,iso_country_code:"AE",country_name:"United Arab Emirates"},{country_code:44,iso_country_code:"GB",country_name:"United Kingdom"},{country_code:1,iso_country_code:"US",country_name:"United States"},{country_code:998,iso_country_code:"UZ",country_name:"Uzbekistan"},{country_code:58,iso_country_code:"VE",country_name:"Venezuela"},{country_code:84,iso_country_code:"VN",country_name:"Vietnam"},{country_code:1284,iso_country_code:"VG",country_name:"Virgin Islands British"},{country_code:967,iso_country_code:"YE",country_name:"Yemen"},{country_code:260,iso_country_code:"ZM",country_name:"Zambia"},{country_code:263,iso_country_code:"ZW",country_name:"Zimbabwe"}],countryCode:s,oftenCountries:[]}))})),Je=({isFocusLoginNormal:e})=>{const t=W(),a=le({password:"",phoneNumber:"",countryCode:84,countryIsoCode:"VN",captcha:"",captchaToken:"",errorMessage:"",secQuestion:null,coutingFailureSubmited:0,isReloadCaptcha:!1}),n=ce((()=>a.phoneNumber.length>=6&&a.password.length>=3&&a.captcha.length>0)),o=Object(p.useRef)(null),s=Object(p.useRef)(null),r=Object(p.useRef)(null);function i(e){t.stateMachine.handler(Y.main_choose_login_qr),e&&(t.stateMachine.state.data={error_from_login_password:e}),t.loginSession.loginStateStream.next(t.stateMachine.state),a.captcha="",a.captchaToken="",a.password="",s.current&&(s.current.value=""),l(null)}function c(e){13===e.which&&(n.value&&u(),e.preventDefault())}function l(e){a.errorMessage=null!=e?e:""}async function u(e){var n;"activeElement"in document&&(null===(n=document.activeElement)||void 0===n||n.blur());try{t.loginSession.isLoading.next(!0);const n=await async function({phone:e,pass:t,captcha:a,captchaToken:n,imei:o,makeAnswer:s,answerData:r,country:i}){try{const h=Q().getItem("quest_cert"),m=Q().getItem("captcha_cert"),p=await Ne.default.signInPasswordV2(e,t,a,n,o,s,r,r?null:h,a?null:m,i.iso,F.getCurrentLanguageName(),qe.a.getUidLogin(),null,null),y=Me(null==p?void 0:p.data);if("Right"===y._tag){var c,l,u,d,_;const t=y.value,a=null!==(c=null==t?void 0:t.uid)&&void 0!==c?c:"",n=null!==(l=null==t?void 0:t.dkey)&&void 0!==l?l:"";if(a&&n){const e=Object(me.c)(a);Q().init(a,n),e||Q().setItemForCurrentUser(Ce().FirstLoginLocalStorageKeys.IS_FIRST_LOGIN,"1")}Q().setItem(g.RECENT_PHONE,e),Q().setItem(g.RECENT_COUNTRY,JSON.stringify(i));const o=!(null===(u=y.value)||void 0===u||!u.needSyncMsg)||!(null===(d=y.value)||void 0===d||!d.sync_msg_info);return Q().setItem("z_needSyncMsg",o?"1":""),Q().setItem(Ce().KEY_REMEMBER,ve.default.getValueRememberLogin()?"1":""),Q().setItem(Ce().KEY_SET_VALUE_ACTION_LOG,`${ve.default.getValueActionLogRemember()}`),null!=t&&t.quest_cert&&Q().setItem("quest_cert",t.quest_cert),null!=t&&t.cptch_cert&&Q().setItem("captcha_cert",t.cptch_cert),Q().setItem("FORCE_GET_FRIEND_LIST","1"),await $zelectron.setAppCookie(null!==(_=null==t?void 0:t.zpw_sek)&&void 0!==_?_:""),Q().removeItem("FORGOT_PASSWORD"),null!=a?a:""}throw y.value}catch(h){if(h instanceof Error&&"Network Error"===h.message)throw new Pe({code:"STR_CONNECTION_ERROR",message:"STR_CONNECTION_ERROR",name:"Network Error"});throw h}}({phone:a.phoneNumber,pass:a.password,captcha:a.captcha,captchaToken:a.captchaToken,imei:T(),makeAnswer:e?1:0,answerData:e||null,country:{code:a.countryCode,iso:a.countryIsoCode}});t.stateMachine.handler(Y.main_accepted_login),t.stateMachine.state.data={typeLogin:Ce().LOGIN_TYPE_PASSWORD},t.loginSession.loginStateStream.next(t.stateMachine.state),t.loginSession.logInfoV2Stream.next({type:152404,subType:0,data:{authentication_status:!0,login_method:"password",uid:n}})}catch(o){if(a.isReloadCaptcha=!0,e)throw o;if(o instanceof Pe&&o.code===De.SECURITY_QUESTION_REQUIRED&&o.data)return a.secQuestion=Fe(o.data),t.stateMachine.state.error((function(e){return e[0]})`re security ${o}`),void(o.data.cptch_cert&&Q().setItem("captcha_cert",o.data.cptch_cert));if(t.loginSession.logInfoV2Stream.next({type:152404,subType:0,data:{authentication_status:!1,login_method:"password",error_code:(null==o?void 0:o.code)||(null==o?void 0:o.error_code)||o}}),t.stateMachine.state.error(`Cause by loginWithPassword: ${JSON.stringify(o)}`),a.isReloadCaptcha=!0,o instanceof Pe){if("string"==typeof o.code)return void l(F.str("STR_SIGNIN_ERROR_NO_NETWORK"));o.code===De.OUT_OF_SECQ_QUOTA||o.code===De.OUT_OF_SECQ_2_STEP_QUOTA||o.code===De.SENSITIVE_FLOW_REQUIRE_OTP_OR_CONFIRM_MOBILE||o.code===De.SENSITIVE_FLOW_REQUIRE_OTP?l(o.message):[18041,18042,18043].includes(o.code)?l(o.message?o.message:F.str("STR_SIGNIN_ERROR_RECYCLE_SIM")):18044===o.code?l(o.message?o.message:F.str("STR_SIGNIN_ERROR_CHANGED_NUMPHONE")):l(o.message)}else l(F.str("STR_ERROR_UNKNOWN"));a.coutingFailureSubmited++,3===a.coutingFailureSubmited&&(i("STR_LOGIN_PASSWORD_PAGE_ERROR_SUBMIT_TOO_MUCH"),a.coutingFailureSubmited=0)}finally{t.loginSession.isLoading.next(!1),a.isReloadCaptcha=!1}}return Object(p.useEffect)((()=>{var t;e&&(null===(t=o.current)||void 0===t||t.focus(),o.current&&(o.current.value="",a.phoneNumber=""))}),[e]),y.a.createElement(p.Fragment,null,y.a.createElement("form",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%",flex:1,padding:"60px 32px 60px 32px",gap:"32px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"},onSubmit:e=>{e.preventDefault(),u()},ref:r},y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement("img",{draggable:!1,src:fe.a,style:{height:"32px",alignSelf:"center"}}),y.a.createElement(ue.a,{textKey:"STR_LOGIN_PASSWORD_PAGE_TITLE",style:{margin:"0",color:"var(--text-primary)",fontSize:"18px",lineHeight:"24px",fontWeight:600,alignSelf:"center"},tagName:"div"})),y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"24px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement(Ze,{countryCode:a.countryCode,countryIsoCode:a.countryIsoCode,phoneNumber:a.phoneNumber,textKey:"STR_PHONE_NUMBER",onChange:({countryCode:e,countryIsoCode:t,phoneNumber:n})=>{var o;o={countryCode:e,countryIsoCode:t,phoneNumber:n},a.countryCode=o.countryCode,a.countryIsoCode=o.countryIsoCode.trim(),a.phoneNumber=o.phoneNumber.trim(),l(null)},inputProps:{placeholder:F.str("STR_PHONE_NUMBER"),onKeyPress:e=>{c(e)}},ref:o}),y.a.createElement(Ke,{textKey:"STR_PASSWORD",inputRef:e=>{s.current=e},domref:s,onKeyPress:e=>{c(e)},onChange:e=>{!function(e){a.password=e.target.value,l(null)}(e)},style:{width:"100%",boxSizing:"border-box",padding:"8px 0px 7px 0px",color:"var(--text-primary)",fontSize:"14px",lineHeight:"20px",fontWeight:400}}),y.a.createElement(Be,{onChangeCaptcha:(e,t)=>{var n,o;n=e,o=t,a.captcha=n,a.captchaToken=o},onEnter:e=>{c(e)},isInit:e,isReset:a.isReloadCaptcha}),y.a.createElement("span",{className:"login-error-message"+(a.errorMessage?"":"--none"),style:{textAlign:"start",width:"100%",marginTop:"-8px"}},a.errorMessage)),y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"flex-start",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement(Ge.a,{textKey:"STR_SIGNIN",onClick:()=>{var e;null===(e=r.current)||void 0===e||e.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))},disabled:!n.value,size:"large",style:{margin:"0",width:"100%"}}),y.a.createElement(ue.a,{textKey:"STR_SIGNIN_FORGET",tagName:"div",onClick:()=>(t.stateMachine.handler(Y.main_forget_password),t.stateMachine.state.data={phoneNumber:a.phoneNumber,countryIsoCode:a.countryIsoCode,countryCode:a.countryCode},a.captcha="",a.captchaToken="",a.password="",s.current&&(s.current.value=""),l(null),void t.loginSession.loginStateStream.next(t.stateMachine.state)),style:{margin:"0",width:"fit-content",textAlign:"start",color:"var(--text-primary)",fontSize:"14px",lineHeight:"20px",fontWeight:400,cursor:"pointer"}})))),y.a.createElement("div",{style:{display:"flex",flexDirection:"row",padding:"16px 32px 16px 32px",gap:"10px",alignItems:"center",justifyContent:"center",boxSizing:"border-box"}},y.a.createElement(Ge.a,{size:"medium",textKey:"STR_LOGIN_PASSWORD_PAGE_BACK_QR",onClick:()=>{i()},type:"tertiary-neutral"})),null!==a.secQuestion&&y.a.createElement(He,{usedForResetPassword:!1,dataSecQues:a.secQuestion,onBack:(e,n)=>{e&&(i(),n&&t.loginSession.popupStream.next(y.a.createElement(O.default,{visible:!0,showCloseButton:!1,idName:"noti-answer-security-too-much-when-reset-password",noPadding:!0,border:"no-border",title:F.str("STR_CONFIG_NOTI"),style:{borderRadius:"8px",background:"transparent"},okText:F.str("STR_CLOSE"),onOk:()=>{t.loginSession.popupStream.next(null)},preventPageClickForceClose:!1,message:n}))),a.secQuestion=null},onSubmit:u}))};const $e=({next:e})=>{var t,a,n,o;const s=W(),r=le({errorMessage:"",otp:"",secQuestion:null}),i=Object(p.useRef)(null),c=ce((()=>r.otp.length>0&&""===r.errorMessage));async function l(){try{var t,a,n,o;s.loginSession.isLoading.next(!0);const c=await async function({imei:e,phoneNumber:t,isoCode:a,otp:n,timeZone:o,language:s}){try{const m=await Ne.default.validateActiveCode(e,t,a,n,o,!0,3,{language:s}),g=Me(null==m?void 0:m.data);var r,i,c,l,u,d,_,h;if("Right"===g._tag)return Q().setItem("FORGOT_PASSWORD","1"),{enk:null!==(r=null===(i=g.value)||void 0===i?void 0:i.enk)&&void 0!==r?r:"",question:null!==(c=null===(l=g.value)||void 0===l?void 0:l.question)&&void 0!==c?c:null,requireSEQ:null!==(u=null===(d=g.value)||void 0===d?void 0:d.requireSEQ)&&void 0!==u?u:0,token:null!==(_=null===(h=g.value)||void 0===h?void 0:h.token)&&void 0!==_?_:""};throw g.value}catch(m){if(m instanceof Error&&"Network Error"===m.message)throw new Pe({code:"STR_CONNECTION_ERROR",message:"STR_CONNECTION_ERROR",name:"Network Error"});throw m}}({imei:T(),isoCode:null!==(t=null===(a=s.stateMachine.state.data)||void 0===a?void 0:a.countryIsoCode)&&void 0!==t?t:"VN",otp:r.otp,phoneNumber:null!==(n=null===(o=s.stateMachine.state.data)||void 0===o?void 0:o.phoneNumber)&&void 0!==n?n:"",timeZone:Ve(),language:F.getCurrentLanguageName()});if(c.token&&(s.stateMachine.state.data.authToken=c.token),c.enk&&(i=c.enk,g.default.setDecryptKey(i)),1===c.requireSEQ)return void(r.secQuestion=Fe(c.question));e()}catch(c){s.stateMachine.state.error(`Cause by verifyActiveCodeForResetPassword: ${JSON.stringify(c)}`),c instanceof Pe?"string"==typeof(null==c?void 0:c.code)?r.errorMessage=F.str(c.code):18025===(null==c?void 0:c.code)?r.errorMessage=F.str("STR_SIGNIN_ERROR_INVALID_PHONE_NUMBER"):r.errorMessage=c.message:r.errorMessage=F.str("STR_ERROR_UNKNOWN")}finally{s.loginSession.isLoading.next(!1)}var i}return Object(p.useEffect)((()=>{var e;return null===(e=i.current)||void 0===e||e.focus(),i.current&&i.current.addEventListener("input",(function(){var e;this.value=this.value.replace(/[^0-9]/g,""),e=this.value,r.otp=e,r.errorMessage=""})),()=>{var e,t;null===(e=i.current)||void 0===e||e.blur(),null===(t=i.current)||void 0===t||t.removeEventListener("input",(()=>{}))}}),[i.current]),y.a.createElement(p.Fragment,null,y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement(ue.a,{textKey:"STR_RESET_PASSWORD_PAGE_INSTRUCTION_SEND_SMS",style:{margin:"0",color:"var(--B95)",fontSize:"14px",fontWeight:"400",lineHeight:"20px",alignSelf:"center",textAlign:"center"},tagName:"div"}),y.a.createElement("input",{className:"forget-password-page__input-otp",required:!0,type:"text",ref:i,onKeyDown:function(e){13==e.which&&(c.value&&l(),e.preventDefault())},"data-translate-placeholder":"STR_ACTIVATION_CODE",placeholder:F.str("STR_ACTIVATION_CODE")}),y.a.createElement("span",{className:"login-error-message"+(r.errorMessage?"":"--none"),style:{marginTop:"-8px"}},r.errorMessage)),y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement(Ge.a,{textKey:"STR_CONTINUE",onClick:()=>{l()},disabled:!c.value,size:"large","data-id":"btn_forget_password_verify_otp",style:{margin:"0",width:"100%"}})),null!==r.secQuestion&&y.a.createElement(He,{usedForResetPassword:!0,dataUser:{isoCode:null!==(t=null===(a=s.stateMachine.state.data)||void 0===a?void 0:a.countryIsoCode)&&void 0!==t?t:"84",token:s.stateMachine.state.data.authToken||"",phone:null!==(n=null===(o=s.stateMachine.state.data)||void 0===o?void 0:o.phoneNumber)&&void 0!==n?n:"0"},dataSecQues:r.secQuestion,onBack:(e,t)=>{r.secQuestion=null,e&&t&&s.loginSession.popupStream.next(y.a.createElement(O.default,{visible:!0,showCloseButton:!1,idName:"noti-answer-security-too-much-when-reset-password",noPadding:!0,border:"no-border",title:F.str("STR_CONFIG_NOTI"),style:{borderRadius:"8px",background:"transparent"},okText:F.str("STR_CLOSE"),onCloseConfirm:()=>{s.loginSession.popupStream.next(null)},preventPageClickForceClose:!1,message:t}))},onSubmit:async t=>{s.stateMachine.state.data.answerData=t,e()}}))};const et=({submit:e})=>{const t=Object(p.useRef)(null),a=Object(p.useRef)(null),n=W(),o=le({errorMessage:"",rules:[]});async function s(){(function(e){let t=!0;o.errorMessage="";for(let n=0;n<o.rules.length;n++)if(t=t&&RegExp(o.rules[n].regex).test(e),!t){var a;if(o.errorMessage=null!==(a=o.rules[n]["vi"===F.getCurrentLanguageName()?"msg":"msg_en"])&&void 0!==a?a:"",""!==o.errorMessage)break;t=!0}return t})(t.current.value)&&function(e){let a=!0;return e===t.current.value?o.errorMessage="":(o.errorMessage=F.str("STR_CONFORM_PW_NOT_MATCH"),a=!1),a}(a.current.value)&&(n.loginSession.isLoading.next(!0),async function({phoneNumber:e,countryCode:t,isoCode:a,password:n,rePassword:o,authToken:s,timeZone:r,imei:i,language:c,answerData:l}){try{const p=await Ne.default.loginByResetPassword(e,i,g.default.encodeAES(`${n}`.trim()),g.default.encodeAES(`${o}`.trim()),s,r,a,c,l),y=Me(null==p?void 0:p.data);if("Right"!==y._tag)throw y.value;var u,d,_;if(!(null!==(u=y.value)&&void 0!==u&&u.quest_cert||null!==(d=y.value)&&void 0!==d&&d.zpw_sek))throw new Pe({});if(null!==(_=y.value)&&void 0!==_&&_.zpw_sek){var h,m;const n=y.value,o=null!==(h=null==n?void 0:n.uid)&&void 0!==h?h:"",s=null!==(m=null==n?void 0:n.dkey)&&void 0!==m?m:"";if(o&&s){const e=Object(me.c)(o);Q().init(o,s),e||Q().setItemForCurrentUser(Ce().FirstLoginLocalStorageKeys.IS_FIRST_LOGIN,"1")}const r={code:t,iso:a};return Q().setItem(g.RECENT_PHONE,e),Q().setItem(g.RECENT_COUNTRY,JSON.stringify(r)),Q().setItem(Ce().KEY_REMEMBER,ve.default.getValueRememberLogin()?"1":""),Q().setItem(Ce().KEY_SET_VALUE_ACTION_LOG,`${ve.default.getValueActionLogRemember()}`),Q().setItem("FORCE_GET_FRIEND_LIST","1"),await $zelectron.setAppCookie(n.zpw_sek),Q().removeItem("FORGOT_PASSWORD"),o}}catch(p){if(p instanceof Error&&"Network Error"===p.message)throw new Pe({code:"STR_CONNECTION_ERROR",message:"STR_CONNECTION_ERROR",name:"Network Error"});throw p}throw new Pe({})}({imei:T(),countryCode:n.stateMachine.state.data.countryCode,isoCode:n.stateMachine.state.data.countryIsoCode,phoneNumber:n.stateMachine.state.data.phoneNumber,password:t.current.value,rePassword:a.current.value,authToken:n.stateMachine.state.data.authToken,language:F.getCurrentLanguageName(),timeZone:Ve(),answerData:n.stateMachine.state.data.answerData||null}).then((t=>{e(t)})).catch((e=>{n.stateMachine.state.error(`Cause by loginByResetPassword: ${JSON.stringify(e)}`),e instanceof Pe?"string"==typeof(null==e?void 0:e.code)?o.errorMessage=F.str(e.code):o.errorMessage=e.message:o.errorMessage=F.str("STR_ERROR_UNKNOWN"),n.loginSession.logInfoV2Stream.next({type:152404,subType:0,data:{authentication_status:!1,login_method:"recover_password",error_code:(null==e?void 0:e.code)||(null==e?void 0:e.error_code)||e}})})).finally((()=>{n.loginSession.isLoading.next(!1)})))}return Object(p.useEffect)((()=>{n.loginSession.isLoading.next(!0),async function(e){try{return await g.default.getPasswordRules(e,Ne.default)||[]}catch(t){throw t}}(T()).then((e=>{o.rules=e})).catch((e=>{n.stateMachine.state.error((function(e){return e[0]})`error get rule update password`,JSON.stringify(e))})).finally((()=>{var e;n.loginSession.isLoading.next(!1),null===(e=t.current)||void 0===e||e.focus()}))}),[]),y.a.createElement(p.Fragment,null,y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement(ue.a,{textKey:"STR_RESET_PASSWORD_PAGE_NOTE_DESCRIPTION_NEW_PASSWORD",style:{textAlign:"center"}}),y.a.createElement(Ke,{textKey:"STR_NEW_PASSWORD",inputRef:e=>{t.current=e},domRef:t.current,onChange:()=>{o.errorMessage=""},onKeyPress:e=>{!function(e){13==e.which&&(""===o.errorMessage&&s(),e.preventDefault())}(e)},style:{width:"100%",boxSizing:"border-box",padding:"8px 0px"}}),y.a.createElement(Ke,{textKey:"STR_CONFIRM_NEW_PASSWORD",inputRef:e=>{a.current=e},domRef:a.current,onChange:()=>{o.errorMessage=""},onKeyPress:e=>{!function(e){13==e.which&&(""===o.errorMessage&&s(),e.preventDefault())}(e)},style:{width:"100%",boxSizing:"border-box",padding:"8px 0px"}}),y.a.createElement("span",{className:"login-error-message"+(o.errorMessage?"":"--none"),style:{width:"100%",textAlign:"start",marginTop:"-8px"}},o.errorMessage)),y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement(Ge.a,{textKey:"STR_LOGIN_PASSWORD_PAGE_SUBMIT_NEW_PASSWORD",onClick:()=>{s()},disabled:""!==o.errorMessage,size:"large","data-id":"btn_forget_password_verify_phone",style:{margin:"0",width:"100%"}})))};const tt=({next:e})=>{var t,a,n,o,s,r,i,c;const l=Object(p.useRef)(null),u=W(),d=le({phoneNumber:null!==(t=null===(a=u.stateMachine.state.data)||void 0===a?void 0:a.phoneNumber)&&void 0!==t?t:"",countryCode:null!==(n=null===(o=u.stateMachine.state.data)||void 0===o?void 0:o.countryCode)&&void 0!==n?n:84,countryIsoCode:null!==(s=null===(r=u.stateMachine.state.data)||void 0===r?void 0:r.countryIsoCode)&&void 0!==s?s:"VN",enableNext:(null!==(i=null===(c=u.stateMachine.state.data)||void 0===c?void 0:c.phoneNumber)&&void 0!==i?i:"").length>=6,errorMessage:""});async function _(){try{var t;u.loginSession.isLoading.next(!0),await async function({imei:e,phoneNumber:t,isoCode:a,language:n,context:o=2,captchaAnswer:s="",captchaToken:r=null,activeType:i=1}){try{const c={language:n,context:o,captchaToken:r,captchaAnswer:s},l=await Ne.default.verifyPhoneNumber(e,t,a,i,c),u=Me(null==l?void 0:l.data);if("Right"===u._tag)return;throw u.value}catch(c){if(c instanceof Error&&"Network Error"===c.message)throw new Pe({code:"STR_CONNECTION_ERROR",message:"STR_CONNECTION_ERROR",name:"Network Error"});throw c}}({imei:T(),isoCode:null!==(t=d.countryIsoCode)&&void 0!==t?t:"VN",language:F.getCurrentLanguageName(),phoneNumber:d.phoneNumber}),u.stateMachine.state.data={phoneNumber:d.phoneNumber,countryCode:d.countryCode,countryIsoCode:d.countryIsoCode},e()}catch(a){u.stateMachine.state.error(`Cause by verifyPhoneForResetPassword: ${JSON.stringify(a)}`),a instanceof Pe?"string"==typeof(null==a?void 0:a.code)?d.errorMessage=F.str(a.code):a.code===De.REJECTED_OTP?(u.stateMachine.state.data={phoneNumber:d.phoneNumber,countryCode:d.countryCode,countryIsoCode:d.countryIsoCode},e()):d.errorMessage=F.str("STR_SIGNIN_ERROR_INVALID_PHONE_NUMBER"):d.errorMessage=F.str("STR_ERROR_UNKNOWN")}finally{u.loginSession.isLoading.next(!1)}}return Object(p.useEffect)((()=>{var e;return null===(e=l.current)||void 0===e||e.focus(),()=>{var e;null===(e=l.current)||void 0===e||e.blur()}}),[l.current]),y.a.createElement(p.Fragment,null,y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement(ue.a,{textKey:"STR_ENTER_PHONE_FOR_ACTIVATION_CODE",style:{margin:"0",color:"var(--B95)",fontSize:"14px",fontWeight:"400",lineHeight:"20px",alignSelf:"center",textAlign:"center"},tagName:"div"}),y.a.createElement(Ze,{countryCode:d.countryCode,countryIsoCode:d.countryIsoCode,phoneNumber:d.phoneNumber,textKey:"STR_PHONE_NUMBER",onChange:({countryCode:e,countryIsoCode:t,phoneNumber:a})=>{var n;n={countryCode:e,countryIsoCode:t,phoneNumber:a},d.errorMessage="",d.phoneNumber=n.phoneNumber,d.countryIsoCode=n.countryIsoCode,d.countryCode=n.countryCode,d.enableNext=d.phoneNumber.length>=6},inputProps:{placeholder:F.str("STR_PHONE_NUMBER"),onKeyPress:e=>{!function(e){13==e.which&&(d.enableNext&&_(),e.preventDefault())}(e)}},ref:l}),y.a.createElement("span",{className:"login-error-message"+(d.errorMessage?"":"--none"),style:{marginTop:"-8px",width:"100%",textAlign:"start"}},d.errorMessage)),y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",gap:"16px",alignItems:"center",justifyContent:"flex-start",boxSizing:"border-box"}},y.a.createElement(Ge.a,{textKey:"STR_CONTINUE",onClick:()=>{_()},disabled:!d.enableNext||""!==d.errorMessage,size:"large","data-id":"btn_forget_password_verify_phone",style:{margin:"0",width:"100%"}})))};a("36dD");const at=()=>{const e=W(),t=le({step:"idle"});function a(){e.stateMachine.handler(Y.main_choose_login_normal),e.stateMachine.state.data={phoneNumber:"",countryIsoCode:"VN",countryCode:84,authToken:""},e.loginSession.loginStateStream.next(e.stateMachine.state),t.step="idle"}return Object(p.useEffect)((()=>{"idle"===t.step&&e.stateMachine.state.key===H.ForgetPassword?t.step="verify-phone":e.stateMachine.state.key!==H.ForgetPassword&&"idle"!==t.step&&(t.step="idle")}),[t.step,e.stateMachine.state]),y.a.createElement(p.Fragment,null,y.a.createElement("div",{className:"forget-password-page"},y.a.createElement("div",{className:"title"},y.a.createElement("img",{draggable:!1,src:fe.a,style:{height:"32px",alignSelf:"center"}}),"idle"!==t.step&&y.a.createElement(ue.a,{textKey:(()=>{switch(t.step){case"verify-phone":return"STR_PASSWORD_RECOVERY";case"required-otp":return"STR_VERIFY_ACCOUNT";case"setup-password":return"STR_UPDATE_LOGIN_PASSWORD"}})(),style:{margin:"0",color:"var(--text-primary)",fontSize:"18px",lineHeight:"24px",fontWeight:600,alignSelf:"center"},tagName:"div"})),y.a.createElement("div",{className:"body"},"verify-phone"===t.step&&y.a.createElement(tt,{next:()=>{t.step="required-otp"}}),"required-otp"===t.step&&y.a.createElement($e,{next:()=>{t.step="setup-password"}}),"setup-password"===t.step&&y.a.createElement(et,{submit:t=>{var a;a=t,e.stateMachine.state.data=null,e.stateMachine.handler(Y.main_accepted_login),e.stateMachine.state.data={typeLogin:Ce().LOGIN_TYPE_PASSWORD},e.loginSession.loginStateStream.next(e.stateMachine.state),e.loginSession.logInfoV2Stream.next({type:152404,subType:0,data:{authentication_status:!0,login_method:"recover_password",uid:a}})}}))),y.a.createElement("div",{className:"forget-password-page__footer"},y.a.createElement(Ge.a,{size:"medium",textKey:"STR_CANCEL",onClick:()=>{"setup-password"===t.step?e.loginSession.popupStream.next(y.a.createElement(O.default,{visible:!0,showCloseButton:!0,idName:"noti-user-really-want-to-cancel-change-password-modal",noPadding:!0,border:"no-border",style:{borderRadius:"8px",background:"transparent"},okText:F.str("STR_DISCARD"),okType:"secondary-danger",cancelText:F.str("STR_CLOSE"),onOk:()=>{a()},onCloseConfirm:()=>{e.loginSession.popupStream.next(null)},preventPageClickForceClose:!0,message:F.str("STR_DISCARD_RESET_PW")})):a()},className:"footer-btn",type:"tertiary-neutral"})))};a("47Cz");const nt=0,ot=1,st=()=>{const[e,t]=y.a.useState(nt),a=Object(p.useRef)(null);function n(){a.current=window.setTimeout((()=>{t(ot)}),12e4)}return y.a.useEffect((()=>(n(),()=>{null!==a.current&&clearTimeout(a.current)})),[]),e===nt?y.a.createElement("div",{className:"network-comp--no-network-banner"},y.a.createElement(de.a,{icon:"outline-disconnect",style:{color:"var(--text-primary)"}}),y.a.createElement(ue.a,{tagName:"div",textKey:"STR_INFO_NO_NETWORK",style:{color:"var(--text-primary)"}})):y.a.createElement("div",{className:"network-comp--no-network-screen"},y.a.createElement("div",{className:"body"},y.a.createElement("img",{draggable:!1,src:fe.a,style:{height:"32px",alignSelf:"center"}}),y.a.createElement("div",{className:"content"},y.a.createElement(de.a,{icon:"icon-disconnect",style:{color:"var(--icon-secondary)",fontSize:"68px"}}),y.a.createElement("span",{style:{display:"flex",flexDirection:"column",gap:"8px",alignItems:"center",width:"100%",maxWidth:"356px"}},y.a.createElement(ue.a,{textKey:"STR_CANT_CONNECT_1",tagName:"div",style:{fontSize:"1.125rem",fontWeight:500,lineHeight:"1.5",textAlign:"center"}}),y.a.createElement(ue.a,{textKey:"STR_CANT_CONNECT_3",tagName:"div",style:{fontSize:"0.875rem",fontWeight:400,lineHeight:"1.5",textAlign:"center"}})))),y.a.createElement("div",{className:"footer"},y.a.createElement(Ge.a,{type:"tertiary-neutral",size:"medium",textKey:"STR_BACK_TO_LOGIN",onClick:function(){t(nt),n()}})))};a("t3EU");const rt=()=>{const e=W(),t=le({loginStateKey:e.stateMachine.state.key,isNoNetwork:!window.navigator.onLine});return Object(p.useEffect)((()=>{e.loginSession.loginStateStream.subscribe((e=>{e&&(t.loginStateKey=e.key)})),g.default.checkNetwork((e=>{t.isNoNetwork=!e}))}),[]),y.a.createElement("div",{className:"login-layout"},y.a.createElement("div",{style:{height:"fit-content",position:"absolute",width:"100%",top:"40px",display:t.isNoNetwork?"block":"none"},className:Object(V.a)(["wrap-loss-network",t.isNoNetwork?"slideInDown":"slideOutUp"])},t.isNoNetwork&&y.a.createElement(st,null)),y.a.createElement("div",{key:"LoginQRPage",style:{display:t.loginStateKey===H.LoginQR?"flex":"none"},className:Object(V.a)(["login-page-wrap",""+(t.loginStateKey===H.LoginQR?"login-page-wrap__animation--show":"login-page-wrap__animation--hide")])},y.a.createElement(Ue,null)),e.enableEntryLoginPassword&&y.a.createElement("div",{key:"LoginNormalPage",style:{display:t.loginStateKey===H.LoginNormal?"flex":"none"},className:Object(V.a)(["login-page-wrap",""+(t.loginStateKey===H.LoginNormal?"login-page-wrap__animation--show":"login-page-wrap__animation--hide")])},y.a.createElement(Je,{isFocusLoginNormal:t.loginStateKey===H.LoginNormal})),e.enableEntryLoginPassword&&y.a.createElement("div",{key:"ForgetPasswordPage",style:{display:t.loginStateKey===H.ForgetPassword?"flex":"none"},className:Object(V.a)(["login-page-wrap",""+(t.loginStateKey===H.ForgetPassword?"login-page-wrap__animation--show":"login-page-wrap__animation--hide")])},y.a.createElement(at,null)),y.a.createElement("div",{key:"LoginSuccessPage",style:{display:t.loginStateKey===H.LoginSuccess?"flex":"none"}}))};var it=a("MEZx"),ct=a("NDmK");const lt=({country:e})=>y.a.createElement("span",{className:"emoji-sizer emoji-outer ",style:{background:`url(${ct.default.emojiImg})`,backgroundSize:"6500%",backgroundPosition:ct.default.emojiMapPos[`:flag-${e}:`],WebkitUserSelect:"none",marginLeft:"5px",verticalAlign:"text-bottom",height:"18px"}});var ut=a("IjM+");a("w4sY");const dt=({platform:e,handlerCloseAppOnWindowOS:t,openAppInfo:a,loginWithPassword:n,handlerMinimiseAppWindowOS:o,enableBadgeMenu:s})=>{const r=Object(p.useRef)(null),i=Object(p.useRef)(null),c=le({languageSelected:K.default.currentLanguage(),isShowMenu:!1,adminConfig:"",enableBadgeMenu:s});function l(e){var t;K.default.changeToLang(e),c.languageSelected=e,$zapp.changeLanguage(K.default.getCurrentLanguageName()),null===(t=r.current)||void 0===t||t.close(null)}return y.a.createElement(y.a.Fragment,null,y.a.createElement("div",{className:"login-title-bar"},"WIN32"===e&&y.a.createElement("div",null,y.a.createElement("i",{className:"fa fa-Minus_24_Line login-title-bar__hide-icon",onClick:e=>{e.stopPropagation(),o()}}),y.a.createElement("i",{className:"fa fa-Close_24_Line login-title-bar__close-icon",onClick:e=>{e.stopPropagation(),t()}}))),y.a.createElement("div",{className:"login-title-bar__setting-button",style:{right:"DARWIN"===e?0:void 0,left:"DARWIN"===e?void 0:0}},y.a.createElement(Ge.a,{icon:"icon-outline-menu",type:"tertiary-neutral",size:"large",ref:e=>{i.current=e},onClick:e=>{var t;null===(t=r.current)||void 0===t||t.show(e,i.current)},isActive:c.isShowMenu,style:{padding:"0"}}),c.enableBadgeMenu&&y.a.createElement(ut.a,{style:{position:"absolute",top:"8px",left:"DARWIN"===e?"8px":void 0,right:"DARWIN"===e?void 0:"8px"}})),y.a.createElement(it.default,{popoverProps:{identity:{windowId:b.c,name:Re.PopoverIdentitiesDefine.SWITCH_LANGUAGE}},ref:r,onShow:()=>{c.isShowMenu=!0},onClose:()=>{c.isShowMenu=!1,Q().setItem("z_press_menu_button_with_badge","1"),c.enableBadgeMenu=!1},items:[{type:it.MENU_ITEM_TYPE.SUBMENU,textKey:"STR_MENU_LANGUAGE",items:[{text:"Tiếng Việt",icon:{html:y.a.createElement(lt,{country:"vn"})},onclick:()=>{l(Re.LANG_INDEX_VI)},checked:c.languageSelected===Re.LANG_INDEX_VI},{text:"English",icon:{html:y.a.createElement(lt,{country:"us"})},onclick:()=>{l(Re.LANG_INDEX_EN)},checked:c.languageSelected===Re.LANG_INDEX_EN}]},{textKey:"STR_ABOUT",onclick:()=>{a()}},...n?[{textKey:"STR_LOGIN_PASSWORD_PAGE_TITLE",onclick:()=>{n()},rightIcon:c.enableBadgeMenu?{html:y.a.createElement(ut.a,{style:{position:"absolute",top:"16px",left:void 0,right:"16px"}})}:void 0}]:[]]}))};function _t(e){if(e.config_option_remember){let t=e.config_option_remember;["number","string"].includes(typeof t)&&("string"==typeof t&&(t=parseInt(t)),!isNaN(t)&&t>=0&&t<=2&&(Q().setItem(Ce().KEY_CONFIG_OPTION_REMEMBER,t),Q().setItem(Ce().KEY_CONFIG_NEW_REMEMBER,t)))}if(e.sentry_config){a("2ua2").default.saveSentryConfig(e.sentry_config)}e.auto_relaunch_mode&&e.auto_relaunch_timeout}function ht(){var e;return null!==(e=Q().getItem("zlast_uid"))&&void 0!==e?e:""}var mt=a("6LLQ");const gt="screen-old-app",pt={Root:gt,Container:`${gt}__container`,Logo:`${gt}__logo`,Title:`${gt}__title`,Btn:`${gt}__btn`},yt=()=>y.a.createElement("div",{className:`flx flx-col ${pt.Root}`},y.a.createElement("img",{src:fe.a,className:pt.Logo}),y.a.createElement("img",{src:mt.a}),y.a.createElement(ue.a,{textKey:"STR_SCREEN_OLD_APP_TITLE",tagName:"div",className:pt.Title}),y.a.createElement(ue.a,{textKey:"STR_SCREEN_OLD_APP_DESC",tagName:"div"}),y.a.createElement(Ge.a,{textKey:"STR_SCREEN_OLD_APP_DOWNLOAD_NEW",onClick:()=>{$zupdater.openUpdatePage()},size:"large",className:pt.Btn}));var Et=()=>{const{appVersionState:e}=Object(P.a)(),t=W(),a=Object(p.useRef)(null),n=le({loginStateKey:t.stateMachine.state.key,popup:null,isLoading:t.dropServerConfig});function o(e,a){a&&a.forceFallback?t.loginSession.popupStream.next(y.a.createElement(I.default,{info:a,cancel:()=>{t.loginSession.popupStream.next(null)}})):t.loginSession.popupStream.next(y.a.createElement(R.default,{info:a,cancel:()=>{t.loginSession.popupStream.next(null)}}))}function s(e,t){t&&function(e){U.g.setRecentUpdate(e)}(t)}function r(){t.loginSession.logInfoV2Stream.next({type:152406,subType:0,data:{}});const e=function(){const e=Q().getItem("zlast_logout");if(e)return Number.parseInt(e)||0;return 0}();if(Date.now()-e>864e5){let a=F.str("STR_LOGOUT_CONFIRM_HEADER"),n=F.str("STR_LOGOUT_CONFIRM_TEXT");if(!e){a=F.str("STR_LOGOUT_CONFIRM_HEADER_NEW");const e=[F.str("STR_LOGOUT_CONFIRM_TEXT_NEW_1_A")+". "+F.str("STR_LOGOUT_CONFIRM_TEXT_NEW_1_B"),F.str("STR_LOGOUT_CONFIRM_TEXT_NEW_2")];n=`${e[Math.floor(Math.random()*e.length)]}`}t.loginSession.popupStream.next(y.a.createElement(O.default,{visible:!0,onCloseConfirm:()=>{t.loginSession.popupStream.next(null)},okType:"",preventPageClickForceClose:!0,title:a,onOk:()=>{A.default.logAction(117242),A.default._log()},onCancel:(e,t)=>{if(t===O.ConfirmModalConstant.ModalClosedReason.CTAButtonClicked){const e=document.getElementById("login-splash-screen");e&&(e.style.display="flex"),A.default.logAction(117241),setTimeout((()=>{k()}),600),A.default._log()}},okText:F.str("STR_SIGNIN"),cancelText:F.str("STR_MENU_QUIT"),message:n,zIndex:1e4,showCloseButton:!0}))}else{const e=document.getElementById("login-splash-screen");e&&(e.style.display="flex"),setTimeout((()=>{k()}),600)}}return Object(p.useEffect)((()=>{var e,a;t.loginSession.loginStateStream.subscribe((e=>{if(e){if(n.loginStateKey=e.key,e.key===H.LoginSuccess.toString()){var a;const e=document.getElementById("login-splash-screen");e&&(e.style.display="flex"),t.loginSession.popupStream.next(null),Q().setItem("z_reclogtype",null===(a=t.stateMachine.state.data)||void 0===a?void 0:a.typeLogin),t.stateMachine.loginQrState.state.key!==X.TimeoutQR&&t.loginSession.loginQrStateStream.next(t.stateMachine.loginQrState.handler(Y.qr_timeout)),setTimeout((()=>{t.loginSession.notiLoginSuccess()}),600)}e.key===H.LoginNormal.toString()&&t.loginSession.logInfoV2Stream.next({type:152403,subType:0,data:{has_previous_account:ht().length>0}})}})),t.loginSession.loginStateStream.next(t.stateMachine.handler(Y.main_choose_login_qr)),t.loginSession.popupStream.subscribe((e=>{e&&(n.popup=null),n.popup=e})),t.loginSession.isLoading.subscribe((e=>{e?n.isLoading=e:setTimeout((()=>{n.isLoading=e||!1}),600)}));const r=null!==(e=Q().getItem("z_session_expired_14days"))&&void 0!==e?e:"";return t.loginSession.logInfoV2Stream.subscribe((e=>{const a=Object(N.a)({},(null!=e?e:{}).data);if(r&&(a.login_source="session_timeout_14day"),e){switch(!0){case!0===t.enableEntryLoginPassword:a.login_version="password_and_qr";break;case!1===t.enableEntryLoginPassword:a.login_version="qr_only"}a.device_imei=T(),a.session_id=t.sessionId,e.data=a,w.default.increaseSuccess(e.type,0,10,[JSON.stringify(a)]),152404===e.type&&a.authentication_status&&w.default.flush()}})),t.loginSession.logInfoV2Stream.next({type:152401,subType:0,data:{last_uid:ht()}}),t.loginSession.logInfoV2Stream.next({type:152408,subType:0,data:{last_uid:ht()}}),null!==(a=window.$zenv)&&void 0!==a&&a.isPreloaded&&($zsub.$zupdater.onNewUpdate(s),$zsub.$zupdater.onNewManualUpdate(s),$zsub.$zupdater.onFallbackUpdate(o)),()=>{t.loginSession.dispose()}}),[]),Object(p.useEffect)((()=>{if(t.dropServerConfig){let e=3;a.current=window.setInterval((async()=>{try{await async function(){return await D.b.getServerInfo(null)}();const e=D.b.getServerConfig();return e&&_t(e),a.current&&window.clearInterval(a.current),t.dropServerConfig=!1,void(n.isLoading=!1)}catch(o){t.stateMachine.state.error(o)}0==--e&&(n.isLoading=!1,a.current&&window.clearInterval(a.current))}),2e3)}return()=>{a.current&&window.clearInterval(a.current)}}),[]),n.loginStateKey===H.Idle.toString()||n.loginStateKey===H.LoginSuccess.toString()||e===M.a.NONE?y.a.createElement(y.a.Fragment,null):y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%",boxSizing:"border-box",background:"#FFFFFF"}},y.a.createElement(dt,{handlerCloseAppOnWindowOS:()=>{r()},handlerMinimiseAppWindowOS:()=>{$zwindow.minimize(b.c)},platform:"DARWIN",openAppInfo:()=>{t.loginSession.popupStream.next(y.a.createElement(v.a,{cancel:()=>{t.loginSession.popupStream.next(null)}}))},loginWithPassword:t.enableEntryLoginPassword&&n.loginStateKey===H.LoginQR&&e===M.a.VERIFIED?()=>{try{t.loginSession.loginStateStream.next(t.stateMachine.handler(Y.main_choose_login_normal))}catch(e){t.stateMachine.state.error(e)}}:void 0,enableBadgeMenu:t.enableBadgeSettingButton}),y.a.createElement(C.a,null,e===M.a.VERIFIED?y.a.createElement(rt,null):y.a.createElement(yt,null)),y.a.createElement(C.a,null,Object(E.createPortal)(n.popup,document.body,"popup")),Object(E.createPortal)(n.isLoading&&y.a.createElement("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%",boxSizing:"border-box",position:"fixed",left:0,top:0,justifyContent:"center",alignItems:"center",backdropFilter:"blur(8px)",backgroundColor:"rgba(255, 255, 255, 0.3)"}},y.a.createElement("img",{draggable:!1,src:Ee})),document.body,"loading-retry-get-config-server"))};class ft{constructor(e,t){if(this.dataCenterId=void 0,this.workerId=void 0,this.sequence=0,this.lastTimestamp=-1,e<0||e>ft.MAX_DATA_CENTER_ID)throw new Error(`Data center ID must be between 0 and ${ft.MAX_DATA_CENTER_ID}`);if(t<0||t>ft.MAX_WORKER_ID)throw new Error(`Worker ID must be between 0 and ${ft.MAX_WORKER_ID}`);this.dataCenterId=e,this.workerId=t}generateId(){let e=Date.now()-ft.EPOCH;if(e<this.lastTimestamp)throw new Error("Clock moved backwards. Refusing to generate id.");if(e===this.lastTimestamp){if(this.sequence=this.sequence+1&ft.MAX_SEQUENCE,0===this.sequence)for(;e<=this.lastTimestamp;)e=Date.now()-ft.EPOCH}else this.sequence=0;this.lastTimestamp=e;return(BigInt(e)<<BigInt(ft.TIMESTAMP_SHIFT)|BigInt(this.dataCenterId)<<BigInt(ft.DATA_CENTER_ID_SHIFT)|BigInt(this.workerId)<<BigInt(ft.WORKER_ID_SHIFT)|BigInt(this.sequence)).toString()}}ft.EPOCH=13437792e5,ft.TIMESTAMP_BITS=41,ft.DATA_CENTER_ID_BITS=5,ft.WORKER_ID_BITS=5,ft.SEQUENCE_BITS=12,ft.MAX_DATA_CENTER_ID=(1<<ft.DATA_CENTER_ID_BITS)-1,ft.MAX_WORKER_ID=(1<<ft.WORKER_ID_BITS)-1,ft.MAX_SEQUENCE=(1<<ft.SEQUENCE_BITS)-1,ft.WORKER_ID_SHIFT=ft.SEQUENCE_BITS,ft.DATA_CENTER_ID_SHIFT=ft.SEQUENCE_BITS+ft.WORKER_ID_BITS,ft.TIMESTAMP_SHIFT=ft.SEQUENCE_BITS+ft.WORKER_ID_BITS+ft.DATA_CENTER_ID_BITS;class St{constructor(){this.key=void 0,this.value=void 0}}class Tt extends St{constructor(){super(),this.key=void 0,this.value=void 0,this.observer=void 0,this.key=Symbol(new ft(0,1).generateId()),this.value=null,this.observer=new Map}subscribe(e){this.observer.set(e.getName(),e)}unsubcrise(e){this.observer.delete(e.getName())}close(){this.observer.clear()}notify(){this.observer.forEach((e=>{e.update(this)}))}}class Nt{constructor(){this.key=void 0}}class Rt extends Nt{constructor(e){super(),this.key=void 0,this.handler=void 0,this.key=Symbol(new ft(0,0).generateId()),this.handler=e}getName(){return this.key.toString()}update(e){e instanceof St&&this.handler&&this.handler(e.value)}}class It{constructor(){this.key=void 0,this.subject=void 0,this.closed=!1,this.key=Symbol(new ft(0,2).generateId()),this.subject=new Tt}next(e){this.closed||(this.subject.value=e,this.subject.notify())}subscribe(e){const t=new Rt(e);if(!this.closed)return this.subject.subscribe(t),()=>{this.subject.unsubcrise(t)};throw Error("This stream is closed, no longer can be subcrise")}complete(){this.closed||(this.subject.close(),this.closed=!0)}}class Ct{constructor(){this.key=void 0,this.loginStateStream=void 0,this.loginQrStateStream=void 0,this.isLoading=void 0,this.popupStream=void 0,this.logInfoV2Stream=void 0,this.key=Symbol("LoginSessionService"),this.loginStateStream=new It,this.loginQrStateStream=new It,this.isLoading=new It,this.popupStream=new It,this.logInfoV2Stream=new It}getName(){var e;return null!==(e=this.key.description)&&void 0!==e?e:""}notiLoginSuccess(){return $zlogin.notifyLoginSuccess()}dispose(){this.loginStateStream.complete(),this.loginQrStateStream.complete(),this.popupStream.complete(),this.isLoading.complete(),this.logInfoV2Stream.complete()}}const vt=s.ModuleContainer.resolve(h.ZLoggerFactory).createZLogger(["login-v2"]);a("xNPa");const Ot=["enableEntryLoginPassword","enableBadgeSettingButton","dropServerConfig","autoUpdater"];var bt=e=>{let{enableEntryLoginPassword:t,enableBadgeSettingButton:a,dropServerConfig:n,autoUpdater:o}=e,s=Object(S.a)(e,Ot);function r(){return{imei:T(),installerType:"unknown",autoUpdaterConfig:o}}Object(p.useEffect)((()=>(window.addEventListener("mouseup",(e=>{3!==e.button&&4!==e.button||e.preventDefault()})),$zresource.onRequestImei(r),()=>{window.removeEventListener("mouseup",(()=>{})),$zresource.removeListenRequestImei(r)})),[]);const i=Object(p.useMemo)((()=>{return e=e=>y.a.createElement(Et,e),o={token:"login-v2",loginSession:new Ct,stateMachine:new te("production",vt),enableEntryLoginPassword:t,dropServerConfig:n,sessionId:new ft(0,3).generateId(),enableBadgeSettingButton:a},t=>y.a.createElement(z.Provider,{value:o},y.a.createElement(e,t));var e,o}),[]);return y.a.createElement(i,s)},At=a("17x9"),wt=a.n(At);y.a.Component;var Pt=a("ob4H"),Mt=a("yUfy");const xt=()=>$zlogin.notifyLoginSuccess(),Lt=1,kt="LOGIN_FAIL",Dt="SECURITY_LOGIN_PASS",Ut="UPDATE_QUESTION_DATA",Gt="GET_CAPTCHA",qt="SET_QR_IMAGE",jt="SET_QR_ERROR_MESSAGE",Qt="SHOW_LOGIN_QR",Kt="SHOW_LOGIN_PASS",Bt="SHOW_REGISTER",Ft="QR_SHOW_TIPS",zt="QR_HIDE_TIPS",Wt="SET_QR_CURRENT_DATA",Vt="LOGIN_SUCCESS",Ht="TOGGLE_CONFIRM",Xt="TOGGLE_APP_INFO",Yt="RESET",Zt="TOGGLE_SENSITIVE_LOGIN",Jt="SHOW_MOBILE_LOGIN",$t="QR_EXPIRED",ea=e=>$zlogin.updateLoginStep(e),ta={LOGIN_STEP_ENTER_LOGIN_PASS:"4",LOGIN_STEP_GET_CAPTCHA_PASS:"4.1",LOGIN_STEP_READY_LOGIN_PASS:"4.2",LOGIN_STEP_INPUT_EMPTY_INFO_PASS:"4.4",LOGIN_STEP_INPUT_INVALID_PHONE_PASS:"4.5",LOGIN_STEP_ENTER_LOGIN_QR:"5",LOGIN_STEP_GET_QR:"5.1",LOGIN_STEP_WAITING_SCAN:"5.2",LOGIN_STEP_WAITING_CONFIRM:"5.3",SIGNUP_STEP_INPUT_NUMBER:"10.0",SIGNUP_STEP_INPUT_NUMBER_NEED_CAPTCHA:"10.1",SIGNUP_STEP_EXIST_ACCOUNT:"10.2",SIGNUP_STEP_WAIT_SMS_CODE:"10.3",SIGNUP_STEP_WAIT_CALL_CODE:"10.4",SIGNUP_STEP_WAIT_MANUAL_CODE:"10.5",SIGNUP_STEP_UPDATE_PROFILE:"10.6",FORGOT_STEP_INPUT_NUMBER:"11.1",FORGOT_STEP_INPUT_NUMBER_NEED_CAPTCHA:"11.2",FORGOT_STEP_WAIT_SMS_CODE:"11.3",FORGOT_STEP_WAIT_CALL_CODE:"11.4",FORGOT_STEP_WAIT_MANUAL_CODE:"11.5",FORGOT_STEP_SECURITY_QUESTION:"11.6",FACEBOOK_STEP_WAIT_BROWSER_RESPONSE:"12.1",FACEBOOK_STEP_INPUT_NUMBER:"12.2",FACEBOOK_STEP_INPUT_NUMBER_NEED_CAPTCHA:"12.3",FACEBOOK_STEP_PHONE_LINKED_LOGIN:"12.4",FACEBOOK_STEP_PHONE_LINKED_EDIT_NUMBER:"12.5",FACEBOOK_STEP_WAIT_ZALO_CODE:"12.6",FACEBOOK_STEP_WAIT_SMS_CODE:"12.7",FACEBOOK_STEP_WAIT_CALL_CODE:"12.8",FACEBOOK_STEP_WAIT_MANUAL_CODE:"12.9",LOGIN_STEP_SUBMIT_OTP:"6.5",LOGIN_STEP_SECURITY_QUESTION:"13.0",LOGIN_STEP_SECURITY_QUESTION_FAIL:"13.1"},aa=18010,na=-10,oa=-100,sa=-200,ra=18012,ia=18021,ca=18029,la=18015,ua=18033;var da=a("XD71"),_a="assets/login_img_security.85122757babe46a7f06a3bc55bd1c915.png",ha=a("ptcT");function ma(e,t){let a="";return e?(e.errorMessageLocalize&&(a=e.errorMessageLocalize),a||(a=function(e,t){let a="";switch(e.errorCode){case Le.a.INVALID_FACEBOOK_TOKEN:a=K.default.str("STR_SIGNIN_ERROR_FACEBOOK_TOKEN");break;case Le.a.USER_WAS_BANNED:a=K.default.str("STR_SIGNIN_ERROR_ACCOUNT_BANNED");break;case Le.a.REQUEST_RATE_LIMIT_EXCEEDED:a=K.default.str("STR_SIGNIN_ERROR_CAPPED_INCORRECT_ATTEMPTS");break;case Le.a.INVALID_PHONE_NUMBER:a=K.default.str("STR_SIGNIN_ERROR_INVALID_PHONE_NUMBER");break;case Le.a.ACCOUNT_NOT_ACTIVE:a=K.default.str("STR_SIGNIN_ERROR_UNKNOWN_PHONE_NUMBER");break;case Le.a.INVALID_OTP_CODE:a=K.default.str("STR_SIGNIN_ERROR_INCORRECT_CODE");break;case Le.a.INVALID_PHONE_NUMBER_OR_PASSWORD:a=null!=t&&t.useRecentData?K.default.str("STR_SIGNIN_ERROR_INCORRECT_PASSWORD"):K.default.str("STR_SIGNIN_ERROR_INCORRECT_PASSWORD_OR_PHONE");break;case Le.a.INVALID_CAPTCHA:a=K.default.str("STR_SIGNIN_ERROR_INCORRECT_CAPTCHA");break;case Le.a.INVALID_PARAM:a=K.default.str("STR_SIGNIN_ERROR_INVALID_PARAMS");break;case Le.a.CAPTCHA_EXPIRED:a=K.default.str("STR_SIGNIN_ERROR_CAPTCHA_EXPIRED");break;case Le.a.CAPTCHA_RETRY_RATE_LIMIT_EXCEEDED:a=K.default.str("STR_SIGNIN_ERROR_CAPPED_INCORRECT_CAPTCHAS");break;case Le.a.CAPTCHA_REQUIRED:a=K.default.str("STR_SIGNIN_ERROR_EMPTY_CAPTCHA");break;case Le.a.PROFILE_CREATION_QUOTA_LIMIT_EXCEEDED:a=K.default.str("STR_SIGNIN_ERROR_CAPPED_REGISTRATIONS");break;case Le.a.SMS_QUOTA_LIMIT_EXCEEDED:a=K.default.str("STR_SIGNIN_ERROR_CAPPED_SMS_SEND_REQUESTS");break;case Le.a.VOICE_QUOTA_LIMIT_EXCEEDED:a=K.default.str("STR_SIGNIN_ERROR_CAPPED_CALL_SEND_REQUESTS");break;case Le.a.SECURITY_QUESTION_REQUIRED:a=K.default.str("STR_SIGNIN_ERROR_WRONG_ANSWER");break;case Le.a.SECURITY_QUESTION_QUOTA_LIMIT_EXCEEDED:a=K.default.str("STR_SIGNIN_ERROR_CAPPED_SECURITY_QUESTION");break;case Le.a.ZALO_ACTIVE_CODE_QUOTA_LIMIT_EXCEEDED:a=K.default.str("STR_SIGNIN_ERROR_CAPPED_CODE_SEND_REQUESTS");break;case Le.a.OUT_OF_SECQ_QUOTA:case Le.a.OUT_OF_SECQ_2_STEP_QUOTA:a=K.default.str("STR_SECQ_ERROR");break;case Re.NetWorkError.NO_NETWORK:case Re.NetWorkError.TIMEOUT_SENT:case Re.NetWorkError.TIMEOUT:a=K.default.str("STR_SIGNIN_ERROR_NO_NETWORK")}return a}(e,t)),a):a}var ga=function(){let e=null;return{getAuthenticationController:()=>{var t;return e||(e=null===(t=a("X4fA"))||void 0===t?void 0:t.default)}}}().getAuthenticationController;var pa=function(e){const{checked:t=!1,format:a,id:n,thumb:o,title:s,onClick:r}=e,i=e=>{r&&r(e,{id:n,thumb:o,title:s})};return y.a.createElement("div",{className:Object(V.a)("rel","flx flx-al-c","login-pass__questionnaire__questions__item"),onClick:i},o&&y.a.createElement(_e.d,{target:{displayName:s,avatar:o},size:"l"}),y.a.createElement("div",{className:Object(V.a)("name",o&&"ml-12")},s),y.a.createElement(We.a,{className:"fl-r",checked:t,onChange:i}))};var ya=function(e){var t,a;const{data:n,disabled:o=!1,errorMessage:s,resetChecked:r=!1,onBack:i,onAnswerQuestions:c,onUpdateCheckedList:l}=e,[u,d]=y.a.useState({}),_=Object.keys(u).length>=n.answerType;let h=n.content+` ${K.default.trans("STR_SECURITY_QUESTION_MESSAGE_SUBTEXT",[(null!==(t=n.answerType)&&void 0!==t?t:0).toString()])}`;const m=(e,t)=>{const a=t.id,n=Object(N.a)({},u);n[a]?delete n[a]:n[a]=Object(N.a)({},t),g(n)},g=e=>{d(e),l&&l(e)};return y.a.useEffect((()=>{g({})}),[r]),y.a.createElement("div",{className:Object(V.a)("flx","flx-col","flx-1","flx-al-c","login-padding"),style:{paddingTop:"16px"}},y.a.createElement(ue.a,{className:"sigin-title",tagName:"div",textKey:"STR_LOGIN_ACCOUNT"}),y.a.createElement("div",{className:"pw-description"},h),s?y.a.createElement(ue.a,{className:Object(V.a)("error","text-center","mt-8","mb-0"),textKey:s}):null,y.a.createElement("div",{id:"listLoginQuestion",className:Object(V.a)("login-pass__questionnaire__questions","w100")},y.a.createElement(ze.a,{autoHide:!1,className:"login-pass__questionnaire__questions__inner"},(null!==(a=n.choices)&&void 0!==a?a:[]).map((e=>y.a.createElement(pa,{key:"item_qs_"+e.value,checked:!!u[e.value],format:n.format,id:e.value,thumb:e.thumb,title:e.title,onClick:m}))))),y.a.createElement(Ge.a,{className:"login-pass__questionnaire__questions__submit-button",disabled:!_||o,loading:o,onClick:e=>{_&&c&&c(e,u)},size:"large",textKey:"STR_ANSWER"}),y.a.createElement("div",{className:"flx-1"}),y.a.createElement(Ge.a,{type:"tertiary-primary",onClick:e=>{i&&i(e)},size:"large",textKey:"STR_BACK"}))};var Ea=function(e){const{data:t,dispatch:a,onBack:n,onLoginSuccess:o}=e,[s,r]=y.a.useState([]),[i,c]=y.a.useState(!1),[l,u]=y.a.useState(!1),[d,_]=y.a.useState(""),h=y.a.useRef(null),m=()=>{null!=h.current&&(clearTimeout(h.current),h.current=null)},g=()=>{m(),h.current=setTimeout((()=>{h.current=null,a&&a({type:kt,payload:""})}),6e5)},p=e=>{const t=ga();if(!t)return;const n=Re.ACTIVE_TYPE_LOGIN,o=t.getZaloClientID(),{phone:s,captcha:r,captchaToken:i,countryCode:c,countryIsoCode:l}=e;t.verifyPhoneNumberV2(o,s,l,n).then((e=>{const{data:n}=e;if(n&&n.quota_info&&n.quota_info.length>0){let e=n.quota_info;e.sort(((e,t)=>e.priority-t.priority));const u=e[0].type;t.getActiveCode(o,s,l,u,i,r,Re.ACTIVE_TYPE_LOGIN).then((()=>{--e[0].quota,this.props.dispatch({type:Bt,payload:{phone:s,countryIsoCode:l,countryCode:c,activeType:Re.ACTIVE_TYPE_LOGIN,answerSecurityFail:!0,verifyType:u,quotaInfo:e}})})).catch((e=>{a&&a({type:kt,payload:ma(e)})}))}})).catch()},E=e=>{let t=e.errorMessageLocalize;!t&&e.errorCode&&(t=ma(e)),_(t),u(!l)};return y.a.useEffect((()=>(ea(ta.LOGIN_STEP_SECURITY_QUESTION),g(),()=>{m()})),[]),y.a.createElement(ya,{data:t.questionData,disabled:i,errorMessage:d,resetChecked:l,onAnswerQuestions:()=>{c(!0);const e=ga();if(!e)return;const n=t.phone,r=t.password,i=t.captcha,l=t.captchaToken,u=e.getZaloClientID(),d={question_type:t.questionData.questionType,answer_type:t.questionData.answerType,answers:s.join(",")},_={code:t.countryCode,iso:t.countryIsoCode};e.loginWithPassword(n,r,i,l,u,1,d,_).then((()=>{c(!1),o&&o()})).catch((e=>{c(!1);((e,t)=>{if(e.errorCode===Le.a.SECURITY_QUESTION_REQUIRED){const n=Dt,o={phone:t.phone,password:t.password,captcha:t.captcha,captchaToken:t.captchaToken,countryCode:t.countryCode,countryIsoCode:t.countryIsoCode,eCode:e.errorCode};e.data&&(o.questionData=e.data),E(e),g(),a&&a({type:n,payload:o})}else if(e.errorCode===Le.a.SECURITY_QUESTION_QUOTA_LIMIT_EXCEEDED){var n;(null===(n=t.phone)||void 0===n?void 0:n.length)>0&&p(t),g()}else if(e.errorCode===Le.a.PASSWORD_NOT_SET){let n="";e.data&&e.data.display_name&&(n=String(e.data.display_name)),a&&a({type:Bt,payload:{phone:t.phone,captcha:t.captcha,captchaToken:t.captchaToken,passwordInvalid:!0,activeType:3,displayName:n}})}else e.errorCode===Le.a.OUT_OF_SECQ_QUOTA||e.errorCode===Le.a.OUT_OF_SECQ_2_STEP_QUOTA?a&&a({type:Qt,payload:{errorMessage:ma(e)}}):E(e)})(Object(ha.a)(e),{phone:n,password:r,captcha:i,captchaToken:l,countryCode:_.code,countryIsoCode:_.iso})}))},onBack:n,onUpdateCheckedList:e=>{const t=[];for(const a in e)e[a]&&t.push(a);r(t)}})};var fa=function(e){const{data:t,dispatch:a,onAnswerSuccess:n,onBack:o,onBackToPhoneValidation:s}=e,[r,i]=y.a.useState([]),[c,l]=y.a.useState(!1),[u,d]=y.a.useState(!1),[_,h]=y.a.useState(""),m=y.a.useRef(null),g=()=>{null!=m.current&&(clearTimeout(m.current),m.current=null)},p=()=>{g(),m.current=setTimeout((()=>{m.current=null,a&&a({type:kt,payload:""})}),6e5)};return y.a.useEffect((()=>(ea(ta.FORGOT_STEP_SECURITY_QUESTION),p(),()=>{g()})),[]),y.a.createElement(ya,{data:t.questionData,disabled:c,errorMessage:_,resetChecked:u,onAnswerQuestions:()=>{l(!0);const e=ga();if(!e)return;const{userData:o}=t,i=o.phone,c=o.token,_=o.countryCode,m=o.countryIsoCode,g={question_type:t.questionData.questionType,answer_type:t.questionData.answerType,answers:r.join(",")},y={isoCode:m};e.answerSecQWhenResetPassword(i,c,g,y).then((()=>{l(!1),n&&n()})).catch((e=>{l(!1);((e,t)=>{const n=e.errorCode;if(n===Le.a.SECURITY_QUESTION_REQUIRED){var o;p(),h(e.errorMessageLocalize),d(!u);const n=Bt,s={phone:t.phone,countryCode:t.countryCode,countryIsoCode:t.countryIsoCode,eCode:e.errorCode};var r;null!==(o=e.data)&&void 0!==o&&o.question&&(s.questionData=null===(r=e.data)||void 0===r?void 0:r.question),a&&a({type:n,payload:s})}else n===Le.a.INVALID_RESET_PWD_TOKEN||n===Le.a.RESET_PWD_TOKEN_NOT_FOUND||n===Le.a.RESET_PWD_TOKEN_EXPIRED?s&&s(ma(e)):n===Le.a.OUT_OF_SECQ_QUOTA||n===Le.a.OUT_OF_SECQ_2_STEP_QUOTA?(p(),a&&a({type:Qt,payload:{errorMessage:ma(e)}})):(h(e.errorMessageLocalize),d(!u))})(Object(ha.a)(e),{phone:i,token:c,countryCode:_,countryIsoCode:m,answerData:g})}))},onBack:o,onUpdateCheckedList:e=>{const t=[];for(const a in e)e[a]&&t.push(a);i(t)}})},Sa=a("t3Jo");function Ta(e,t){return new Sa.b(e,t)}var Na=function(e){const{ISOCode:t,phoneNumber:a}=e,n=Ta(a,t);return y.a.createElement("div",{className:"reg-phonenumber"},"+",n.getCountryCode()," ",n.getPhone())};var Ra=new class{constructor(){this.countryCodeMap=new Map,this.data=[],this.ISOCodeMap=new Map,this.load()}getCountryCodeFromISOCode(e){if(!this.ISOCodeMap.has(e))return-1;const t=this.data[this.ISOCodeMap.get(e)];return t?t.country_code:-1}getIsoCodeFromCountryCode(e){if(!this.countryCodeMap.has(e))return"";const t=this.data[this.countryCodeMap.get(e)];return t?t.iso_country_code:""}load(){const e=a("6T4N"),t=e.countries.length;let n;for(let a=0;a<t;a++)n=e.countries[a],this.data.push(n),this.countryCodeMap.set(n.country_code,a),this.ISOCodeMap.set(n.iso_country_code,a)}};var Ia=function(e){const{onClickToS:t}=e;return y.a.createElement("div",{key:"tos",className:"tos-agreement"},y.a.createElement(ue.a,{textKey:"STR_TOS_TEXT_FIRST"}),y.a.createElement(ue.a,{className:"term-link",onClick:t,textKey:"STR_TOS_TEXT_SECOND"}),y.a.createElement(ue.a,{textKey:"STR_TOS_TEXT_THIRD"}))};var Ca=function(e){const{checked:t,className:a,content:n,contentRenderer:o,id:s,onCheck:r,shape:i="square"}=e;return y.a.createElement("div",{className:Object(V.a)("w-100 flx flx-al-c",a)},y.a.createElement("div",{className:"flx-centralized mr-8"},y.a.createElement(We.a,{checked:t,onChange:e=>{"function"==typeof r&&r(e,s,n)},shape:i})),y.a.createElement("div",null,o||y.a.createElement("div",{className:"flx flx-al-c"},n)))},va=a("dbb5");function Oa(e){const t=e[Object(va.a)()];if(!t)return y.a.createElement(y.a.Fragment,null);let a;if(t.args){const e=[];let n=t.text;for(let a=0;a<t.args.length;a++){const o=t.args[a],s=t.urls&&t.urls[a];let r;r=s?y.a.createElement("a",{className:"cursor-pointer",href:s,target:"_blank"},o):y.a.createElement("span",null,o);const i=n.indexOf(`$${a}$`),c=n.slice(0,i);e.push(y.a.createElement("span",null,c)),e.push(r),n=n.slice(i+`$${a}$`.length)}n&&e.push(y.a.createElement("span",null,n)),a=y.a.createElement(y.a.Fragment,null,e)}else a=y.a.createElement("span",null,t.text);return y.a.createElement("div",null,a)}function ba(e){const{terms:t=[],onCheck:a}=e;return y.a.createElement(y.a.Fragment,null,t.map(((e,t)=>null==e?null:y.a.createElement(Ca,{key:e.id,className:Object(V.a)(0!==t&&"mt-8"),contentRenderer:Oa(e.content),id:e.id,onCheck:a}))))}var Aa=function(e){var t;const{className:a,onTickChanged:n,termsOfServiceData:o}=e,s=y.a.useRef({});return y.a.createElement("div",{className:Object(V.a)("w-100",a)},y.a.createElement("div",null,K.default.str("STR_TOS_AGREEMENTS")),y.a.createElement("div",{className:"mt-16"},y.a.createElement(ba,{onCheck:(e,t)=>{if(s.current[t]=e,"function"==typeof n){var a;let e;const t="string"==typeof(null===(a=o.GDPR)||void 0===a?void 0:a.required)&&o.GDPR.required.split("-");if(t)for(let a=0;a<t.length;a++){if(!s.current.hasOwnProperty(t[a])||!s.current[t[a]]){e=!1;break}e=!0}n(Object(N.a)({},s.current),e)}},terms:null===(t=o.GDPR)||void 0===t?void 0:t.terms})))};const wa=s.ModuleContainer.resolve(h.ZLoggerFactory).createZLogger("login",["register"]),Pa="SMS",Ma="VOICE";let xa,La,ka;const Da=new class{check(e,t){var a,n,o;if(null!==(a=this.cachePhone)&&void 0!==a&&a.hasOwnProperty(e)&&(null===(n=this.cachePhone[e])||void 0===n?void 0:n.iso)===t)return null===(o=this.cachePhone[e])||void 0===o?void 0:o.error;return null}pushCachePhone(e,t,a){this.cachePhone||(this.cachePhone={}),this.cachePhone[e]={phone:e,iso:t,error:a}}removeCachePhone(e){this.cachePhone&&delete this.cachePhone[e]}},Ua=1,Ga=2,qa=3,ja=4,Qa=0,Ka=1,Ba=2,Fa=1,za=2;class Wa extends y.a.Component{constructor(e){super(e),this.setCaptchaImage=(e,t)=>{this.prevCaptchaImage=this.state.captchaImg,e?this.setState({captchaImg:e,errorMessage:t||K.default.str("STR_ERR_NEED_INPUT_CAPTCHA")}):this.setState({captchaImg:null})},this.showSendOTPConfirmPopup=e=>{if(!this.props.dispatch)return;const{countryCode:t,phoneNumber:a}=e;this.props.dispatch({type:Ht,payload:{message:K.default.trans("STR_CONFIRM_OTP_TEXT",[t,a]),callback:e=>{e&&this._getActiveCode()},confirmText:K.default.str("STR_CONFIRM"),cancelText:K.default.str("STR_CLOSE")}})},this.verifyPhoneNumber=()=>{this.setState({errorMessage:null});const e=g.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode);if(!e)return!1;this.setBlocking(!1),this.__checkInvalidPhone(e,this.state.countryIsoCode)||this.callVerifyPhoneNumber(e)},this.callVerifyPhoneNumber=e=>{this.setBlocking(!0);const t=this.state.activeType===Re.ACTIVE_TYPE_LOGIN?Re.ACTIVE_TYPE_REGISTER:this.state.activeType,a={context:za,captchaToken:this.captchaToken,captchaAnswer:this.state.captchaAnswer};ve.default.verifyPhoneNumberV2(this.imei,e,this.state.countryIsoCode,t,a).then((t=>{this.setBlocking(!1);const{data:a}=t;wa.zsymb(21,"1Zy1M_",["verifyPhoneNumber V2 success {}","ZluPla"],a),this.handleVerifyPhoneNumberSuccess(Re.ACTIVE_TYPE_LOGIN,Object(N.a)(Object(N.a)({},a),{},{phoneNumber:e,countryCode:this.state.countryCode}))})).catch((e=>{this.setBlocking(!1),wa.zsymb(21,"As1kHi",["verifyPhoneNumber {}","_B2qQD"],e),this._handleError(e)}))},this.handleVerifyPhoneNumberSuccess=(e,t)=>{if(!t)return;this.state.captchaImg&&this.setCaptchaImage(null);const{quota_info:a,manual_sms:n,phone_id:o}=t;a&&(this.verifyTypes=a.filter((e=>"ZALO"!==e.type))||[]),null!=n&&n.hint&&this.setManualSmsHint(n.hint),o&&(this.encryptedPhoneData={phoneNumber:t.phoneNumber,phoneId:t.phone_id});const{activated:s}=t;e===Re.ACTIVE_TYPE_REGISTER?s?(ea(ta.SIGNUP_STEP_EXIST_ACCOUNT),this.setState({errorMessage:K.default.str("STR_ERROR_EXISTING_ACCOUNT")})):(t.terms_of_services&&this.setTermsOfService(t.terms_of_services),this.setState({reviewPhoneNum:!0,errorMessage:null})):s?this.showSendOTPConfirmPopup(t):this.setState({errorMessage:K.default.str("STR_SIGNIN_ERROR_UNKNOWN_PHONE_NUMBER")})},this.onAnswerSeqSuccess=()=>{this.setState({step:ja})},this.onBackToLoginPassword=()=>{this.props.dispatch({type:Kt})},this.onBackToPhoneValidation=e=>{this.setState({step:Ua,errorMessage:e})},this.onToSTickChanged=(e,t)=>{t!==this.state.isToSRequirementsMet&&this.setState({isToSRequirementsMet:t})},this.dispatch=e.dispatch;let t=this.props.lastData;this.state={step:Ua,countryCode:e.activeType===Re.ACTIVE_TYPE_LOGIN&&e.countryCode||ka||84,countryIsoCode:e.activeType===Re.ACTIVE_TYPE_LOGIN&&e.countryIsoCode||La||"VN",phoneNumber:e.activeType===Re.ACTIVE_TYPE_LOGIN&&e.phoneNumber||xa||"",activeCode:"",infoMessage:null,errorMessage:null,captchaImg:"",captchaAnswer:"",activeType:e.activeType,cooldown:0,facebookAvatar:"",reviewPhoneNum:!1,enableChangePW:!1,blocking:!1,newPassword:"",rules:null,blockSubmitOTP:!1,otpScreen:Qa,isToSRequirementsMet:!1},t?(this.passwordInvalid=t.passwordInvalid,this.state.phoneNumber=t.phone,this.state.countryCode=t.countryCode,this.state.countryIsoCode=t.countryIsoCode,this.passwordInvalidName=t.displayName):(this.passwordInvalid=!1,this.passwordInvalidName=""),this.verifyType=this.props.verifyType&&this.props.verifyType.length>0?this.props.verifyType:null,this.captchaToken=null,this.rateLimited=!1,this.manualSmsHint=null,this.verifyTypes=this.props.verifyTypes?this.props.verifyTypes:[],this.imei=ve.default.getZaloClientID(),this.newStep=!0,this.encryptedPhoneData={phoneNumber:"",phoneId:""},this.termsOfServiceData=null,this._confirmGetActiveCode=this._confirmGetActiveCode.bind(this),this._getActiveCode=this._getActiveCode.bind(this),this._validateActiveCode=this._validateActiveCode.bind(this),this._handlePhoneNumberChange=this._handlePhoneNumberChange.bind(this),this._handleCaptchaAnswerChange=this._handleCaptchaAnswerChange.bind(this),this._handleError=this._handleError.bind(this),this._onLoginSuccesss=this._onLoginSuccesss.bind(this),this._getLoginCaptcha=this._getLoginCaptcha.bind(this),this._onInputType=this._onInputType.bind(this),this._cooldown=this._cooldown.bind(this),this._showTermsOfService=this._showTermsOfService.bind(this),this.allowSendActiveCodeTimestamp=0}componentWillMount(){this.state.activeType===Re.ACTIVE_TYPE_REGISTER?ea(ta.SIGNUP_STEP_INPUT_NUMBER):this.state.activeType===Re.ACTIVE_TYPE_LOGIN&&ea(ta.FORGOT_STEP_INPUT_NUMBER),g.default.getPasswordRules(this.imei,Ne.default).then((e=>{this.setState({rules:e})})).catch((e=>{}))}componentWillReceiveProps(e){e.activeType!==this.state.activeType&&(e.activeType===Re.ACTIVE_TYPE_REGISTER?ea(ta.SIGNUP_STEP_INPUT_NUMBER):e.activeType===Re.ACTIVE_TYPE_LOGIN&&ea(ta.FORGOT_STEP_INPUT_NUMBER),this.setState({activeType:e.activeType})),e.lastData&&e.lastData!==this.props.lastData&&e.lastData.questionData&&this.setState({questionData:e.lastData.questionData})}componentWillUnmount(){this.unmounted=!0,this.state.activeType===Re.ACTIVE_TYPE_REGISTER&&(xa=this.state.phoneNumber,La=this.state.countryIsoCode,ka=this.state.countryCode)}handleErrorRejectOTPOnStrangeDevice(e){let t;if(this.verifyType=null,e.data.manual_sms){const a=e.data.manual_sms;t=this.state.otpScreen===Ka?a.error&&a.instruction&&`${a.error} ${a.instruction}`:a.hint&&a.instruction&&`${a.hint} ${a.instruction}`}t&&this.setManualSmsHint(t);let a=null;this.state.step===Ga&&(a=e.errorMessageLocalize),this.setState({otpScreen:Ba}),this._showActiveCodeRequestLimitMessage(a)}handleCaptchaErrors(e){const{data:t,errorCode:a,errorMessageLocalize:n}=e;var o;(this.state.activeType===Re.ACTIVE_TYPE_REGISTER?ea(ta.SIGNUP_STEP_INPUT_NUMBER_NEED_CAPTCHA):this.state.activeType===Re.ACTIVE_TYPE_LOGIN&&ea(ta.FORGOT_STEP_INPUT_NUMBER_NEED_CAPTCHA),a===Le.a.CAPTCHA_REQUIRED)?t&&(this.captchaToken=(null===(o=t.captcha)||void 0===o?void 0:o.token)||null,this.setCaptchaImage("data:image/png;base64,"+t.captcha.captcha_img,n)):(this.prevCaptchaImage&&!this.state.captchaImg&&this.setCaptchaImage(this.prevCaptchaImage),this.setState({errorMessage:n}))}handleTopLevelError(e){if(e.errorCode===Le.a.REQUIRE_LOGIN_QR){const t={};return e.data&&(t.data=e.data),e.errorMessageLocalize&&(t.errorMessage=e.errorMessageLocalize),this.props.dispatch({type:Qt,payload:t})}if(e.errorCode===Le.a.OUT_OF_SECQ_QUOTA)return this.props.dispatch({type:Qt,payload:{errorMessage:ma(e)}})}_handleError(e){const t=Object(ha.a)(e);if(0===t.errorCode)return wa.zsymb(18,"jfISnx",e);if(this.handleTopLevelError(t),t.errorCode===Le.a.REJECTED_OTP)return this.handleErrorRejectOTPOnStrangeDevice(t);if(t.errorCode===Le.a.INVALID_CAPTCHA||t.errorCode===Le.a.CAPTCHA_EXPIRED||t.errorCode===Le.a.CAPTCHA_REQUIRED||t.errorCode===Le.a.CAPTCHA_RETRY_RATE_LIMIT_EXCEEDED)return this.handleCaptchaErrors(t);let a=ma(t);if(t.errorCode===ia&&(this.setState({blockSubmitOTP:!0}),this._blockOTPTimer&&clearTimeout(this._blockOTPTimer),this._blockOTPTimer=setTimeout((()=>{this.setState({blockSubmitOTP:!1})}),9e5)),t.errorCode!==Le.a.INVALID_PARAM||this.state.step!==Ua||this.state.captchaImg||(a=K.default.str("STR_SIGNIN_ERROR_INVALID_PHONE_NUMBER")),a||(a=t.code===Re.NetWorkError.NO_NETWORK?K.default.str("STR_SIGNIN_ERROR_NO_NETWORK"):`Error: ${t.errorCode} - ${t.errorMessage}`),t&&t.blocking_time_left){let e=Math.round(t.blocking_time_left/1e3);const n=Math.floor(e/60);e-=60*n,a=`${a} ${K.default.str("STR_RETRY_AFTER")} ${n?n+` ${K.default.str("STR_MINS")} `:""}${e} ${K.default.str("STR_SECONDS")}.`}this.setState({errorMessage:a})}_verifyPhoneNumber(e=!1,t=!1){if(this.verifyType)return this._getActiveCode();const a=g.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode);if(!a)return!1;this.setBlocking(!1),this.__checkInvalidPhone(a,this.state.countryIsoCode)||(this.setState({errorMessage:null}),this.props.dispatch({type:Ht,payload:{message:K.default.trans("STR_CONFIRM_OTP_TEXT",[this.state.countryCode,a]),callback:t=>{this.props.dispatch({type:Ht}),t?this.callVerifyPhoneNumber(a):(this.newStep=!0,e||this.onRegisterBack())},confirmText:e?K.default.str("STR_CONFIRM"):K.default.str("STR_SIGNIN_REGISTER"),cancelText:e&&!0!==t?K.default.str("STR_CLOSE"):K.default.str("STR_LATER")}}))}__showInvalidPhoneErrorCode(){setTimeout((()=>{this.setState({errorMessage:K.default.str("STR_SIGNIN_ERROR_INVALID_PHONE_NUMBER"),blocking:!1})}),300)}__checkInvalidPhone(e,t){let a=Da.check(e,t);return 18025===(null==a?void 0:a.error_code)&&(this.setState({blocking:!0,errorMessage:null}),this.__showInvalidPhoneErrorCode(),a)}_updateVerifyType(){this.verifyTypes=this.verifyTypes.filter((e=>e.quota)).sort(((e,t)=>e.priority-t.priority)),this.verifyTypes.length?this.verifyType=this.verifyTypes[0].type:this.verifyType=null}_canSubmitGetActiveCode(){return!!g.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode)&&(!this.captchaToken||this.state.captchaAnswer&&this.state.captchaAnswer.length>3)}_confirmGetActiveCode(){this.props.dispatch({type:Ht,payload:{title:"Zalo",message:K.default.str("STR_RESEND_ACTIVATION_CODE_CONFIRM"),compact:!0,confirmText:K.default.str("STR_CONFIRM"),cancelText:K.default.str("STR_CANCEL"),callback:e=>{this.props.dispatch({type:Ht}),e?this._getActiveCode():this.newStep=!0}}})}_cooldown(){if(this.unmounted)return;const e=this.state.cooldown-1;this.setState({cooldown:e}),e>0&&setTimeout(this._cooldown,1e3)}_showActiveCodeRequestLimitMessage(e){this.rateLimited=!0,this.newStep=!0,this.setState({infoMessage:this.manualSmsHint,errorMessage:null!=e?e:null,step:Ga}),this.state.activeType===Re.ACTIVE_TYPE_REGISTER?ea(ta.SIGNUP_STEP_WAIT_MANUAL_CODE):this.state.activeType===Re.ACTIVE_TYPE_LOGIN&&ea(ta.FORGOT_STEP_WAIT_MANUAL_CODE)}setManualSmsHint(e){this.manualSmsHint=e}async _getActiveCode(){if(this.state.blocking)return;if(this.saveUserToSConfirmedData(),this.setState({errorMessage:null}),!this._canSubmitGetActiveCode())return;const e=this.state.activeType;if(this._updateVerifyType(),!this.verifyType){let t=!0;if(e===Re.ACTIVE_TYPE_LOGIN&&this.encryptedPhoneData.phoneNumber===this.state.phoneNumber&&this.encryptedPhoneData.phoneId)try{const e={context:za},a=await ve.default.verifyPhoneExtra(this.encryptedPhoneData.phoneId,e);if(a){const{data:e}=a;e&&e.hasOwnProperty("allowOTP")&&!e.allowOTP&&(t=!1)}}catch(n){wa.zsymb(21,"Ro4ssb",["verify phone extra {}","IJh2sJ"],n)}if(t)return this._showActiveCodeRequestLimitMessage()}if(e===Re.ACTIVE_TYPE_REGISTER)switch(this.verifyType){case Pa:ea(ta.SIGNUP_STEP_WAIT_SMS_CODE);break;case Ma:ea(ta.SIGNUP_STEP_WAIT_CALL_CODE)}else if(e===Re.ACTIVE_TYPE_LOGIN)switch(this.verifyType){case Pa:ea(ta.FORGOT_STEP_WAIT_SMS_CODE);break;case Ma:ea(ta.FORGOT_STEP_WAIT_CALL_CODE)}const t=g.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode);this.setBlocking(!0);const a={context:e===Re.ACTIVE_TYPE_REGISTER?Fa:za};ve.default.getActiveCode(this.imei,t,this.state.countryIsoCode,this.verifyType||"SMS",this.captchaToken,this.state.captchaAnswer,this.state.activeType,a).then((()=>{this.setBlocking(!1),this.newStep=!0,this.setState({step:Ga,otpScreen:Ka,errorMessage:null,cooldown:10}),setTimeout(this._cooldown,1e3),this.verifyTypes[0].quota--})).catch((e=>{this.setBlocking(!1),this._handleError(e)}))}_canSubmitValidateActiveCode(){const e=this.state.activeCode;return!this.state.blockSubmitOTP&&e&&6===e.length}_onChangePassword(){if(this.state.blocking)return;let e=this.pwRef.value,t=this.repeatPwRef.value;if(t!==e)return void this.setState({errorMessage:K.default.str("STR_CONFORM_PW_NOT_MATCH")});this.setBlocking(!0);let{activeType:a,phoneNumber:n,countryIsoCode:o,countryCode:s}=this.state;a!==Re.ACTIVE_TYPE_REGISTER?ve.default.loginByResetPassword(n,this.imei,e,t,this.authToken,"+07:00",s,o,K.default.getCurrentLanguageName()).then((e=>{try{wa.zsymb(21,"Knn6ac",["loginByResetPassword success {}","24GPtl"],e)}catch(t){}G.default.getInstance().removeItem("FORGOT_PASSWORD"),this.setBlocking(!1),this._onLoginSuccesss()})).catch((e=>{try{wa.zsymb(21,"rKqDld",["loginByResetPassword err","iNXOle"],JSON.stringify(e))}catch(t){}this.setBlocking(!1),this._handleError(e)})):ve.default.signUpWithPassword(n,o,e,t,this.imei,this.authToken,"+07:00",K.default.getCurrentLanguageName()).then((e=>{this.setBlocking(!1),this._onLoginSuccesss()})).catch((e=>{this.setBlocking(!1),this._handleError(e)}))}_validateActiveCode(){if(this.state.blocking)return;this.setState({errorMessage:null});const e=this.state.phoneNumber,t=this.state.activeCode;if(!this._canSubmitValidateActiveCode())return;const a=Date.now();if(this.allowSendActiveCodeTimestamp>a)return void this._handleError({error_code:18012,data:{blocking_time_left:this.allowSendActiveCodeTimestamp-a}});ea(ta.LOGIN_STEP_SUBMIT_OTP);let n=this.state.activeType===Re.ACTIVE_TYPE_LOGIN;this.setBlocking(!0),ve.default.validateActiveCode(this.imei,e,this.state.countryIsoCode,this.state.countryCode,t,"+07:00",this.state.activeType,n).then((e=>{this.setBlocking(!1);const{data:t}=e||{};if(t&&(t.token&&(this.authToken=t.token),t.enk&&g.default.setDecryptKey(t.enk),1===t.requireSEQ))return this.showSecurityQuestions(t.question);this.onShowUpdatePwState()})).catch((e=>{this.setBlocking(!1),e&&e.data&&e.data.blocking_time_left&&(this.allowSendActiveCodeTimestamp=Date.now()+e.data.blocking_time_left),this._handleError(e)}))}_onLoginSuccesss(){xt()}_handlePhoneNumberChange(e){this.verifyType&&(this.verifyType=null),this.setState({countryCode:e.countryCode,countryIsoCode:e.countryIsoCode,phoneNumber:e.phoneNumber,errorMessage:null})}_handleCaptchaAnswerChange(e){this.setState({captchaAnswer:e.target.value,errorMessage:null})}_getLoginCaptcha(){Ne.default.getLoginCaptcha(ve.default.getZaloClientID()).then((e=>{0===e.data.error_code&&(this.captchaToken=e.data.data.token,this.setState({captchaImg:"data:image/png;base64,"+e.data.data.captcha_img}))})).catch((e=>{wa.zsymb(21,"Zk15Z-",["_getLoginCaptcha error {}","vkE3tW"],e)}))}checkNumberKey(e){let t=e.keyCode;return t>47&&t<58||t>95&&t<112}checkPrintableKey(e){let t=e.keyCode;return this.checkNumberKey(e)||32==t||t>64&&t<91||t>185&&t<193||t>218&&t<223}_onInputType(e){if(13===e.which)this.state.step!==Ua||this.state.activeType!==Re.ACTIVE_TYPE_LOGIN||this.passwordInvalid?this.state.step===Ga?this._validateActiveCode():this.state.reviewPhoneNum||this.firstVerifyPhoneNumber():this.verifyPhoneNumber();else if(this.state.step===Ga){let t=this.state.activeCode,a=e.target.selectionStart!==e.target.selectionEnd;if(!this.checkPrintableKey(e))return;this.checkNumberKey(e)?a||t.length>6&&(e.preventDefault(),e.stopPropagation()):(e.preventDefault(),e.stopPropagation())}}_showTermsOfService(e){e.preventDefault(),e.stopPropagation(),window.open("http://zalo.me/zalo/dieukhoan/")}isBackLogin(){return this.state.reviewPhoneNum&&this.state.step===Ua}onRegisterBack(e=!1){const t=()=>{this.isBackLogin()?this.setState({reviewPhoneNum:!1,errorMessage:""}):this.props.onLogin&&this.props.onLogin(),this.props.dispatch({type:Yt})};this.state.step!==ja?(this.resetTermsOfService(),t()):this.props.dispatch({type:Ht,payload:{message:K.default.str(e?"STR_DISCARD_RESET_PW":"STR_DISCARD_REGISTER"),callback:e=>{e?t():this.props.dispatch({type:Ht})},confirmText:K.default.str("STR_CONFIRM"),cancelText:K.default.str("STR_CLOSE")}})}showSecurityQuestions(e){this.setState({step:qa,questionData:e,errorMessage:null})}onShowUpdatePwState(){this.setState({step:ja,errorMessage:null})}onInputChangePW(e){let t=this.pwRef.value,a=this.repeatPwRef.value,n=g.default.checkValidPassword(t,"",this.state.rules||[]),o=g.default.checkValidPassword(a,t,this.state.rules||[]),s=!!t&&!!a&&o;this.passwordCheckingMsg=n?s?"":"STR_PASSWORD_DONT_MATCH":"STR_INVALID_PW",this.setState({enableChangePW:s,errorMessage:null,newPassword:t})}firstVerifyPhoneNumber(){if(this.state.blocking)return;this.setState({errorMessage:null});let e=g.default.getRawPhoneNumber(this.state.phoneNumber,this.state.countryCode);if(this.__checkInvalidPhone(this.state.phoneNumber,this.state.countryIsoCode))return;if(!e)return Da.pushCachePhone(this.state.phoneNumber,this.state.countryIsoCode,{error_code:18025}),void this.__showInvalidPhoneErrorCode();this.setBlocking(!0);const t={context:Fa,captchaToken:this.captchaToken,captchaAnswer:this.state.captchaAnswer};ve.default.verifyPhoneNumberV2(this.imei,e,this.state.countryIsoCode,Re.ACTIVE_TYPE_REGISTER,t).then((e=>{this.setBlocking(!1);const{data:t}=e;wa.zsymb(3,"9YXdE4",["first verifyPhoneNumberV2 success {}","-z0qfw"],t),this.handleVerifyPhoneNumberSuccess(Re.ACTIVE_TYPE_REGISTER,t)})).catch((e=>{this.setBlocking(!1),wa.zsymb(3,"h1UwSe",["first verifyPhoneNumberV2 {}","1XeOED"],e),this._handleError(e)}))}setBlocking(e=!0){this.setState({blocking:e})}isToSRequirementsMet(){return!this.termsOfServiceData||this.state.isToSRequirementsMet}setTermsOfService(e){this.termsOfServiceData=e}resetTermsOfService(){this.termsOfServiceData=null,this.setState({isToSRequirementsMet:!1})}saveUserToSConfirmedData(){if(this.termsOfServiceData&&this.state.isToSRequirementsMet){const{GDPR:e}=this.termsOfServiceData;if(e&&e.data){const t=Ta(this.state.phoneNumber,Ra.getIsoCodeFromCountryCode(this.state.countryCode));let a=`+${t.getCountryCode()}${t.getPhone()}`;G.default.getInstance().setItem(Re.RegisterLocalStorageKeys.TOS_CONFIRMED_DATA,JSON.stringify(Object(N.a)(Object(N.a)({},e.data),{},{phoneNumber:a})))}}}render(){let e=null;const t=e=>{const{fgPage:t}=e;return y.a.createElement("div",{className:"footer-btn"},y.a.createElement(Ge.a,{type:"tertiary-neutral",onClick:e=>this.onRegisterBack(t),size:"medium",textKey:"STR_CANCEL"}))};let a,n;this.state.captchaImg&&(n=y.a.createElement("div",{className:"z-input flx-1"},y.a.createElement(Qe.a,{required:!0,textKey:"STR_INPUT_CAPTCHA",className:"login-pass__group__captcha",inputRef:e=>{e&&this.newStep&&this.verifyType&&(e.focus(),this.newStep=!1)},name:"captcha",type:"text",maxLength:"16",value:this.state.captchaAnswer,onChange:this._handleCaptchaAnswerChange,onKeyPress:this._onInputType})),a=y.a.createElement("div",{className:"login-pass__group flx captcha-section w100 flx flx-al-c"},n,y.a.createElement("div",{id:"captcha",className:"login-pass__captcha flx flx-al-c"},y.a.createElement("img",{src:this.state.captchaImg,alt:"captcha"}),y.a.createElement("div",{className:"dib login-pass__captcha__refresh"},y.a.createElement("i",{className:"fa fa-reload btn",onClick:this._getLoginCaptcha})))));let o={marginTop:"24px",width:"100%"};if(this.state.step===Ua){let n,s=null,r=null,i=null,c=y.a.createElement(ue.a,{textKey:"STR_CREATE_NEW_ACCOUNT",tagName:"div",className:"register-title"}),l=this.passwordInvalid||this._canSubmitGetActiveCode(),u=null;if(this.state.activeType===Re.ACTIVE_TYPE_LOGIN?this.passwordInvalid?n=y.a.createElement("p",null,y.a.createElement(ue.a,{textKey:"STR_HI"})," ",y.a.createElement("strong",null,this.passwordInvalidName),", ",y.a.createElement(ue.a,{textKey:"STR_INVALID_PASSWORD_MESSAGE"})):(s=y.a.createElement(ue.a,{textKey:"STR_ENTER_PHONE_FOR_ACTIVATION_CODE",tagName:"div",className:"register-desc"}),c=y.a.createElement(ue.a,{textKey:"STR_PASSWORD_RECOVERY",tagName:"div",className:"register-title"}),u=y.a.createElement(Ge.a,{size:"large",textKey:"STR_CONTINUE",onClick:()=>this.verifyPhoneNumber(),disabled:!l||this.state.blocking,style:o,loading:this.state.blocking})):this.state.reviewPhoneNum&&(this.termsOfServiceData?(i=y.a.createElement(Aa,{className:"mt-16",onTickChanged:this.onToSTickChanged,termsOfServiceData:this.termsOfServiceData}),l=l&&this.isToSRequirementsMet(),a&&(o.marginTop="16px")):i=y.a.createElement(Ia,{onClickToS:this._showTermsOfService})),!u)if(this.state.reviewPhoneNum)u=y.a.createElement(Ge.a,{disabled:!l||this.state.blocking,format:"full-width",loading:this.state.blocking,onClick:()=>this._getActiveCode(),size:"large",style:o,textKey:this.state.activeType===Re.ACTIVE_TYPE_REGISTER?"STR_REGISTER_NEW_ACCOUNT":"STR_CONTINUE"});else{let e=!0,t=6;84===this.state.countryCode&&(t=9),(this.state.blocking||!this.state.phoneNumber||this.state.phoneNumber.length<t)&&(e=!1),u=y.a.createElement(Ge.a,{size:"large",textKey:"STR_CONTINUE",onClick:e=>this.firstVerifyPhoneNumber(),disabled:!e,style:o,loading:this.state.blocking})}e=y.a.createElement("div",{className:"login-pass reg-padding flx flx-1 flx-col flx-al-c "+(this.state.activeType===Re.ACTIVE_TYPE_LOGIN?" register-page":"")},y.a.createElement("img",{src:fe.a,className:"sign-in-logo"}),c,s||y.a.createElement(ue.a,{textKey:this.state.reviewPhoneNum?"STR_REVIEW_REGISTER_PHONE_NUMBER":"STR_CREATE_ACCOUNT_CONFIRM_TXT",tagName:"div",className:"register-desc"}),this.state.activeType!==Re.ACTIVE_TYPE_REGISTER?this.passwordInvalid?y.a.createElement("img",{src:_a,style:{marginTop:"20px",marginBottom:"32x"}}):"":null,r,n&&y.a.createElement("div",{style:{marginTop:r?"":"34px"},className:"info-message"},n),!this.passwordInvalid&&(this.state.reviewPhoneNum?y.a.createElement(Na,{ISOCode:Ra.getIsoCodeFromCountryCode(this.state.countryCode),phoneNumber:this.state.phoneNumber}):y.a.createElement(Mt.a,{ref:e=>this._phoneInput=e,onKeyPress:this._onInputType,inputRef:e=>{e&&this.newStep&&!this.verifyType&&(e.focus(),this.newStep=!1)},value:this.state.phoneNumber,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode,onChange:this._handlePhoneNumberChange,phoneNumber:this.state.phoneNumber,borderBottomOnly:!0})),i,a,this.state.errorMessage?y.a.createElement("div",{className:"error-message",style:{minHeight:"40px"}},this.state.errorMessage):null,u,y.a.createElement("div",{className:"flx-1"}),y.a.createElement(t,{fgPage:!1}))}else if(this.state.step===Ga){let a=null;switch(this.verifyType){case"ZALO":a=y.a.createElement(ue.a,{textKey:"STR_VERIFY_ZALO",className:"reg-active-code-desc",tagName:"div"});break;case"SMS":a=y.a.createElement("div",{className:"reg-active-code-desc"},y.a.createElement(ue.a,{textKey:"STR_VERIFY_ACCOUNT_DESC"})," ",y.a.createElement("span",{className:"act-phone-num"},"(+",this.state.countryCode,") ",this.state.phoneNumber));break;case"VOICE":a=y.a.createElement(ue.a,{textKey:"STR_VERIFY_CALL",className:"reg-active-code-desc",tagName:"div"});break;default:a=y.a.createElement("div",{className:"reg-active-code-desc"},this.state.infoMessage)}const n=this._canSubmitValidateActiveCode();e=y.a.createElement("div",{className:"login-pass reg-padding flx flx-1 flx-col flx-al-c"},y.a.createElement("img",{src:fe.a,className:"sign-in-logo"}),y.a.createElement(ue.a,{textKey:"STR_VERIFY_ACCOUNT",tagName:"div",className:"register-title"}),this.passwordInvalid?y.a.createElement("img",{src:_a,style:{marginTop:"20px",marginBottom:"12px"}}):"",a,y.a.createElement("div",{className:"error-message",style:{marginBottom:"0",marginTop:"16px"}},this.state.errorMessage),y.a.createElement("div",{className:"z-input w100",id:"regActiveCode",onClick:()=>{this.activeCodeRef&&this.activeCodeRef.focus()}},y.a.createElement("input",{required:!0,ref:e=>{e&&this.newStep&&(e.focus(),this.newStep=!1),this.activeCodeRef=e},disabled:this.state.blockSubmitOTP,name:"activecode",className:"active-code-v2",type:"text",onKeyDown:this._onInputType,onChange:e=>{var t;this.setState({activeCode:(null===(t=e.target)||void 0===t?void 0:t.value)||"",errorMessage:null})},placeholder:K.default.str("STR_ACTIVATION_CODE"),maxLength:6})),y.a.createElement(Ge.a,{textKey:"STR_CONTINUE",size:"large",onClick:this._validateActiveCode,disabled:!n||this.state.blocking,style:{marginTop:"28px",width:"100%"},loading:this.state.blocking}),this.state.cooldown>0&&y.a.createElement("div",{style:{color:"var(--text-primary)"},className:"reg-act-resend-spacing"},y.a.createElement(ue.a,{textKey:"STR_ACTIVATION_CODE_TEXT",style:{marginRight:"5px"}}),this.state.cooldown,y.a.createElement(ue.a,{textKey:"STR_SECOND",style:{marginLeft:"5px"}}),"."),!this.rateLimited&&!this.state.cooldown&&y.a.createElement(y.a.Fragment,null,y.a.createElement(ue.a,{textKey:"STR_NOT_RECEIVE_ACTIVE_CODE",className:"reg-active-code-desc reg-act-resend-spacing"}),y.a.createElement(Ge.a,{textKey:"STR_RESEND_CODE",onClick:this._confirmGetActiveCode,type:"tertiary-primary",icon:"outline-reload",className:"reg-act-resend-spacing",disabled:this.state.blocking})),y.a.createElement("div",{className:"flx-1"}),y.a.createElement(t,{fgPage:!1}))}else if(this.state.step===qa){const t={userData:{phone:this.state.phoneNumber,token:this.authToken,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode},questionData:this.state.questionData};e=y.a.createElement(fa,{data:t,dispatch:this.props.dispatch,onAnswerSuccess:this.onAnswerSeqSuccess,onBack:this.onBackToLoginPassword,onBackToPhoneValidation:this.onBackToPhoneValidation})}else this.state.step===ja&&(e=y.a.createElement("div",{className:"login-pass reg-padding flx flx-1 flx-col flx-al-c register-page"},y.a.createElement("img",{src:fe.a,className:"sign-in-logo"}),y.a.createElement(ue.a,{textKey:3===this.state.activeType?"STR_UPDATE_LOGIN_PASSWORD":"STR_CREATE_LOGIN_PASSWORD",tagName:"div",className:"register-title"}),y.a.createElement("div",{style:{marginTop:"12px"}},y.a.createElement(ue.a,{textKey:"STR_NOTE",className:"bold"})," ",y.a.createElement(ue.a,{textKey:"STR_CREATE_NEW_PW_DESCRIPTION",className:"info-message"})),y.a.createElement(da.a,{textKey:"STR_NEW_PASSWORD",inputRef:e=>this.pwRef=e,domRef:this.pwRef,className:"w100 flx-init",style:{marginTop:"20px"},onChange:this.onInputChangePW.bind(this),onKeyPress:e=>{13===(null==e?void 0:e.which)&&(this._onChangePassword(),e.stopPropagation())}}),y.a.createElement(da.a,{textKey:"STR_CONFIRM_NEW_PASSWORD",inputRef:e=>this.repeatPwRef=e,domRef:this.repeatPwRef,className:"w100 flx-init",style:{marginTop:"16px"},onChange:this.onInputChangePW.bind(this),onKeyPress:e=>{13===(null==e?void 0:e.which)&&(this._onChangePassword(),e.stopPropagation())},compareValue:this.state.newPassword}),this.state.errorMessage?y.a.createElement("div",{className:"error-message",style:{marginBottom:"0",marginTop:"16px"}},this.state.errorMessage):null,y.a.createElement(Ge.a,{size:"large",textKey:"STR_CONFIRM",onClick:this._onChangePassword.bind(this),disabled:!this.state.enableChangePW||this.state.blocking,style:o,loading:this.state.blocking,title:this.passwordCheckingMsg}),y.a.createElement("div",{className:"flx-1"}),y.a.createElement(t,{fgPage:this.state.activeType!==Re.ACTIVE_TYPE_REGISTER})));return e}}var Va=Wa,Ha=a("qhFK"),Xa=a("bsME"),Ya=a("h0sc");const Za={windowId:b.c,name:"LOGIN_PW_POPUP"};class Ja extends y.a.Component{constructor(e){super(e),this.resetErrorMessage=()=>{this._showErrorMessage("")},this.dispatch=e.dispatch,this.visibleComponentName=this.props.visibleComponentName,this.timeoutAutoReqCapcha=null;let t=e.recentdata,a={phoneNumber:e.state.phoneNumber,countryCode:e.state.countryCode,countryIsoCode:"VN",selectCountry:!1,avatar:null,timeout:0,confirmTimeout:0,showCaptcha:!1,enableRequestLogin:e.state.phoneNumber&&e.state.phoneNumber.length>=6,showRequestLoginTooltip:e.state.phoneNumber&&e.state.phoneNumber.length>=6,enablePasswordLogin:!1,showPopupLogin:!1,isRemember:e.isRemember,enableRetry:!1,showLoading:!1,blocking:!1,menuShown:!1};t&&(a.phoneNumber=t.phone,a.avatar=t.avatar,a.displayName=t.displayName,a.countryIsoCode=t.iso,a.countryCode=t.code,a.avatar&&(a.enableRequestLogin=!0,a.showRequestLoginTooltip=!0)),this.state=a,this.toFocus="phone",this.isLoginSuccess=!1,this.countLoginFail=0,this.getLoginCaptcha=this._getLoginCaptcha.bind(this),this._signIn=this._signIn.bind(this),this._onTypeCaptcha=this._onTypeCaptcha.bind(this),this._handlePhoneNumberChange=this._handlePhoneNumberChange.bind(this),this._handlePasswordChange=this._handlePasswordChange.bind(this),this._handleBackButtonClick=this._handleBackButtonClick.bind(this),this._handleCaptchaChange=this._handleCaptchaChange.bind(this)}componentWillMount(){this.state.avatar||this._getLoginCaptcha()}componentWillReceiveProps(e){if(this.props.state.phoneNumber!==e.state.phoneNumber&&this.setState({phoneNumber:e.state.phoneNumber}),this.props.recentdata!==e.recentdata&&this.props.recentdata&&!e.recentdata){const t={avatar:null,enablePasswordLogin:!1,enableRetry:!1,isRemember:e.isRemember};this._requireCaptcha?(t.showCaptcha=!0,t.showRequestLoginTooltip=!0,t.enableRequestLogin=!0):(t.showCaptcha=!1,t.phoneNumber="",t.countryIsoCode="VN",t.countryCode=84,t.showRequestLoginTooltip=!1,t.enableRequestLogin=!1),this.setState(t),this._getLoginCaptcha(),this.toFocus="phone",this._password&&(this._password.value="",this.setState({enablePasswordLogin:!1}))}else!this.props.isVisible&&e.isVisible?this._getLoginCaptcha():e!==this.props.isRemember&&this.setState({isRemember:e.isRemember})}componentDidMount(){Ya.ModalManagerV2.addModal(Za),Ya.ModalManagerV2.subscribeTriggers(Object(N.a)(Object(N.a)({},Za),{},{trigger:e=>{this.setState({showPopupLogin:e})}})),K.default.callUpdate(this.resetErrorMessage),this.setFocus()}componentWillUpdate(e){e.state.captchaToken||this.state.avatar||this._getLoginCaptcha()}componentDidUpdate(e){this.props.state.captchaImg!==e.state.captchaImg&&this._captcha&&document.activeElement!==this._captcha&&(this._captcha.value="")}componentWillUnmount(){Ya.ModalManagerV2.delModal(Za),K.default.removeUpdate(this.resetErrorMessage)}get Logger(){return this._Logger||(this._Logger=s.ModuleContainer.resolve(h.ZLoggerFactory).createZLogger("login",["login-pwd"])),this._Logger}_successLogin(){this.isLoginSuccess=!0,xt()}_failLogin(e){2==this.countLoginFail?(this.countLoginFail=0,Ya.ModalManagerV2.openModal(Object(N.a)(Object(N.a)({},Za),{},{params:!0}))):this.countLoginFail++;let t=K.default.str("STR_SIGNIN_ERROR_INCORRECT_INFO"),a=!1;if("ERR_CONNECTION_TIMED_OUT"===e.error_code||"ERR_CONNECTION_TIMED_OUT"===e||"ERR_CONNECTION_TIMED_OUT"===e.code)t=K.default.str("STR_COMPOSE_TIP_69");else if(e.error_code){let n=ma(e,this.state);n&&(t=n),a=18029===e.error_code,18017===e.error_code&&this._password&&(this._password.value="",this.setState({enablePasswordLogin:!1}))}this._showErrorMessage(t),this._getLoginCaptcha(!0),ea(ta.LOGIN_STEP_INPUT_INVALID_PHONE_PASS),a&&this.props.signInAnother&&(this._requireCaptcha=!0,this.props.signInAnother(!1),this.setState({showCaptcha:!0}))}_showErrorMessage(e){this.dispatch({type:kt,payload:e})}_signIn(){const e=()=>{setTimeout((()=>{this.setState({blocking:!1})}),300)},t=G.default.getInstance();this.setState({blocking:!0},(()=>{"activeElement"in document&&document.activeElement.blur();const a=Date.now();if(this.lastSignIn&&a-this.lastSignIn<700)return void e();this.lastSignIn=a;const n=!this._captcha||!this._captcha.value;if(!this.state.phoneNumber){this.toFocus="phone",this._showErrorMessage(K.default.str("STR_SIGNIN_ERROR_EMPTY_PHONE"));let t=ta.LOGIN_STEP_INPUT_EMPTY_INFO_PASS+"_Phone";return(!this._password.value||!this.state.avatar&&n)&&(this._password.value||this.state.avatar||!n?this._password.value?t+="Cap":t+="Pass":t+="AllEmpty"),ea(t),void e()}if(!this._password.value){this.toFocus="password",this._showErrorMessage(K.default.str("STR_SIGNIN_ERROR_EMPTY_PASSWORD"));let e=ta.LOGIN_STEP_INPUT_EMPTY_INFO_PASS+"_Pass";return n&&(e+="Cap"),void ea(e)}if(!this.state.avatar&&n)return this.toFocus="captcha",this._showErrorMessage(K.default.str("STR_SIGNIN_ERROR_EMPTY_CAPTCHA")),ea(ta.LOGIN_STEP_INPUT_EMPTY_INFO_PASS+"_Cap"),void e();let o=ve.default;const s=ct.default.authDomain;ea(ta.LOGIN_STEP_LOGIN_PASS),o.loginWithPassword(this.state.phoneNumber,this._password.value,this.state.avatar?"":this._captcha?this._captcha.value:"",this.props.state.captchaToken,ve.default.getZaloClientID(),0,null,{code:this.state.countryCode,iso:this.state.countryIsoCode}).then((()=>{t.removeItem("FORGOT_PASSWORD"),setTimeout((()=>{Xa.a.onSucess()}),0),this._successLogin()})).catch((a=>{if(this.Logger.zsymb(21,"PV4ql6",["signIn failed {}","CYXehS"],a&&(a.error_code||a.code)||a),a){if("ERR_NO_NETWORK"===a.code)return setTimeout((()=>{Xa.a.onError("ERR_NO_NETWORK",s)}),0),this._showErrorMessage(K.default.str("STR_SIGNIN_ERROR_NO_NETWORK")),void e();if(a.error_code&&a.error_code===Le.a.SECURITY_QUESTION_REQUIRED&&a.data)setTimeout((()=>{Xa.a.onSucess()}),0),this.Logger.zsymb(3,"Lfszpz",["re security {}","QUKXu_"],a),a.data.cptch_cert&&t.setItem("captcha_cert",a.data.cptch_cert),this.dispatch({type:Dt,payload:{phone:this.state.phoneNumber,password:this._password?this._password.value:"",captcha:a.data.cptch_cert?null:this._captcha?this._captcha.value:"",captchaToken:a.data.cptch_cert?null:this.props.state.captchaToken,questionData:a.data,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode,eCode:a.error_code}});else if(a.error_code&&a.error_code===Le.a.PASSWORD_NOT_SET){setTimeout((()=>{Xa.a.onSucess()}),0);let e=this.state.phoneNumber;a.data&&a.data.display_name&&(e=String(a.data.display_name)),this.lastVisibleLoginComponentName=this.visibleComponentName,this.dispatch({type:Bt,payload:{phone:this.state.phoneNumber,captcha:this._captcha?this._captcha.value:"",captchaToken:this.props.state.captchaToken,passwordInvalid:!0,activeType:3,displayName:e,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode}})}else if(!a.error_code||a.error_code!==Le.a.OUT_OF_SECQ_QUOTA&&a.error_code!==Le.a.OUT_OF_SECQ_2_STEP_QUOTA)if(!a.error_code||a.error_code!==Le.a.SENSITIVE_FLOW_REQUIRE_OTP_OR_CONFIRM_MOBILE&&a.error_code!==Le.a.SENSITIVE_FLOW_REQUIRE_OTP)this._isRecycleSimOrChangedPhone(a)||this._failLogin(a);else{const e=a.data.cptch_cert?null:this.props.state.captchaToken,t=a.data.cptch_cert?null:this._captcha?this._captcha.value:"";this.props.dispatch({type:Zt,payload:{phone:this.state.phoneNumber,password:this._password?this._password.value:"",captchaAnswer:t,captchaToken:e,questionData:a.data,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode,eCode:a.error_code}})}else{const e=Object(ha.a)(a),t={};e.data&&(t.data=e.data),e.errorMessageLocalize&&(t.errorMessage=ma(e)),this.props.dispatch({type:Qt,payload:t})}}e()}))}))}_getLoginCaptcha(e=!1){this.props.isVisible&&ea(ta.LOGIN_STEP_GET_CAPTCHA_PASS);const t=e=>{(e||this.props.isMaybeReq&&this.props.isMaybeReq(this.visibleComponentName)&&!this.timeoutAutoReqCapcha)&&(this.Logger.zsymb(3,"R4Iv0u",["req capcha login","37kjLg"]),e&&this.timeoutAutoReqCapcha&&(clearTimeout(this.timeoutAutoReqCapcha),this.timeoutAutoReqCapcha=null),Ne.default.getLoginCaptcha(ve.default.getZaloClientID()).then((e=>{if(0==e.data.error_code)return this.props.isVisible&&ea(ta.LOGIN_STEP_READY_LOGIN_PASS),this.isLoginSuccess||(this.timeoutAutoReqCapcha=setTimeout((()=>{this.timeoutAutoReqCapcha=null,t()}),1e3*e.data.data.expiration_time)),this.dispatch({type:Gt,payload:e});this.props.isVisible&&ea(ta.LOGIN_STEP_ENTER_LOGIN_PASS)})).catch((e=>{this.props.isVisible&&ea(ta.LOGIN_STEP_ENTER_LOGIN_PASS),this.Logger.zsymb(21,"uXuy7f",["getLoginCaptcha error {}","Xq3_2V"],e&&(e.error_code||e.code)||e)})))};t(e)}_toggleClass(e,t){e&&(e.className.indexOf(t)>=0?e.className=e.className.replace(t,""):e.className+=" "+t)}_handlePhoneNumberChange(e){this.setState({countryCode:e.countryCode,countryIsoCode:e.countryIsoCode,phoneNumber:e.phoneNumber,enableRequestLogin:e.phoneNumber.length>=6,showRequestLoginTooltip:e.phoneNumber.length>=6&&(!this._password||this._password.value.length<6),enablePasswordLogin:e.phoneNumber.length>=6&&this._password&&this._password.value.length>=3&&this._captcha&&this._captcha.value.length>=1,enableRetry:e.phoneNumber.length>=6&&this._captcha&&this._captcha.value.length>=1}),this._showErrorMessage(null)}_handlePasswordChange(e){const t={showRequestLoginTooltip:this.state.phoneNumber.length>=6&&e.target.value.length<6,enablePasswordLogin:this.state.phoneNumber.length>=6&&e.target.value.length>=3};this.state.avatar||(t.enablePasswordLogin=t.enablePasswordLogin&&this._captcha&&this._captcha.value.length>=1,t.showCaptcha=e.target.value.length>0),this.setState(t),this._showErrorMessage(null)}_handleCaptchaChange(e){this.setState({enablePasswordLogin:this.state.phoneNumber.length>=6&&this._password&&this._password.value.length>=3&&e.target.value.length>=1,enableRetry:e.target.value.length>=1}),this._showErrorMessage(null)}_onTypeCaptcha(e){13==e.which&&(this.state.enablePasswordLogin&&this._signIn(),e.preventDefault())}_handleBackButtonClick(){this._showErrorMessage(null),this.setState({showCaptcha:!1,enableRequestLogin:this.state.phoneNumber.length>=6}),this.confirmTimer&&(clearInterval(this.confirmTimer),this.confirmTimer=null),this.timer&&(clearTimeout(this.timer),this.timer=null)}runConfirmTimer(){this.confirmTimer=setInterval((()=>{let e=this.state.confirmTimeout-1;e<=0?(this.confirmTimer&&(clearInterval(this.confirmTimer),this.confirmTimer=null),this._getLoginCaptcha(!0),this.toFocus="captcha"):this.setState({confirmTimeout:e})}),1e3)}_isRecycleSimOrChangedPhone(e){let t=!1;return e&&e.error_code&&([18041,18042,18043].includes(e.error_code)?(t=!0,this._showErrorMessage(e.error_message_localize?e.error_message_localize:K.default.str("STR_SIGNIN_ERROR_RECYCLE_SIM"))):18044==e.error_code&&(t=!0,this._showErrorMessage(e.error_message_localize?e.error_message_localize:K.default.str("STR_SIGNIN_ERROR_CHANGED_NUMPHONE")),this.props.signInAnother&&this.props.signInAnother(!1))),t}_renderCaptchaSection(){let e=null,t=null;return t=y.a.createElement("div",{className:"z-input flx-1"},y.a.createElement(Qe.a,{id:"captcha-txt",required:!0,textKey:"STR_INPUT_CAPTCHA",className:"login-pass__group__captcha",onKeyPress:this._onTypeCaptcha,onChange:this._handleCaptchaChange,type:"text",onFocus:()=>this.toFocus="captcha",inputRef:e=>{this._captcha=e},maxLength:"100",title:""})),e=y.a.createElement("div",{id:"captcha",className:"login-pass__captcha flx flx-center flx-al-c"},y.a.createElement("img",{src:this.props.state.captchaImg,alt:"captcha"}),y.a.createElement(Ge.a,{icon:"outline-reload",onClick:this._getLoginCaptcha.bind(this,!0),type:"tertiary-neutral",size:"large"})),y.a.createElement("div",{className:"login-pass__group flx captcha-section"},t,e)}_onClosePopupLogin(){Ya.ModalManagerV2.closeModal(Za)}_checkRemember(){this.props.checkRemember&&this.props.checkRemember(!this.state.isRemember),this.setState({isRemember:!this.state.isRemember})}onSignUp(){this.props.onSignUp&&this.props.onSignUp()}onShowOtherOptions(){this.otherOptionsMenuRef&&this.otherOptionsMenuRef.show(null,this.otherOptionsRef)}showMobileLoginChecking(){this.props.signInWithMobileRequest&&this.props.signInWithMobileRequest()}setFocus(){this._password&&("password"===this.toFocus||this.state.avatar)?this._password.focus():this._phoneInput&&this._phoneInput.focus()}render(){let e,t,a,n=null,o=null,s=null,r=null,i=null;n=y.a.createElement(da.a,{id:"password-txt",title:"STR_INPUT_PASSWORD_REQUEST",textKey:"STR_PASSWORD",onFocus:e=>this.toFocus="password",inputRef:e=>{this._password=e},domRef:this._password,onKeyPress:this._onTypeCaptcha,onChange:this._handlePasswordChange,"data-id":"txt_Login_Psw"}),s=y.a.createElement(ue.a,{textKey:"STR_SIGNIN_FORGET",tagName:"div",onClick:()=>this.props.onForgotPasswordClick(this.state.phoneNumber,this.state.countryIsoCode,this.state.countryCode),className:"signin-forget-pw signin-mid-container "+(this.state.blocking?" disabled":"")});let c=[{textKey:"STR_SIGNIN_BY_MOBILE",onclick:this.showMobileLoginChecking.bind(this)}];this.state.avatar&&c.push({textKey:"STR_SIGNIN_OTHER",onclick:()=>this.props.signInAnother(!0)}),r=c.length?y.a.createElement(Ge.a,{size:"medium",textKey:c.length>1?"STR_OPTHER_OPTIONS":c[0].textKey,ref:e=>this.otherOptionsRef=e,onClick:c.length>1?this.onShowOtherOptions.bind(this):c[0].onclick,className:"footer-btn",type:"tertiary-neutral",disabled:this.state.blocking,isActive:this.state.menuShown}):null,i=c.length>1?y.a.createElement(it.default,{popoverProps:{identity:{windowId:b.c,name:Re.PopoverIdentitiesDefine.LOGIN_PASSWORD},anchorEl:this.otherOptionsRef},ref:e=>this.otherOptionsMenuRef=e,items:[{textKey:"STR_SIGNIN_BY_MOBILE",onclick:this.showMobileLoginChecking.bind(this)},this.state.avatar?{textKey:"STR_SIGNIN_OTHER",onclick:()=>this.props.signInAnother(!0)}:null].filter((e=>!!e)),onShow:()=>{this.setState({menuShown:!0})},onClose:()=>{this.setState({menuShown:!1})}}):null,a=1==this.props.configOptionRemember?y.a.createElement("p",{className:"login-page__main-bottom",style:{paddingLeft:"14px",width:"170px"},onClick:this._checkRemember.bind(this)},y.a.createElement("i",{className:"clickable"+(this.state.isRemember?" fa fa-fill-checkbox-square":" fa fa-uncheckbox-square"),style:{color:"var(--text-information)",fontSize:"var(--f14)",cursor:"pointer",position:"relative",top:"2px"}}),y.a.createElement(ue.a,{className:"clickable",textKey:"STR_REMEMBER_SESSION",style:{paddingLeft:"6px"}})):null,e=this.state.avatar?y.a.createElement("div",{className:"flx flx-col flx-al-c flx-1"},y.a.createElement(_e.d,{size:"xxl",target:{avatar:this.state.avatar,displayName:this.state.displayName}}),y.a.createElement(he.a,{className:"login-pass__recent__name truncate"},this.state.displayName)):y.a.createElement(Mt.a,{idElementInputPhone:"usrID-txt",idElementSelectCountry:"country-txt",onKeyPress:this._onTypeCaptcha,onFocus:()=>{this.toFocus="phone"},inputRef:e=>{this._phoneInput=e},value:this.state.phoneNumber,countryCode:this.state.countryCode,countryIsoCode:this.state.countryIsoCode,onChange:this._handlePhoneNumberChange,phoneNumber:this.state.phoneNumber,borderBottomOnly:!0,"data-id":"txt_Login_Phone"}),this.state.showCaptcha&&(o=this._renderCaptchaSection());let l=y.a.createElement(Ge.a,{textKey:"STR_SIGNIN",onClick:this._signIn,disabled:!this.state.enablePasswordLogin||this.state.blocking,className:"wi signin-btn",size:"large",loading:this.state.blocking,"data-id":"btn_Login_LoginwPsw"});return this.state.showPopupLogin&&Ya.ModalManagerV2.isVisible(Za)&&(t=y.a.createElement(Ya.default,{visible:!0,title:y.a.createElement(ue.a,{textKey:"STR_REQUEST_LOGIN"}),styleTitle:{fontSize:"var(--f14)",fontWeight:"var(--semibold)"},className:"no-padding",border:"no-border",showCloseButton:!0,onCancel:this._onClosePopupLogin.bind(this),width:"350px",footer:{confirm:{textKey:"STR_SIGNIN_REQUEST_LOGIN_TOOLTIP",click:()=>{this._onClosePopupLogin(),this.showMobileLoginChecking()},disabled:!this.state.enableRequestLogin},cancel:{textKey:"STR_POPUP_SIGNIN_QR",click:()=>{this._onClosePopupLogin(),this.props.dispatch({type:Qt})},disabled:!this.state.enablePasswordLogin},direction:"col"}},y.a.createElement("div",{className:"flx"},y.a.createElement("div",{className:"login-pass",style:{width:"100%",padding:"16px"}},y.a.createElement("div",{style:{marginBottom:"4px"}},y.a.createElement(ue.a,{textKey:"STR_POPUP_LOGIN_WITHOUT_PW"})))))),y.a.createElement("div",{className:"flx flx-col flx-1 h100 login-container-in-tabs "+(this.state.avatar?" comeback":""),style:this.props.innerState?{padding:"0 16px"}:null},y.a.createElement("div",{className:"login-pass"},e,n,null,o,a,t,y.a.createElement("div",{className:"error-message"+(this.props.state.loginFail&&this.props.state.errorMessage?" ":" hidden"),style:{marginBottom:"0"}},this.props.state.loginFail&&this.props.state.errorMessage)),y.a.createElement("div",{className:"login-pass flx flx-col flx-1"},l,l&&null,null,y.a.createElement("div",{className:"flx flx-col flx-1"},s,y.a.createElement("div",{className:"flx-1"}),r,i),null))}}var $a=Ja,en=a("97kL"),tn=a("Iawr"),an=a("gwig"),nn=a("PoHQ");const on=["tabOffset","tabs","onChange","tabOnly"];function sn(e){let{tabOffset:t=0,tabs:a=[],onChange:n=null,tabOnly:o=null}=e;Object(S.a)(e,on);const[s,r]=y.a.useState(t);y.a.useEffect((()=>{r(t)}),[t]);let i=null,c=[];var l;a&&a.length>0&&(null!=o?i=(null===(l=a[o])||void 0===l?void 0:l.domContent)||null:c=a.map(((e,t)=>{if(!e)return null;let{domContent:a,textKey:o=""}=e;return s===t&&(i=a),y.a.createElement("div",{className:"tab-container "+(t===s?"selected-tab":""),key:"tab_"+t,onClick:e=>function(e){r(e),n&&n(e)}(t)},y.a.createElement(ue.a,{textKey:o,tagName:"div"}))})));return y.a.createElement("div",{className:"tabs-container w100 h100 flx flx-col rel"},o?null:y.a.createElement("div",{className:"tabs-main flx flx-al-c"},c),y.a.createElement("div",{className:"flx-1 flx"},i))}var rn=function(e){const t=Object(p.useRef)(null);return Object(p.useEffect)((()=>{t.current&&t.current.focus()}),[]),y.a.createElement(Qe.a,{required:!0,textKey:"STR_INPUT_OTP_PLACEHOLDER",className:"otp-input",name:"captcha",maxLength:"6",inputRef:t,disabled:!!e.disabled,onChange:()=>{let a=t.current.value;e.onInputOTP&&e.onInputOTP(a)},onKeyPress:a=>{if("Enter"===a.key){let n=t.current&&t.current.value;return e.callSubmit(n),a.preventDefault(),void a.stopPropagation()}}})};var cn=function(e){const[t,a]=Object(p.useState)(0),n=Object(p.useRef)(null);return Object(p.useEffect)((()=>{if(t)return n.current=setTimeout((()=>{a(t-1)}),1e3),()=>clearTimeout(n.current)}),[t]),Object(p.useEffect)((()=>{a(e.timeout)}),[e.timeout,e.startCountdown]),y.a.createElement("div",{onClick:e.onClick,className:"resend-otp flx flx-center "+(t||!e.enable?"disable":"")},y.a.createElement(ue.a,{textKey:"STR_RESEND",className:"btn-link"}),t?y.a.createElement("span",{className:"btn-link"}," (",t,"s)"):y.a.createElement("div",{className:"btn-link flx flx-al-c"}," ",y.a.createElement(de.a,{className:"icon-outline-reload btn-link"})))};var ln=function(e){const{error:t}=e,a=Object(p.useRef)(null),[n,o]=Object(p.useState)(0);if(Object(p.useEffect)((()=>{if(e.error&&e.error.timeout){let n=e.error.timeout;t=n,clearInterval(a.current),a.current=null,o(t),a.current=setInterval((()=>{o(t--),0===t&&(clearInterval(a.current),a.current=null)}),1e3)}var t}),[e.error]),!t)return y.a.createElement("div",null);switch(t.eCode){case aa:return y.a.createElement("div",{className:"text-center request-login-info error"},y.a.createElement(ue.a,{tagName:"div",textKey:"STR_REMEMBER_LOGIN_REJECTED"}),y.a.createElement(ue.a,{tagName:"div",textKey:"STR_PLEASE_RETRY"}));case na:return y.a.createElement("div",{className:"text-center request-login-info error"},y.a.createElement(ue.a,{tagName:"div",textKey:"STR_REMEMBER_LOGIN_TIMEOUT"}));case oa:return y.a.createElement("div",{className:"error-message"},y.a.createElement(ue.a,{textKey:"STR_SIGNIN_ERROR_NO_NETWORK"}));case ra:return y.a.createElement("div",{className:"text-center request-login-info error"},y.a.createElement(ue.a,{textKey:"STR_REQUEST_TIMES_LIMIT",textArguments:[Math.floor(n/60),Math.round(n%60)]}));case ca:case la:return y.a.createElement("div",{className:"text-center request-login-info error"},y.a.createElement("span",null,t.eMessage));case ua:return y.a.createElement("div",{className:"text-center request-login-info error"},y.a.createElement(ue.a,{textKey:"STR_OTP_REQUEST_LIMIT"}));default:return y.a.createElement("div",{className:"text-center request-login-info error"},t.eMessage?y.a.createElement("span",null,t.eMessage):y.a.createElement(ue.a,{textKey:"STR_ERROR_OCCURED"}))}};var un=function(e){return y.a.createElement(Ge.a,{textKey:"STR_VERIFY",className:"wi signin-btn",size:"large",onClick:()=>{e.disable||e.onClick&&e.onClick()},disabled:e.disable,loading:e.blocking})};function dn(e){const t=Object(p.useRef)(null);Object(p.useEffect)((()=>{t.current&&t.current.focus()}),[]);return y.a.createElement("div",{className:"z-input",style:{flex:"1"}},y.a.createElement(Qe.a,{id:"captcha-txt",required:!0,textKey:"STR_INPUT_CAPTCHA",className:"login-pass__group__captcha",onKeyPress:a=>{if(13==a.which){let a=t.current.value;e.onSubmit&&e.onSubmit(a)}},onChange:()=>{let a=t.current.value;e.onInputCaptcha&&e.onInputCaptcha(a)},type:"text",inputRef:t,maxLength:"100"}))}var _n=function(e){const{className:t}=e;let a=null,n=null;n=y.a.createElement(dn,e);const o="data:image/png;base64,"+e.captcha.captcha_img;a=y.a.createElement("div",{id:"captcha",className:"login-pass__captcha"},y.a.createElement("img",{src:o,alt:"captcha"}),y.a.createElement("div",{className:"dib login-pass__captcha__refresh",style:{marginRight:"0"}},y.a.createElement("i",{className:"fa fa-reload btn",onClick:e.getLoginCaptcha})));const s=Object(V.a)("login-pass__group flx captcha-section",t);return y.a.createElement("div",{className:s},n,a)};const hn=s.ModuleContainer.resolve(h.ZLoggerFactory).createZLogger("login",["sensitive-login","opt-confirm"]),mn=new g.LocalId,gn={NONE:0,NORMAL:1,MANUAL_SMS:2};function pn(e){const{instructionText:t,lastData:a,screen:n}=e;let o;return o=n===gn.MANUAL_SMS?y.a.createElement(ue.a,{textKey:t}):y.a.createElement(y.a.Fragment,null,y.a.createElement(ue.a,{textKey:"STR_VERIFY_ACCOUNT_DESC"}),y.a.createElement("span",{className:"act-phone-num"}," (+",a.countryCode,")",a.phone&&a.phone.slice(1))),o}function yn(e){const{enableRetryOTP:t,otpCountdown:a,screen:n,startCountdown:o,resendOTP:s}=e;let r=null;return n===gn.NORMAL&&(r=y.a.createElement("div",{className:"flx resend-otp-container"},y.a.createElement(ue.a,{textKey:"STR_DONT_RECEIVE_OTP",tagName:"div"}),y.a.createElement(cn,{onClick:s,timeout:a,startCountdown:o,enable:t}))),r}var En=function(e){const t=Object(p.useRef)(null),[a,n]=(Object(p.useRef)(null),Object(p.useState)(!1)),[o,s]=Object(p.useState)(null),[r,i]=Object(p.useState)(null),[c,l]=Object(p.useState)(!1),[u,d]=Object(p.useState)(!1),[_,h]=Object(p.useState)(!0),[m,g]=Object(p.useState)(15),[E,f]=Object(p.useState)(!1),[S,T]=Object(p.useState)(""),[N,R]=Object(p.useState)({prev:-1,current:gn.NONE}),I=Object(p.useRef)(null),C=e.state&&e.state.pass,v=C&&C.lastData,[O,b]=Object(p.useState)(),A=Object(p.useRef)(),w=Object(p.useRef)(),P=y.a.useRef();Object(p.useEffect)((()=>{A.current=v.captchaToken?v.captchaToken:"",w.current=v.captchaAnswer?v.captchaAnswer:"",x();const e=()=>{s(null)};return K.default.callUpdate(e),()=>{K.default.removeUpdate(e)}}),[]);const M=(e,a)=>{const n=Object(ha.a)(e);let o=n.errorCode||sa,r=0;n.data&&n.data.time_left&&(r=n.data.time_left);let c="";switch(o){case ia:case ra:r=r||900,d(!0),t.current=setTimeout((()=>{d(!1),s(null)}),1e3*r);break;case ua:h(!1),g(0);break;case Le.a.REJECTED_OTP:if(N.current===gn.NORMAL){var l;if(s(null),null!==(l=n.data)&&void 0!==l&&l.manual_sms){var u;const e=null===(u=n.data)||void 0===u?void 0:u.manual_sms,t=e.error&&e.instruction&&`${e.error} ${e.instruction}`;t&&T(t)}}else{var _;if(null!==(_=n.data)&&void 0!==_&&_.manual_sms){var m;const e=null===(m=n.data)||void 0===m?void 0:m.manual_sms,t=e.hint&&e.instruction&&`${e.hint} ${e.instruction}`;t&&T(t)}N.current===gn.MANUAL_SMS&&s({eCode:o,eMessage:n.errorMessageLocalize||""})}return void L(gn.MANUAL_SMS);case Le.a.CAPTCHA_REQUIRED:{const e=n.data;e&&e.captcha&&U(e.captcha),c=n.errorMessageLocalize||"";break}case Le.a.INVALID_CAPTCHA:case Le.a.CAPTCHA_EXPIRED:case Le.a.CAPTCHA_RETRY_RATE_LIMIT_EXCEEDED:c=n.errorMessageLocalize||""}c?(i(c),s(null)):(i(null),s({eCode:o,timeout:r,eMessage:n.errorMessageLocalize||""}))},x=()=>{if(!_)return;n(!a);let e=ve.default.getZaloClientID(),t=v.countryIsoCode?v.countryIsoCode:"VN",o=v.phone;const s=mn.next();g(15),ve.default.sendLoginOTP(e,o,t,A.current,w.current).then((()=>{L(gn.NORMAL),mn.valid(s)})).catch((e=>{hn.zsymb(21,"WPPaAj",["get OTP error {}","9NDpaZ"],e&&(e.error_code||e.code)||e),M(e)}))},L=e=>{R({prev:N.current,current:e})},k=()=>{if(!c)return;s(null),f(!0);let t={question_type:"otp",answer_type:"otp",answers:I.current||""};ve.default.loginWithPassword(v.phone,v.password,w.current,A.current,ve.default.getZaloClientID(),1,t,{code:v.countryCode,iso:v.countryIsoCode}).then((()=>{e.successLogin()})).catch((e=>{f(!1),M(e)}))},D=()=>{P.current&&(clearTimeout(P.current),P.current=null)},U=(e,t=!0)=>{D(),b(e.captcha_img),A.current=e.token,t&&(P.current=setTimeout((()=>{G()}),1e3*e.expiration_time))},G=()=>{D(),ve.default.getCaptcha().then((e=>{const{data:t}=e;t&&U(t)})).catch((e=>{hn.zsymb(21,"twAPhZ",["callGetCaptcha {}","ZgpdJa"],e&&(e.error_code||e.code)||e)}))};return y.a.createElement("div",{className:"sensitive-login-container"},y.a.createElement("div",{className:"sensitive-login"},y.a.createElement("div",{className:"sensitive-login-title"},y.a.createElement(ue.a,{textKey:"STR_VERIFY_ACCOUNT"})),y.a.createElement("div",{className:"sensitive-login-desc"},y.a.createElement(pn,{instructionText:S,screen:N.current,lastData:v})),y.a.createElement(ln,{error:o}),y.a.createElement(rn,{callSubmit:k,onInputOTP:e=>{I.current=e,l(!!I.current)},disabled:u}),y.a.createElement("div",{className:"otp-separater"}),O?y.a.createElement(_n,{className:"mt-16",captcha:{captcha_img:O},onInputCaptcha:e=>{w.current=e},getLoginCaptcha:()=>{G()}}):null,r?y.a.createElement("div",{className:"mt-8"},y.a.createElement(ue.a,{className:"f12 error",textKey:r})):null,y.a.createElement(un,{onClick:k,disable:!c||E||u,blocking:E}),y.a.createElement(yn,{enableRetryOTP:_,otpCountdown:m,screen:N.current,startCountdown:a,resendOTP:x})))};var fn=function(e){const[t,a]=Object(p.useState)(e.timeout),n=Object(p.useRef)(null);return Object(p.useEffect)((()=>{if(t)return n.current=setTimeout((()=>{a(t-1)}),1e3),()=>clearTimeout(n.current)}),[t]),Object(p.useEffect)((()=>{a(e.timeout)}),[e.timeout]),y.a.createElement("div",null,t?y.a.createElement(ue.a,{className:"mobile-confirm-countdown",textKey:"STR_REQUEST_LOGIN_PENDING",textArguments:[t,t>1?"s":""]}):y.a.createElement(Ge.a,{textKey:e.textKey||"STR_RETRY",onClick:()=>{t||e.disable||e.onClick&&e.onClick()},className:"wi signin-btn",size:"large",disabled:e.disable||e.blocking,loading:e.blocking}))};const Sn=new g.LocalId;var Tn=function(e){const t=y.a.useRef(null),a=y.a.useRef(null),n=y.a.useRef(null),[o,s]=Object(p.useState)(30),[r,i]=Object(p.useState)(null),[c,l]=Object(p.useState)(null),[u,d]=Object(p.useState)(!1),[_,h]=Object(p.useState)(!1),m=e.state.pass&&e.state.pass.lastData||{};Object(p.useEffect)((()=>{f();const e=()=>{l(null)};return K.default.callUpdate(e),()=>{clearTimeout(a.current),clearTimeout(n.current),K.default.removeUpdate(e)}}),[]);const E=()=>{a.current&&(clearTimeout(a.current),s(0),a.current=null),i({});const e=()=>{Ne.default.getLoginCaptcha(ve.default.getZaloClientID()).then((t=>{t.data&&0==t.data.error_code&&t.data.data?(i(t.data.data),a.current=setTimeout((()=>{a.current=null,s(0),e()}),1e3*t.data.data.expiration_time)):i({})})).catch((e=>{g.default.error("_getLoginCaptcha error ",e&&(e.error_code||e.code)||e)}))};e()},f=()=>{const a=Date.now();t.current&&a-t.current<700||(h(!0),t.current=a,ve.default.loginWithPopup(m.phone,m.countryIsoCode,r?r.token:null,u||null).then((t=>{i(null),d(null),l(null),s(30);const a=Sn.next();ve.default.awaitQRConfirm(t.url,t.timeout).then((()=>{Sn.valid(a)?e.successLogin():g.default.error("request-login: invalid request id")})).catch((e=>{h(!1),s(0),Sn.valid(a)?(18010==e?l({eCode:aa}):-10==e?l({eCode:na}):e&&e.code&&("ERR_NO_NETWORK"===e.code||"ERR_CONNECTION_TIMED_OUT"===e.code)?l({eCode:oa}):l({eCode:sa}),E()):g.default.error("request-login: invalid request id")}))})).catch((e=>{if(h(!1),g.default.error("request login popup error",e&&(e.error_code||e.code)||e),e)if(e.error_code===ra){let t=900;e.data&&e.data.time_left&&(t=e.data.time_left),l({eCode:ra,timeout:t,eMessage:""}),n.current=setTimeout((()=>{l(null),s(0)}),1e3*t)}else e.error_code===ca?(l({eCode:e.error_code,timeout:0,eMessage:e.error_message_localize||""}),i(e.data),s(0)):(l({eCode:e.error_code,timeout:0,eMessage:e.error_message_localize||""}),E(),s(0));else l({eCode:sa,timeout:0,eMessage:""}),E()})))};return y.a.createElement("div",{className:"sensitive-login-container"},y.a.createElement("div",{className:"sensitive-login"},y.a.createElement("div",{className:"sensitive-login-title"},y.a.createElement(ue.a,{textKey:"STR_VERIFY_ACCOUNT"})),y.a.createElement("div",{className:"sensitive-login-desc"},y.a.createElement(ue.a,{textKey:c&&c.eCode===ca?"STR_LOGIN_WAITING_REQ_CAPT":"STR_REMEMBER_LOGIN_WAITING"})),y.a.createElement(ln,{error:c}),r?y.a.createElement(_n,{getLoginCaptcha:E,captcha:r,onInputCaptcha:e=>{d(e)},onSubmit:f}):null,y.a.createElement(fn,{onClick:f,timeout:o,disable:!u||!r||!r.captcha_img,blocking:_,textKey:c&&c.eCode===ca?"STR_CONFIRM":""})))};const Nn=!1;class Rn extends y.a.Component{constructor(e){super(e),this._successLogin=()=>{xt()},this._useOTP=()=>{this.setState({method:2})},this._useAnotherWay=()=>{let e=2;2===this.state.method&&(e=1),this.setState({method:e})},this._back=()=>{this.props.dispatch({type:Yt})},this.state={method:"otp"===e.defaultOption?2:1},this.lastSignIn=null}render(){let e=null,t=this.state.method;return 1===t?e=y.a.createElement(Tn,{state:this.props.state,successLogin:this._successLogin}):2===t&&(e=y.a.createElement(En,{state:this.props.state,successLogin:this._successLogin})),y.a.createElement("div",{style:{height:"100%",position:"relative"}},e,y.a.createElement("div",{className:"sensitive-login-footer"},y.a.createElement("div",{className:"try-another-way"},y.a.createElement(ue.a,{textKey:"STR_TRY_ANOTHER_WAY"}),y.a.createElement(ue.a,{textKey:1===t?"STR_SEND_OTP":"STR_SEND_MOBILE_CONFIRM",tagName:"a",onClick:this._useAnotherWay,className:"btn-link try-another-btn"})),y.a.createElement("div",{className:"back-btn"},y.a.createElement(ue.a,{textKey:"STR_BACK",onClick:this._back}))))}}var In=Rn;const Cn=["onBack","data","error","state","onSuccess","onError"],vn=new g.LocalId;function On(e){let{onBack:t,data:a=null,error:n=null,state:o=null,onSuccess:s=null,onError:r=null}=e,i=Object(S.a)(e,Cn);const[c,l]=y.a.useState((null==a?void 0:a.phone)||""),[u,d]=y.a.useState((null==a?void 0:a.code)||84),[_,h]=y.a.useState((null==a?void 0:a.iso)||"VN"),[m,g]=y.a.useState(null),[p,E]=y.a.useState(null),[f,T]=y.a.useState(!1),[R,I]=y.a.useState(-1),[C,v]=y.a.useState(!1),[O,b]=y.a.useState(!1),A=y.a.useRef(null),w=y.a.useRef(null),P=y.a.useRef(null);function M(){c&&(L(),D())}function x(e){P.current&&(clearTimeout(P.current),P.current=null),P.current=setTimeout((()=>{let t=e-1;t<0?I(-1):x(t)}),1e3),I(e)}function L(){P.current&&(clearTimeout(P.current),P.current=null),I(-1),E(null),v(!1)}function k(e,t){const a=Object(ha.a)(e);if(0===a.errorCode)return;const n=function(e){if(e.errorCode===Le.a.REQUIRE_LOGIN_QR){const t={};if(e.data&&(t.data=e.data),e.errorMessageLocalize&&(t.errorMessage=e.errorMessageLocalize),"function"==typeof i.dispatch)return i.dispatch({type:Qt,payload:t}),!0}return!1}(a);var o;n||(E(a),a?function(e){let t=!1;return e&&e.error_code&&([18041,18042,18043].includes(e.error_code)?(t=!0,E(e.error_message_localize?e.error_message_localize:K.default.str("STR_SIGNIN_ERROR_RECYCLE_SIM"))):18044==e.error_code&&(t=!0,E(e.error_message_localize?e.error_message_localize:K.default.str("STR_SIGNIN_ERROR_CHANGED_NUMPHONE")))),t}(e)||(a.errorCode===Le.a.CAPTCHA_REQUIRED?a.data.captcha_img&&g({captcha_img:"data:image/png;base64,"+a.data.captcha_img,token:null===(o=a.data)||void 0===o?void 0:o.token}):"ERR_NO_NETWORK"!==a.code&&"ERR_CONNECTION_TIMED_OUT"!==a.code||(setTimeout((()=>{const{originUrl:e}=t||{};Xa.a.onError(a.code,e)}),0),E(K.default.str("STR_SIGNIN_ERROR_NO_NETWORK")))):E(K.default.str("STR_ERROR_OCCURED")))}function D(){if(!f)return T(!0),new Promise(((e,t)=>{var a;if(f)return t("blocking_state");const n=ct.default.authDomain;ve.default.loginWithPopup(c,_,null!=m&&m.token?m.token:null,null!=m&&m.token?null==A||null===(a=A.current)||void 0===a?void 0:a.value:null).then((a=>{T(!1);let{url:o,timeout:s}=a;x(s);const r=vn.next();ve.default.awaitQRConfirm(o,s).then((n=>{if(!vn.valid(r))return t();L(),xt(),e(a)})).catch((e=>{if(!vn.valid(r))return t(e);if(L(),18010===e)E(K.default.str("STR_REMEMBER_LOGIN_REJECTED"));else if(-10===e)v(!0),m&&q();else{let t=K.default.str("STR_ERROR_OCCURED");e&&e.code&&("ERR_NO_NETWORK"===e.code||"ERR_CONNECTION_TIMED_OUT"===e.code)&&(t=K.default.str("STR_SIGNIN_ERROR_NO_NETWORK"),i.dispatch({type:Gt,payload:{data:e}}),setTimeout((()=>{Xa.a.onError(e.code,n)}),0),E(t))}t(e)}))})).catch((e=>{L(),T(!1);k(e,{originUrl:n}),t(e)}))}))}function U(e){13==e.which&&(D(),e.preventDefault())}function G(){E(null),v(!1),j()}function q(){const e=()=>{w.current&&(clearTimeout(w.current),w.current=null),Ne.default.getLoginCaptcha(ve.default.getZaloClientID()).then((t=>{0==t.data.error_code&&(w.current=setTimeout((()=>{w.current=null,e()}),1e3*t.data.data.expiration_time),i.dispatch({type:Gt,payload:t}))})).catch((e=>{}))};e()}function j(e){var t;(e||(e={phoneNum:c}),null!=m&&m.token)&&(e=Object(N.a)(Object(N.a)({},e),{},{captcha:(null==A||null===(t=A.current)||void 0===t?void 0:t.value)||""}));let{phoneNum:a,captcha:n}=e;b(!(!a||f||!n&&void 0!==n))}return y.a.useEffect((()=>{j()}),[]),y.a.useEffect((()=>{o.captchaToken?null!=m&&m.token&&o.captchaToken!==(null==m?void 0:m.token)&&g({token:o.captchaToken,captcha_img:o.captchaImg}):q()}),[o]),y.a.useEffect((()=>{p&&q()}),[p]),y.a.createElement("div",{className:"flx flx-col flx-1 login-padding mobile-login-page"},i.noNetworkUI||null,y.a.createElement("img",{src:fe.a,className:"sign-in-logo"}),y.a.createElement(ue.a,{textKey:"STR_MOBILE_LOGIN",className:"sigin-title"}),y.a.createElement(ue.a,{textKey:"STR_MOBILE_GUIDE",className:"register-desc"}),y.a.createElement(Mt.a,{onChange:function(e){let t=e.phoneNumber;l(t),d(e.countryCode),h(e.countryIsoCode),E(null),j({phoneNum:t})},value:c,countryCode:u,countryIsoCode:_,phoneNumber:c,onKeyPress:e=>{13===(null==e?void 0:e.which)&&M()}}),function(){if(R>=0)return R<=0?null:y.a.createElement(y.a.Fragment,null,y.a.createElement(ue.a,{textKey:"STR_REMEMBER_LOGIN_WAITING",tagName:"div",className:"mobile-login-subdesc"}),y.a.createElement(ue.a,{textKey:"STR_REQUEST_LOGIN_PENDING",tagName:"div",className:"mobile-login-countdown",textArguments:[R,R>1?"s":""]}));if(null==m||!m.token)return null;let e=null,t=null;t=y.a.createElement("div",{className:"z-input flx-1"},y.a.createElement(Qe.a,{id:"captcha-txt",required:!0,textKey:"STR_INPUT_CAPTCHA",className:"login-pass__group__captcha",onKeyPress:U,onChange:G,type:"text",inputRef:A,maxLength:"100",title:""}));let{captcha_img:a}=m;return e=y.a.createElement("div",{id:"captcha",className:"login-pass__captcha flx flx-center flx-al-c"},y.a.createElement("img",{src:a,alt:"captcha"}),y.a.createElement(Ge.a,{icon:"outline-reload",onClick:q,type:"tertiary-neutral",size:"large"})),y.a.createElement("div",{className:"login-pass__group flx captcha-section"},t,e)}(),function(){let e=null;return C?e=y.a.createElement(y.a.Fragment,null,y.a.createElement(ue.a,{textKey:"STR_REMEMBER_LOGIN_TIMEOUT",tagName:"div"})):p&&(p.constructor===Object?e=ma(p):p.constructor===String&&(e=p)),e?y.a.createElement("div",{className:"error-message",style:{marginBottom:0}},e):null}(),R>-1?null:y.a.createElement(Ge.a,{textKey:p?"STR_RETRY":"STR_CONTINUE",onClick:M,className:"wi sign-in-waiting-retry-btn",size:"large",disabled:!O||f,loading:f}),y.a.createElement(Ge.a,{type:"tertiary-neutral",size:"medium",textKey:"STR_BACK",onClick:t,className:"footer-btn",disabled:f}))}const bn=0,An=1;function wn(){const[e,t]=y.a.useState(bn);function a(){setTimeout((()=>{t(An)}),12e4)}return y.a.useEffect((()=>{a()}),[]),e===bn?y.a.createElement("div",{className:"flx flx-al-c flx-center no-network-banner"},y.a.createElement(de.a,{className:"outline-disconnect"}),y.a.createElement(ue.a,{tagName:"div",textKey:"STR_INFO_NO_NETWORK"})):y.a.createElement("div",{className:"login-pass reg-padding flx flx-1 flx-col flx-al-c no-network-page"},y.a.createElement("img",{src:fe.a,className:"sign-in-logo"}),y.a.createElement(de.a,{className:"icon-disconnect no-network-icon"}),y.a.createElement(ue.a,{textKey:"STR_CANT_CONNECT_1",tagName:"div",className:"no-network-title"}),y.a.createElement(ue.a,{textKey:"STR_CANT_CONNECT_3",tagName:"div",className:"no-network-desc"}),y.a.createElement("div",{className:"flx-1"}),y.a.createElement(Ge.a,{type:"tertiary-neutral",size:"medium",textKey:"STR_BACK_TO_LOGIN",onClick:function(){t(bn),a()}}))}var Pn=a("Nd7d"),Mn=a("AtyM"),xn=a("Uqjx"),Ln=a("rkiK"),kn=a("/n5c");let Dn=0;function Un(e){let{qrcodeImg:t,onClose:a}=e;function n(){a&&a()}return y.a.createElement("div",{className:"qr-guide",onClick:n},y.a.createElement("div",{className:"qr-guide__content",onClick:e=>{e.preventDefault(),e.stopPropagation()}},y.a.createElement("img",{src:fe.a,className:"sign-in-logo"}),y.a.createElement(ue.a,{textKey:"STR_SCAN_QR_GUIDE",tagName:"div",className:"sigin-title"}),y.a.createElement("img",{src:t,className:"qr-guide__img"}),y.a.createElement("div",{className:"qr-guide__steps"},y.a.createElement("div",{className:"v-line"+(K.default.currentLanguage()===Re.LANG_INDEX_EN?" eng":"")}),y.a.createElement("div",{className:"flx flx-al-c step-line first-line"},y.a.createElement("div",{className:"num"},"1"),y.a.createElement(ue.a,{textKey:"STR_QR_GUIDE_LINE1",tagName:"div",className:"desc"})),y.a.createElement("div",{className:"flx flx-al-c step-line"},y.a.createElement("div",{className:"num"},"2"),y.a.createElement("div",{className:"flx flx-al-c desc line-2"},y.a.createElement(ue.a,{textKey:"STR_QR_GUIDE_LINE2_1",tagName:"div"}),y.a.createElement("i",{className:"fa fa-qrcode-icon",style:{fontSize:"var(--f24)",marginLeft:"5px",marginRight:"5px"}}),y.a.createElement(ue.a,{textKey:"STR_QR_GUIDE_LINE2_2",tagName:"div"}))),y.a.createElement("div",{className:"flx flx-al-c step-line"},y.a.createElement("div",{className:"num"},"3"),y.a.createElement(ue.a,{textKey:"STR_QR_GUIDE_LINE3",tagName:"div",className:"desc"}))),y.a.createElement(Ge.a,{textKey:"STR_CLOSE",type:"tertiary-neutral",onClick:n,style:{marginTop:"24px"},size:"medium",className:"footer-btn"})))}const Gn=991;class qn extends y.a.Component{constructor(e){super(e),this._getQRCode=this._getQRCode.bind(this),this.tryLoadQR=this.tryLoadQR.bind(this),this.dispatch=e.dispatch,this.state={isRemember:e.isRemember,showGuide:!1,menuShown:!1,didloadqr:!1};{const e=async()=>{await s.ModuleContainer.resolve(kn.a).tryFlushAll(),await $zFileManager.cleanupLogFileDescriptors(),$zsub.$zwindow.removeListenUnloadZLog(e)};$zsub.$zwindow.onUnloadZLog(e)}}componentWillReceiveProps(e){e.state.qrTimeout&&e.state.qrTimeout>Date.now()&&!this.timer&&this.triggerUIBlockLoadQR(e.state.qrTimeout)}componentWillMount(){this.props.state.qrTimeout&&this.props.state.qrTimeout>Date.now()?this.triggerUIBlockLoadQR(this.props.state.qrTimeout):this.tryLoadQR()}componentWillUnmount(){this.timer&&(clearTimeout(this.timer),this.timer=null)}get Logger(){return this._Logger||(this._Logger=s.ModuleContainer.resolve(h.ZLoggerFactory).createZLogger("pc",["loginqr"])),this._Logger}triggerUIBlockLoadQR(e){if(e&&e>Date.now())return this.setState({timeout:Math.max(e-Date.now(),0)}),this._startTimer(),void(this.overQRRequest=!0)}tryLoadQR(e=!1){var t;e&&this._getQRCode(),18012===this.props.state.qrErrorCode&&(null===(t=this.props.state)||void 0===t?void 0:t.qrTimeout)>Date.now()||this.props.state.qrcodeImg&&!this.props.state.qrExpired||this._getQRCode()}_signalQRExpired(e){this.dispatch({type:$t,payload:{isExpired:e}})}_doWaitScanQR(e){setTimeout((()=>{Xa.a.onSucess()}),0),this._signalQRExpired(!1),this.dispatch({type:jt,payload:""}),this.dispatch({type:qt,payload:e});let t=ve.default;this.props.isVisible&&ea(ta.LOGIN_STEP_WAITING_SCAN);let a=91059,n=Date.now(),o=Mn.a.now();t.awaitQRScan(e.data.chk_wait_scan,e.data.qr_timeout,e.data.qr_retry).then((s=>(this.dispatch({type:Wt,payload:{currentDisplayName:s.display_name,currentAvatar:s.avatar}}),this.dispatch({type:Qt}),ea(ta.LOGIN_STEP_WAITING_CONFIRM),w.default.increaseSuccess(a,0,Mn.a.now()-o),a=91060,n=Date.now(),o=Mn.a.now(),t.awaitQRConfirm(e.data.chk_wait_cfirm,e.data.qr_timeout,e.data.qr_retry)))).then((()=>{w.default.increaseSuccess(a,0,Mn.a.now()-o),xt()})).catch((t=>{this.dispatch({type:Wt,payload:{currentDisplayName:"",currentAvatar:""}});let s="number"==typeof t?t:-1;if(t&&"object"==typeof t){if(-20==t.error_code)return this.Logger.zsymb(0,"ZWtJi5","gen qrcode token 2"),void this._doWaitScanQR(Object(N.a)(Object(N.a)({},t),{},{data:Object(N.a)(Object(N.a)({},e.data),t.data)}));t.error_code}18010==t?(this.dispatch({type:jt,payload:K.default.str("STR_REMEMBER_LOGIN_REJECTED")}),this._signalQRExpired(!0)):(-10==t?this.Logger.zsymb(21,"Xopo_K",["qr timeout {}","yEE6Br"],t):this.Logger.zsymb(21,"8C-iWQ",["login fail {}","qmiTb5"],t),this.dispatch({type:jt,payload:K.default.str("STR_QR_EXPIRED")}),this._signalQRExpired(!0)),w.default.increaseFailed(a,0,Mn.a.now()-o,s,n)}))}_startTimer(){this.timer||(this.timer=setInterval((()=>{const e=this.state.timeout-1e3;e<=0?(Dn=0,this.overQRRequest=!1,this.setState({timeout:0}),this.dispatch({type:jt,qrErrorCode:Gn}),this.timer&&(clearInterval(this.timer),this.timer=null)):this.setState({timeout:e})}),1e3))}_getQRCode(){if(this.overQRRequest)return;this.props.isVisible&&ea(ta.LOGIN_STEP_GET_QR),this.setState({timeout:0}),this.timer&&(clearTimeout(this.timer),this.timer=null);let e=qe.a.getUidLogin();const t=ct.default.authDomain,a=(e=!1)=>{const t=()=>{this.setState({didloadqr:!e})};e?t():setTimeout((()=>{t()}),2e3)};a(!0);const n=e=>{this.overQRRequest=!0,setTimeout((()=>{Xa.a.onSucess()}),0);let t=12e4;e&&e.data.data&&e.data.data.time_left&&(t=e.data.data.time_left),this.Logger.zsymb(0,"8C6b_4","Over hit QR, pending: ",t),this.dispatch({type:jt,payload:K.default.str("STR_QR_ERROR_REQUEST_LIMIT"),qrErrorCode:18012,qrTimeout:Date.now()+t}),this._signalQRExpired(!0),this.setState({timeout:t,didloadqr:!0}),this._startTimer()};Dn>3?n():Ne.default.getQRCode(ve.default.getZaloClientID(),e,K.default.getCurrentLanguageName()).then((e=>{if(this.Logger.zsymb(3,"FjKtxi",["axios getQRCode","6SDL4A"]),e.data.data&&0===e.data.error_code)return this._doWaitScanQR(e.data);if(e.data&&18012==e.data.error_code)n(e);else{if(e.request&&e.request.responseURL)try{let a=new URL(e.request.responseURL),n=new URL(t);a&&n&&a.origin&&n.origin&&a.origin!==n.origin&&setTimeout((()=>{Xa.a.onError(e.status,t,e.request.responseURL)}),0)}catch(a){}else e&&e.status&&setTimeout((()=>{Xa.a.onError(e.status,t,!1,200!==e.status)}),0);this.dispatch({type:jt,payload:K.default.str("STR_QR_ERROR_UNKNOWN")+(e.data&&e.data.error_code?` (${e.data.error_code})`:"")})}this.Logger.zsymb(18,"eyg8uM",e.data.error_message)})).catch((e=>{var n;this.Logger.zsymb(21,"a0YCKD",["getQRCode error {}","U3D7f4"],e),a(),this.dispatch({type:jt,payload:-10===e?"":111===(null==e||null===(n=e.data)||void 0===n?void 0:n.error_code)?K.default.str("STR_TOAST_CONNECTION_FAILED"):K.default.str("STR_ERROR_OCCURED")}),!e||"ERR_NO_NETWORK"!==e.code&&"ERR_CONNECTION_TIMED_OUT"!==e.code||setTimeout((()=>{Xa.a.onError(e.code,t)}),0)}))}_showTips(){this.dispatch({type:Ft})}_hideTips(){this.dispatch({type:zt})}_checkRemember(){this.props.checkRemember&&this.props.checkRemember(!this.state.isRemember),this.setState({isRemember:!this.state.isRemember})}onShowOtherOptionsMenu(e){this.otherOptionsMenuRef&&this.otherOptionsMenuRef.show(e,this.otherOptionsRef)}getQRLoadingUI(){return this.state.didloadqr?null:y.a.createElement(y.a.Fragment,null,y.a.createElement(Pn.a,{size:27,version:3}),y.a.createElement(ue.a,{textKey:"STR_LOADING",tagName:"div",className:"margin-top-8"}))}getQRIntroduction(e={}){const{qrData:t}=e;if(t&&t.introduction){let e=t.introduction.formatted;const a=t.introduction.localized;if("string"==typeof e&&Array.isArray(a)){const t=K.default.getCurrentLanguageName();for(let n=0;n<a.length;n++){const o=a[n];if(o){const a=o[t.toLowerCase()];a&&(e=e.replace(`$${n}$`,a))}}return y.a.createElement(xn.a,{className:"mt-16 mb-8",config:{ALLOWED_ATTR:["class"]},html:e})}}return y.a.createElement(ue.a,{textKey:"STR_QR_GUIDE",className:"qr-guide-title"})}getContentOCR(){return y.a.createElement("div",{id:"qrcode-ocr"},y.a.createElement(ue.a,{className:"ocr-highlight",textKey:"STR_OCR_BLUE"}),y.a.createElement(ue.a,{textKey:"STR_OCR_BLACK"}))}render(){let e=null;const t=this.props.state;let a=t.qrErrorMessage;if(18012===t.qrErrorCode&&this.state.timeout){const e=Math.floor(this.state.timeout/60/1e3),t=Math.round(this.state.timeout/1e3%60);a=y.a.createElement("span",null,K.default.trans("STR_QR_ERROR_REQUEST_LIMIT_WOTIME")," ",0!==e?`${e} ${K.default.trans("STR_MIN")} `:"",`${t} ${K.default.trans(t>1?"STR_SECONDS":"STR_SECOND")}`)}let n=null;const{currentAvatar:o,currentDisplayName:s}=t;o&&s&&(n=y.a.createElement("div",{className:"qr-ava-overlay flx flx-al-c flx-col"},y.a.createElement("img",{src:o,className:"qr-ava"}),y.a.createElement(he.a,{className:"qr-name truncate"},s),y.a.createElement(ue.a,{textKey:"STR_QR_AWAIT_DESC",tagName:"div",className:"qr-desc"})));const r=this.overQRRequest||t.qrNeedsRefresh&&(a||t.qrErrorCode);this.props.onSignInOther;return e=y.a.createElement("div",{id:"qrcode",className:"flx flx-col flx-al-c h100 "+(t.qrNeedsRefresh?" disabled":"")},n||y.a.createElement("div",{id:"qrcode-container",className:ct.default.login.qr_v2?"qr-v2":""},y.a.createElement("img",{id:"qrcode-img",className:Object(V.a)(t.qrNeedsRefresh?" disabled":"",ct.default.login.qr_v2?"qr-v2":""),src:t.qrcodeImg,style:t.qrNeedsRefresh&&a?{opacity:this.qrErrorFromLoad?0:.9}:null,onLoad:()=>{this.qrErrorFromLoad=!1,this.setState({didloadqr:!0})},onError:()=>{this.qrErrorFromLoad=!0,setTimeout((()=>{this.setState({didloadqr:!0})}),2e3)}}),r||!this.state.didloadqr?y.a.createElement("div",{id:"qrcode-expired",className:"qrcode-expired fadeInAndOut",onClick:()=>{this.overQRRequest||(Dn++,this.props.dispatch({type:Qt}),setTimeout((()=>{this._getQRCode()}),0))}},y.a.createElement("div",{className:"flx flx-col flx-center flx-al-c qr-reload-container fadeInAndOut"+(this.overQRRequest?" not-allowed":this.state.didloadqr?"":" hover-default")},r?y.a.createElement(y.a.Fragment,null,y.a.createElement(de.a,{className:this.overQRRequest?"icon-outline-report":"outline-reload"}),y.a.createElement(ue.a,{textKey:this.overQRRequest?"STR_QR_LIMIT_REACHED":"STR_CLICK_TO_RETRY",className:"reload-title"})):this.getQRLoadingUI())):null,ct.default.login.ocr_text?this.getContentOCR():null),a&&this.state.didloadqr?y.a.createElement("div",{className:"error-message"},a):null,n?null:y.a.createElement(y.a.Fragment,null,this.getQRIntroduction(t),y.a.createElement("div",{className:"flx flx-al-c dark-href",onClick:()=>{this.setState({showGuide:!0})}},y.a.createElement(ue.a,{textKey:"STR_SIGNIN_QR_GUIDE"}))),y.a.createElement(Ge.a,{size:"medium",textKey:"STR_SIGNIN_BY_MOBILE",ref:e=>this.otherOptionsRef=e,onClick:this.props.onSignInOther,className:"footer-btn",type:"tertiary-neutral"}),this.state.showGuide&&y.a.createElement(Un,{qrcodeImg:t.qrcodeImg,onClose:()=>{this.setState({showGuide:!1})}})),y.a.createElement("div",{className:"login-qr h100"},e)}}class jn extends y.a.Component{constructor(e){super(e),this.dispatch=e.dispatch,this.activeType=1,this.accessToken=null,this._onLoginSuccess=this._onLoginSuccess.bind(this),this.isMaybeReq=this.isMaybeReq.bind(this),this._isFocus=!0,this._onVisiblityChanged=(e,t)=>{switch(t){case"blur":document.body.className=document.body.className.replace(" active",""),this._isFocus=!1;break;case"focus":document.body.className.indexOf("active")<0&&(document.body.className+=" active"),!this._isFocus&&this.LoginPassword?(this._isFocus=!0,this.LoginPassword.getLoginCaptcha()):this._isFocus=!0}},this.state={recentdata:ve.default.getMostRecentLoggedInData(),configOptRemember:this.getConfigOptionRemember(),languageSelection:K.default.currentLanguage(),isMenuShow:!1,innerLoginPwState:0,refresh:!1,showNoNetwork:!window.navigator.onLine},K.default.loadDBLanguage(),this.pendingReq=!1,nn.p.listenEvent(nn.k,(e=>{this.pendingReq&&e==an.a.CONNECTED&&(this.pendingReq=!1,this.getServerConfig())})),g.default.checkNetwork((e=>{this.setState({showNoNetwork:!e})})),this.setConfigOptionRememberWhenLoginSuccess(this.state.configOptRemember),this.initStateRemember(),this._checkRemember=this._checkRemember.bind(this),this.showMenu=(e,t)=>{this.menu&&this.menu.show(e,t)},this.refresh=()=>{this.setState({refresh:!this.state.refresh})}}componentWillReceiveProps(e){this.props.state.common.visibleComponentName!==e.state.common.visibleComponentName&&("LOGIN_QR"===e.state.common.visibleComponentName?this.lastTabIndex=0:"LOGIN_PASSWORD"===e.state.common.visibleComponentName&&(this.lastTabIndex=1))}initStateRemember(){this.state.isRemember=this.state.configOptRemember!==Re.OPTION_SHOW_CHECKBOX||!this.state.recentdata||!g.default.valueValid(this.state.recentdata.isRemember)||this.state.recentdata.isRemember,this.lastTabIndex=this.getLastLoginTab(),ve.default.setValueRememberLogin(this.state.isRemember)}getConfigOptionRemember(){let e=G.default.getInstance().getItem(Re.KEY_CONFIG_OPTION_REMEMBER);return g.default.valueValid(e)||(e=Re.OPTION_DEFAULT_REMEMBER,this._needUpdateStateRemember=!0),"number"!=typeof e&&(e="string"==typeof e?parseInt(e):Re.OPTION_DEFAULT_REMEMBER),(e>2||e<0)&&(e=Re.OPTION_DEFAULT_REMEMBER),e}setConfigOptionRememberWhenLoginSuccess(e){G.default.getInstance().setItem(Re.KEY_CONFIG_NEW_REMEMBER,e)}isMaybeReq(e){return this._isFocus&&this.props.state.common.visibleComponentName===e}_onGetImei(){return{imei:ve.default.getZaloClientID(),installerType:"unknown",autoUpdaterConfig:ct.default.auto_updater}}_loginPass(){this.dispatch({type:Kt}),ea(ta.LOGIN_STEP_ENTER_LOGIN_PASS)}componentDidMount(){Ha.a.isDone()||Ha.a.init(),$zsub.$zapp.onClickNoti(this.focusMainWindow),$zresource.onRequestImei(this._onGetImei),an.b.getStateNetwork()==an.a.DISCONNECT?this.pendingReq=!0:setTimeout((()=>{this.getServerConfig()}),100),this.updateLanguage=()=>{this.setState({languageSelection:K.default.currentLanguage()})},K.default.callUpdate(this.updateLanguage),Ln.default.cancel(Ln.MetricName.start_up_time)}componentWillUnmount(){$zsub.$zwindow.removeListenVisibilityChange(this._onVisiblityChanged),$zresource.removeListenRequestImei(this._onGetImei),$zsub.$zapp.removeListenClickNoti(this.focusMainWindow),K.default.removeUpdate(this.updateLanguage)}get Logger(){return this._Logger||(this._Logger=s.ModuleContainer.resolve(h.ZLoggerFactory).createZLogger("main",["login"])),this._Logger}getServerConfig(){this.timeoutReq&&(clearTimeout(this.timeoutReq),this.timeoutReq=null),this.pendingReq=!1;const e=e=>{const t=G.default.getInstance();if(e.config_option_remember){let a=e.config_option_remember;["number","string"].includes(typeof a)&&("string"==typeof a&&(a=parseInt(a)),!isNaN(a)&&a>=0&&a<=2&&(t.setItem(Re.KEY_CONFIG_OPTION_REMEMBER,a),this._needUpdateStateRemember&&(this.setConfigOptionRememberWhenLoginSuccess(a),this.setState({configOptRemember:a}),this._needUpdateStateRemember=!1)))}if(e.sentry_config){a("2ua2").default.saveSentryConfig(e.sentry_config)}e.auto_relaunch_mode&&e.auto_relaunch_timeout,t.checkExist("l-lg-t")||(this.lastTabIndex=e.default_login_method||0,this.refresh()),this.checkHasNewMsg(e.prelogin_operate)};let t=D.b.getServerConfig();t.already_fetch_server_info_first_time?t&&e(t):D.b.getServerInfo().then((()=>{t=D.b.getServerConfig(),t&&e(t)}))}checkHasNewMsg(e){if(!e||!e.is_enable)return;if(!ve.default.getLastViewKey(ve.default.getLastUserId()))return void this.Logger.zsymb(3,"GpC8z-",["hasNewMsg no viewerkey","JJ-Bvu"]);const t=e.req_configs.timeline,a=this.checkHasNewMsgTimes||0;if(a<t.length){const n=t[a],o=60;setTimeout((()=>{ve.default.hasNewMsg().then((t=>{this.Logger.zsymb(3,"Cu57ys",["hasNewMsg result {}","DVgkU2"],t),this.setHasNewMsg(t,e.toast_notify),this.checkHasNewMsg(e)}))}),n*o*1e3+Math.floor(Math.random()*e.req_configs.extra_time)*o*1e3)}this.checkHasNewMsgTimes=a+1}focusMainWindow(){$zwindow.focus();let e=null;switch(this.checkHasNewMsgTimes||0){case 1:e=1900201;break;case 2:e=1900202;break;case 3:e=1900203;break;case 4:e=1900204}e&&(A.default.logAction(e),A.default._log())}setHasNewMsg(e,t){if(e){const e=t&&t[K.default.getCurrentLanguageName()]?t[K.default.getCurrentLanguageName()]:t.vi,a={leftButtonText:e&&e.button_content?e.button_content:K.default.str("STR_VIEWMORE"),leftFunc:"focusMainWindow",rightButtonText:null,rightFunc:null,size:{w:324,h:80},eventOnClose:!0};tn.a.createNotify(e&&e.title?e.title:K.default.str("STR_NEW_MESSAGE_LONG"),"",t&&t.icon?t.icon:"https://chat.zalo.me/favicon-96x96.v1.png",null,null,!1,2,a),A.default.logAction(19001),A.default._log()}$zapp.updateBadgeCount(0)}_toggleRegister(e){this.activeType=1,e?this.state.recentdata?this.props.dispatch({type:Ht,payload:{title:K.default.str("STR_ZALO_CONFIRM_TITLE"),message:K.default.str("STR_CONFIRM_CANCEL_LOGIN_FOR_REGISTRATION"),compact:!0,confirmText:K.default.str("STR_YES"),cancelText:K.default.str("STR_NO"),callback:e=>{this.props.dispatch({type:Ht}),e&&(ve.default.setMostRecentLoggedInUserInfo(null),ve.default.removeLastViewKey(),ve.default.setLastUserId(null),this.setState({recentdata:null}),this.dispatch({type:Bt}))}}}):this.dispatch({type:Bt}):this.props.state.pass.security?this.props.dispatch({type:kt,payload:""}):this.dispatch({type:this.lastTabIndex?Kt:Qt})}_toggleForgotPassword(e,t,a){this.activeType=3,this.defaultPhoneNumber=e,this.defaultCountryIsoCode=t,this.defaultCountryCode=a,this.dispatch({type:Bt})}_onLoginSuccess(){xt().then(this.flushZLogMemory)}_signInAnother(e){this.Logger.zsymb(3,"5F7Ej-",["sign in as another user","TnRfcS"]),this.props.dispatch({type:Yt}),e&&this.state.recentdata?this.props.dispatch({type:Ht,payload:{title:"Zalo",message:K.default.str("STR_SIGNIN_CONFIRM_ANOTHER_ACCOUNT"),compact:!0,confirmText:K.default.str("STR_YES"),cancelText:K.default.str("STR_NO"),callback:e=>{this.props.dispatch({type:Ht}),e&&(ve.default.clearLastSignin(),this.setState({recentdata:null}),this._checkRemember(!0,!1))}}}):(ve.default.setMostRecentLoggedInUserInfo(null),ve.default.setLastUserId(null),this.setState({recentdata:null}),this._checkRemember(!0,!1))}_checkRemember(e,t=!0){ve.default.setValueRememberLogin(e),t&&ve.default.setValueActionLogRemember(e?117066:117067),this.setState({isRemember:e})}onShowMenu(e){this.showMenu(e,this.menuBtn)}closeMenu(){this.menu&&this.menu.close()}onChangeLanguage(e){K.default.changeToLang(e),this.setState({languageSelection:e}),$zapp.changeLanguage(e),this.closeMenu()}onOpenAbout(){this.props.dispatch&&this.props.dispatch({type:en.PopupActions.TOGGLE_APP_INFO}),this.closeMenu()}onOpenDevTools(){this.closeMenu()}changeAdminConfig(e){let t=!!ct.default.adminConfig[e];if(ct.default.adminConfig[e]=!t,this.forceUpdate(),"onStagingDevAuth"===e)Pt.b.onStagingDevAuth=!0,Object(ct.ChangeToDevDomain)("authDomain");else if("removeImei"===e)try{G.default.getInstance().removeItem("z_uuid")}catch(a){}}getAdminConfigs(){return[]}setLastLoginTab(e){G.default.getInstance().setItem("l-lg-t",e)}getLastLoginTab(){let e=G.default.getInstance().getItem("l-lg-t");return e=e?JSON.parse(e):1,e}onPwChangeView(e){this.props.onChangeView&&this.props.onChangeView(e),this.setState({innerLoginPwState:e})}_renderSecurityAuth(){const e=this.props.state.pass.lastData;switch(e.eCode){case Le.a.SECURITY_QUESTION_REQUIRED:case Le.a.PASSWORD_NOT_SET:return y.a.createElement(Ea,{data:e,dispatch:this.props.dispatch,onBack:()=>this._toggleRegister(!1),onLoginSuccess:this._onLoginSuccess});case Le.a.SENSITIVE_FLOW_REQUIRE_OTP_OR_CONFIRM_MOBILE:case Le.a.SENSITIVE_FLOW_REQUIRE_OTP:{let t="confirm_mobile";return e.questionData&&e.questionData.default_option?t=e.questionData.default_option:e.eCode===Le.a.SENSITIVE_FLOW_REQUIRE_OTP&&(t="otp"),y.a.createElement(In,{dispatch:this.props.dispatch,defaultOption:t,state:this.props.state})}default:return null}}loginWithMobileRequest(){this.props.dispatch({type:Jt}),setTimeout((()=>{this._signInAnother(!1)}),1e3)}render(){let e;const t="REGISTER"===this.props.state.common.visibleComponentName;let a="MOBILE_LOGIN"===this.props.state.common.visibleComponentName,n=!(!t||!this.props.state.common.lastData||void 0===this.props.state.common.lastData.answerSecurityFail)&&this.props.state.common.lastData.answerSecurityFail,o=y.a.createElement(wn,null);const s=e=>{let t=`:flag-${e}:`;return y.a.createElement("span",{className:"emoji-sizer emoji-outer ",style:(a=t,{background:`url(${ct.default.emojiImg})`,backgroundSize:"6500%",backgroundPosition:ct.default.emojiMapPos[a],WebkitUserDrag:"none",marginLeft:"5px",verticalAlign:"text-bottom",height:"18px"})});var a};if(this.props.state.pass.security)e=y.a.createElement("div",{id:"loginPageMain",className:" login-page__content__container h100 login-padding flx flx-col "},y.a.createElement("img",{src:fe.a,className:"sign-in-logo"}),this._renderSecurityAuth());else if(t){this.props.state.common.lastData&&this.props.state.common.lastData.activeType&&(this.activeType=this.props.state.common.lastData.activeType);let t=this.props.state.common.lastData&&this.props.state.common.lastData.verifyType?this.props.state.common.lastData.verifyType:null,a=this.props.state.common.lastData&&this.props.state.common.lastData.quotaInfo?this.props.state.common.lastData.quotaInfo:[];e=y.a.createElement("div",{className:"flx flx-center flx-1 h0"},y.a.createElement(Va,{dispatch:this.props.dispatch,activeType:this.activeType,accessToken:this.accessToken,lastData:this.props.state.common.lastData,phoneNumber:this.defaultPhoneNumber,countryIsoCode:this.defaultCountryIsoCode,countryCode:this.defaultCountryCode,answerSecurityFail:n,verifyType:t,verifyTypes:a,onLogin:()=>this._toggleRegister(!1)}))}else if(a)e=y.a.createElement(On,{data:this.LoginPassword?{phone:this.LoginPassword.state.phoneNumber,iso:this.LoginPassword.state.countryIsoCode,code:this.LoginPassword.state.countryCode}:this.state.recentdata,state:this.props.state.pass,dispatch:this.props.dispatch,onBack:()=>{this.props.dispatch(this.lastTabIndex?{type:Kt,payload:{errorMessage:""}}:{type:Qt})}});else{let t=y.a.createElement($a,{ref:e=>this.LoginPassword=e,state:this.props.state.pass,recentdata:this.state.recentdata,isVisible:"LOGIN_PASSWORD"===this.props.state.common.visibleComponentName,dispatch:this.props.dispatch,onForgotPasswordClick:(...e)=>this._toggleForgotPassword(...e),visibleComponentName:this.props.state.common.visibleComponentName,signInAnother:this._signInAnother.bind(this),signInWithMobileRequest:this.loginWithMobileRequest.bind(this),isMaybeReq:this.isMaybeReq,checkRemember:this._checkRemember,configOptionRemember:this.state.configOptRemember,isRemember:this.state.isRemember,onSignUp:()=>this._toggleRegister(!0),onChangeView:this.onPwChangeView.bind(this),innerState:this.state.innerLoginPwState}),a="STR_LOGIN_ACCOUNT";e=y.a.createElement("div",{id:"loginPageMain",className:" login-page__content__container h100 login-padding flx flx-col "},y.a.createElement("img",{src:fe.a,className:"sign-in-logo"}),y.a.createElement(ue.a,{textKey:a,className:"sigin-title",tagName:"div"}),y.a.createElement(sn,{onChange:e=>{this.lastTabIndex!=e&&(this.lastTabIndex=e,this.setLastLoginTab(e),this.setState({initialState:0},(()=>{0===e?this.props.dispatch({type:Qt}):1===e&&this.props.dispatch({type:Kt,payload:{errorMessage:""}})})))},tabOnly:this.state.innerLoginPwState?1:null,tabOffset:void 0!==this.lastTabIndex&&null!==this.lastTabIndex?this.lastTabIndex:1,tabs:[{textKey:"STR_SIGNIN_QR",domContent:y.a.createElement(qn,{state:this.props.state.qr,ref:e=>this.LoginQR=e,isVisible:"LOGIN_QR"===this.props.state.common.visibleComponentName,dispatch:this.props.dispatch,checkRemember:this._checkRemember,configOptionRemember:this.state.configOptRemember,recentdata:this.state.recentdata,isRemember:this.state.isRemember,onSignUp:()=>this._toggleRegister(!0),onSignInOther:this.loginWithMobileRequest.bind(this)})},{textKey:"STR_SIGNIN_PASS",domContent:t}]}),y.a.createElement(Ge.a,{icon:"icon-outline-menu",type:"tertiary-neutral",size:"medium",ref:e=>this.menuBtn=e,onClick:this.onShowMenu.bind(this),className:"login-setting-btn",isActive:this.state.isMenuShow}))}let r;return this.props.state.common.confirm&&(r=y.a.createElement(O.default,{visible:!0,onCloseConfirm:()=>this.props.dispatch({type:Ht,payload:null}),okType:this.props.state.common.confirm.type,compact:this.props.state.common.confirm.compact,preventPageClickForceClose:this.props.state.common.confirm.preventPageClickForceClose,title:this.props.state.common.confirm.headerText,onOk:()=>this.props.state.common.confirm.callback(!0),onCancel:(e,t)=>this.props.state.common.confirm.callback(!1,t),okText:this.props.state.common.confirm.confirmText,cancelText:this.props.state.common.confirm.cancelText,message:this.props.state.common.confirm.message,width:this.props.state.common.confirm.width,zIndex:this.props.state.common.confirm.zIndex,windowContainer:this.props.state.common.confirm.windowContainer,showCloseButton:!0})),y.a.createElement("div",{id:"loginPage",className:"flx flx-col default login-page w100",style:{marginTop:"40px"}},y.a.createElement("div",{style:{height:"fit-content",position:"absolute",width:"100%",display:this.state.showNoNetwork?"block":"none"},className:this.state.showNoNetwork?"slideInDown":"slideOutUp"},o),r,y.a.createElement("div",{id:"loginPageContent",className:Object(V.a)(["flx","flx-col","login-page__content","w100",this.state.showNoNetwork?"slideDown":""])},e),y.a.createElement(it.default,{popoverProps:{identity:{windowId:b.c,name:Re.PopoverIdentitiesDefine.SWITCH_LANGUAGE}},ref:e=>this.menu=e,onShow:()=>{this.setState({isMenuShow:!0})},onClose:()=>{this.setState({isMenuShow:!1})},items:[{type:it.MENU_ITEM_TYPE.SUBMENU,textKey:"STR_MENU_LANGUAGE",items:[{text:"Tiếng Việt",icon:{html:s("vn")},onclick:()=>this.onChangeLanguage(Re.LANG_INDEX_VI),checked:this.state.languageSelection==Re.LANG_INDEX_VI},{text:"English",icon:{html:s("us")},onclick:()=>this.onChangeLanguage(Re.LANG_INDEX_EN),checked:this.state.languageSelection==Re.LANG_INDEX_EN}]},{textKey:"STR_ABOUT",onclick:this.onOpenAbout.bind(this)},...this.getAdminConfigs()]}))}}jn.propTypes={state:wt.a.object.isRequired,dispatch:wt.a.func.isRequired};var Qn=jn,Kn=(a("y1FZ"),a("Dprd")),Bn=a("mkWZ");class Fn extends y.a.Component{constructor(e){super(e),this.state={refresh:!1},this._handleCloseApp=this._handleCloseApp.bind(this),this._onIgnoreBackwardAndForward=this._onIgnoreBackwardAndForward.bind(this),this._clearLastLoginUserId()}_clearLastLoginUserId(){try{g.default.info("remove most recent logged in userId");const e=G.default.getInstance();e.removeItem(g.RECENT_USER_ID),"y"===e.getItem("already_login")&&e.removeItem("already_login")}catch(e){g.default.error(e)}}componentDidMount(){Ha.a.isDone()||Ha.a.init("/login"),g.default.isWeb()||window.addEventListener("mouseup",this._onIgnoreBackwardAndForward)}componentWillUnmount(){g.default.isWeb()||window.removeEventListener("mouseup",this._onIgnoreBackwardAndForward)}_onIgnoreBackwardAndForward(e){3!==e.button&&4!==e.button||e.preventDefault()}_trackingRightAfterInstall(){Kn.default.getInstallSource().then((({installSrc:e,justInstalled:t})=>{t&&e&&(Ha.a.trackEvent("distribution","extra_install_launch",e),$zlogin.loginAfterInstall(e))})).catch((e=>{g.default.error("Failed to get install resource ",e)}))}_toggleAppInfo(){this.props.dispatch({type:Xt})}_handleCloseApp(){const e=()=>{x.b.deactiveApp(),L.a.clearSessionBeforeQuit(),L.a.closeDB($zapp.requestQuitAppImmediately)},t=ve.default.getLastLogoutTime();if(Date.now()-t>864e5){let a=K.default.str("STR_LOGOUT_CONFIRM_HEADER"),n=K.default.str("STR_LOGOUT_CONFIRM_TEXT");if(!t){a=K.default.str("STR_LOGOUT_CONFIRM_HEADER_NEW");const e=[y.a.createElement("div",{key:"1_a"},y.a.createElement(ue.a,{textKey:"STR_LOGOUT_CONFIRM_TEXT_NEW_1_A"}),y.a.createElement("br",null),y.a.createElement(ue.a,{textKey:"STR_LOGOUT_CONFIRM_TEXT_NEW_1_B"})),K.default.str("STR_LOGOUT_CONFIRM_TEXT_NEW_2")];n=e[Math.floor(Math.random()*e.length)]}this.props.dispatch({type:Ht,payload:{headerText:a,message:n,preventPageClickForceClose:!0,type:"",zIndex:1e4,confirmText:K.default.str("STR_SIGNIN"),cancelText:K.default.str("STR_MENU_QUIT"),callback:(t,a)=>{this.props.dispatch({type:Ht}),t?A.default.logAction(117242):a===O.ConfirmModalConstant.ModalClosedReason.CTAButtonClicked&&(A.default.logAction(117241),setTimeout((()=>{e()}),600)),A.default._log()}}})}else e()}render(){return y.a.createElement("div",{id:"loginIndex",className:"lg-index",style:{display:"none"}},y.a.createElement("div",{className:"titlebar-os draggable"}),y.a.createElement("div",{className:"flx flx-center flx-1 h0"},y.a.createElement("div",{key:"main",className:"dib fl-r lg-index__main flx-1 w100 h100 "},y.a.createElement(C.a,null,y.a.createElement(Qn,Object(je.a)({},this.props,{ref:e=>this.loginRef=e,onChangeView:e=>this.setState({refresh:!this.state.refresh})}))))),y.a.createElement(C.a,null,this.props.state.common.showAppInfo?y.a.createElement(v.a,{cancel:this._toggleAppInfo.bind(this)}):null,this.props.state.common.showAppUpdateInfo?y.a.createElement(R.default,{info:this.props.state.common.showAppUpdateInfo,cancel:()=>{Ya.ModalManagerV2.closeModal({windowId:b.c,name:Re.ModalIdentitiesDefine.APP_UPDATE_INFO})}}):null,this.props.state.common.showAppDownloadUpdate?y.a.createElement(I.default,{info:this.props.state.common.showAppDownloadUpdate,cancel:()=>{Ya.ModalManagerV2.closeModal({windowId:b.c,name:Re.ModalIdentitiesDefine.APP_DOWNLOAD_UPDATE})}}):null),y.a.createElement(Bn.a,null))}}var zn=Fn,Wn=a("ANjH");a("YaU7");a("vA3+").b,s.ModuleContainer.resolve(h.ZLoggerFactory).createZLogger("login",["question"]);y.a.Component;y.a.Component;const Vn={qrErrorMessage:"",qrNeedsRefresh:!1,qrErrorCode:null,qrTimeout:null,qrData:null,qrcodeImg:"",showTips:!1,currentDisplayName:"",currentAvatar:"",qrExpired:!1},Hn={captchaImg:"",captchaToken:"",loginFail:!1,errorMessage:"Đăng nhập không thành công - Login failed",security:Nn,lastData:null,phoneNumber:"",countryCode:84},Xn={confirm:null,errorMessage:"",lastData:null,showAppInfo:!1,showAppUpdateInfo:!1,showAppDownloadUpdate:!1,showSetting:!1,visibleComponentName:"LOGIN_PASSWORD"};const Yn=Object(Wn.b)({qr:(e=Vn,t)=>{switch(t.type){case qt:return Object(N.a)(Object(N.a)({},e),{},{qrcodeImg:"data:image/png;base64,"+t.payload.data.base64_qr,qrNeedsRefresh:!1,qrErrorCode:null,qrTimeout:null});case jt:{const a=Object(N.a)(Object(N.a)({},e),{},{qrErrorMessage:t.payload,qrNeedsRefresh:!0,qrErrorCode:null,qrTimeout:null});return null!=t.qrNeedsRefresh&&(a.qrNeedsRefresh=t.qrNeedsRefresh),null!=t.qrErrorCode&&(a.qrErrorCode=t.qrErrorCode),t.qrTimeout&&(a.qrTimeout=t.qrTimeout),a}case Qt:{const a=Object(N.a)(Object(N.a)({},e),{},{qrNeedsRefresh:!1});return t.payload&&(t.payload.errorMessage&&(a.qrErrorMessage=t.payload.errorMessage),t.payload.data&&(a.qrData=t.payload.data)),a}case Ft:return Object(N.a)(Object(N.a)({},e),{},{showTips:!0});case zt:return Object(N.a)(Object(N.a)({},e),{},{showTips:!1});case Wt:return Object(N.a)(Object(N.a)({},e),{},{currentDisplayName:t.payload.currentDisplayName,currentAvatar:t.payload.currentAvatar});case Vt:return Vn;case Jt:case Kt:return Object(N.a)(Object(N.a)({},e),{},{qrErrorMessage:""});case $t:return Object(N.a)(Object(N.a)({},e),{},{qrExpired:t.payload.isExpired});default:return e}},pass:(e=Hn,t)=>{switch(t.type){case Kt:{let a=Object(N.a)(Object(N.a)({},e),{},{loginFail:!0,security:!1});return t.payload&&(null!=t.payload.phoneNumber&&(a=Object(N.a)(Object(N.a)({},a),{},{phoneNumber:t.payload.phoneNumber,countryCode:t.payload.countryCode})),null!=t.payload.errorMessage&&(a=Object(N.a)(Object(N.a)({},a),{},{errorMessage:t.payload.errorMessage}))),a}case Dt:{let a=[Le.a.SECURITY_QUESTION_REQUIRED,Le.a.PASSWORD_NOT_SET,Le.a.SENSITIVE_FLOW_REQUIRE_OTP_OR_CONFIRM_MOBILE,Le.a.SENSITIVE_FLOW_REQUIRE_OTP].indexOf(t.payload.eCode)>=0;a&&(a=Lt);const n=Object(N.a)(Object(N.a)({},e),{},{lastData:Object(N.a)({},e.lastData),loginFail:!0,security:a});return t.payload&&(n.lastData=Object(N.a)(Object(N.a)({},n.lastData),t.payload)),n}case Zt:return Object(N.a)(Object(N.a)({},e),{},{lastData:t.payload,loginFail:!0,security:!0});case Ut:return Object(N.a)(Object(N.a)({},e),{},{lastData:Object(N.a)(Object(N.a)({},e.lastData),{},{questionData:t.payload})});case kt:return Object(N.a)(Object(N.a)({},e),{},{loginFail:!0,errorMessage:t.payload,security:!1,lastData:null});case Qt:return Object(N.a)(Object(N.a)({},e),{},{lastData:null,security:!1});case Gt:return Object(N.a)(Object(N.a)({},e),{},{captchaImg:"data:image/png;base64,"+t.payload.data.data.captcha_img,captchaToken:t.payload.data.data.token});case Yt:return Object(N.a)(Object(N.a)({},e),{},{security:!1,lastData:null,loginFail:!1,countryCode:84,errorMessage:""});case Vt:return Hn;default:return e}},common:(e=Xn,t)=>{var a;switch(t.type){case Kt:return Object(N.a)(Object(N.a)({},e),{},{visibleComponentName:"LOGIN_PASSWORD",errorMessage:void 0!==(null===(a=t.payload)||void 0===a?void 0:a.errorMessage)?t.payload.errorMessage:e.errorMessage,confirm:null});case Qt:return Object(N.a)(Object(N.a)({},e),{},{visibleComponentName:"LOGIN_QR"});case Bt:{const a=Object(N.a)(Object(N.a)({},e),{},{visibleComponentName:"REGISTER"});return t.payload&&(a.lastData=Object(N.a)(Object(N.a)({},e.lastData),t.payload)),a}case en.PopupActions.TOGGLE_CONFIRM:case Ht:return Object(N.a)(Object(N.a)({},e),{},{confirm:t.payload});case Xt:case en.PopupActions.TOGGLE_APP_INFO:return Object(N.a)(Object(N.a)({},e),{},{showAppInfo:!e.showAppInfo});case en.PopupActions.TOGGLE_SETTING:return Object(N.a)(Object(N.a)({},e),{},{showSetting:!e.showSetting});case en.PopupActions.SHOW_APP_UPDATE_INFO:return Object(N.a)(Object(N.a)({},e),{},{showAppUpdateInfo:t.payload});case en.PopupActions.SHOW_APP_DOWNLOAD_UPDATE:return Object(N.a)(Object(N.a)({},e),{},{showAppDownloadUpdate:t.payload});case Jt:var n;return Object(N.a)(Object(N.a)({},e),{},{passingError:(null===(n=t.payload)||void 0===n?void 0:n.error)||null,visibleComponentName:"MOBILE_LOGIN"});case Dt:return Object(N.a)(Object(N.a)({},e),{},{visibleComponentName:"SECQ"});default:return e}}});var Zn=Object(Wn.d)(Yn),Jn=a("CzFt"),$n=a("YGiT"),eo=a("hI9i"),to=a("EUMs");a("U96N"),new Promise((async(e,t)=>{var n;Object($n.a)();a("2ua2").default.init();g.default.checkSupport();let o=!0;const s=null!==(n=G.default.getInstance().getItem("viewerkey"))&&void 0!==n?n:"",r=!!G.default.getInstance().getItem("z_press_menu_button_with_badge"),i=parseInt(G.default.getInstance().getItem("z_loginversion")||"0");try{var c,l,u,d,_,h,m,p,y,E,f,S,T;await D.b.getServerInfo(null);const a=D.b.getServerConfig();a&&(_t(a),w.default.startQoSNotLogged()),o=!1;const n={enable_entry_login_pw:null!==(c=null===(l=ct.default.authentication)||void 0===l||null===(u=l.login_scr)||void 0===u?void 0:u.enable_entry_login_pw)&&void 0!==c?c:0,flag_login_gr_has_uid:null!==(d=null===(_=ct.default.authentication)||void 0===_||null===(h=_.login_scr)||void 0===h?void 0:h.flag_login_gr_has_uid)&&void 0!==d?d:0,flag_login_gr_non_uid:null!==(m=null===(p=ct.default.authentication)||void 0===p||null===(y=p.login_scr)||void 0===y?void 0:y.flag_login_gr_non_uid)&&void 0!==m?m:0,enable_badge_login_pw:null!==(E=null===(f=ct.default.authentication)||void 0===f||null===(S=f.login_scr)||void 0===S?void 0:S.enable_badge_login_pw)&&void 0!==E?E:0};if(s&&n.flag_login_gr_has_uid){const t=!!n.enable_entry_login_pw;return e({enableEntryLoginPassword:t,dropServerConfig:o,enableBadgeSettingButton:!!t&&(!!n.enable_badge_login_pw&&!r)})}if(!s&&null!==(T=n.flag_login_gr_non_uid)&&void 0!==T&&T){const t=!!n.enable_entry_login_pw;return e({enableEntryLoginPassword:t,dropServerConfig:o,enableBadgeSettingButton:!!t&&(!!n.enable_badge_login_pw&&!r)})}return t()}catch(N){o=!0}if(i<2)return t();{const t=2===i;return e({enableEntryLoginPassword:t,enableBadgeSettingButton:!!t&&!r,dropServerConfig:o})}})).then((e=>{G.default.getInstance().setItem("z_loginversion","2"),Object(E.render)(y.a.createElement(bt,{enableBadgeSettingButton:e.enableBadgeSettingButton,enableEntryLoginPassword:e.enableEntryLoginPassword,dropServerConfig:e.dropServerConfig,autoUpdater:ct.default.auto_updater}),document.getElementById("app"))})).catch((()=>{var e;const t=null!==(e=G.default.getInstance().getItem("z_session_expired_14days"))&&void 0!==e?e:"";w.default.increaseSuccess(152401,0,10,[JSON.stringify({device_imei:g.default.getZaloClientID(),session_id:new ft(0,3).generateId(),login_version:"baseline_all_method",last_uid:ve.default.getLastUserId()||null,login_source:t?"session_timeout_14day":null})]),w.default.increaseSuccess(152407,0,10,[JSON.stringify({device_imei:g.default.getZaloClientID(),session_id:new ft(0,3).generateId(),login_version:"baseline_all_method",last_uid:ve.default.getLastUserId()||null,login_source:t?"session_timeout_14day":null})]),w.default.flush(),G.default.getInstance().setItem("z_loginversion","0");const a=Object(f.b)((function(e){return{state:e}}),(function(e){return{dispatch:t=>{Object(Jn.c)(t),e(t)}}}))(zn),n=e=>{const{appVersionState:t}=Object(P.a)();if(t===M.a.NONE)return null;return t===M.a.VERIFIED?y.a.createElement(a,e):y.a.createElement(to.a,null)};Object(E.render)(y.a.createElement(f.a,{store:Jn.a,context:Jn.b},y.a.createElement(f.a,{store:Zn},y.a.createElement(f.a,{store:eo.b,context:eo.a},y.a.createElement(n,null)))),document.getElementById("app"))})).finally((()=>{requestAnimationFrame((()=>{const e=document.getElementById("login-splash-screen");e&&(e.style.display="none")}))}));a("TGaw"),a("Ppsz");var ao=a("wH4e"),no=(a("69Uf"),a("+eUS"));a("uiYo");Object(no.a)(ao.RunMode.Host)}}]);
//# sourceMappingURL=../sourcemaps/lazy/login-startup.c04ff27579bd5199c122.js.map